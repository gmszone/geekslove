/**
 * @license MelonJS Game Engine
 * @copyright (C) 2011 - 2014 Olivier Biot, Jason Oster, Aaron McLeod
 * http://www.melonjs.org
 *
 * melonJS is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license.php
 */
if(function(){function a(){if(!d){if(!document.body)return setTimeout(a,13);document.removeEventListener?document.removeEventListener("DOMContentLoaded",a,!1):window.removeEventListener("load",a,!1),d=!0;for(var b=0;b<e.length;b++)e[b].call(window,[]);e.length=0,"function"==typeof define&&define.amd&&define("me",[],function(){return me})}}function b(){return c?void 0:(c=!0,"complete"===document.readyState?a():(document.addEventListener&&document.addEventListener("DOMContentLoaded",a,!1),void window.addEventListener("load",a,!1)))}window.me=window.me||{};var c=!1,d=!1,e=[];window.onReady=function(a){return b(),d?a.call(window,[]):e.push(function(){return a.call(window,[])}),this},me.skipAutoInit!==!0?window.onReady(function(){me.boot()}):me.init=function(){me.boot(),a()},window.throttle||(window.throttle=function(a,b,c){var d,e=window.performance.now();return"boolean"!=typeof b&&(b=!1),function(){var f=window.performance.now(),g=f-e,h=arguments;return a>g?void(b===!1&&(clearTimeout(d),d=setTimeout(function(){return e=f,c.apply(null,h)},g))):(e=f,c.apply(null,h))}}),"undefined"==typeof console&&(console={log:function(){},info:function(){},error:function(){alert(Array.prototype.slice.call(arguments).join(", "))}})}(),Object.getPrototypeOf=Object.getPrototypeOf||function(a){return a.__proto__},Object.setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},Object.defineProperty||(Object.defineProperty=function(a,b,c){if(!a.__defineGetter__)throw new TypeError("Object.defineProperty not supported");c.get&&a.__defineGetter__(b,c.get),c.set&&a.__defineSetter__(b,c.set)}),"function"!=typeof Object.create&&(Object.create=function(a){var b=function(){};return b.prototype=a,new b}),!Function.prototype.bind){var Empty=function(){};Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError("Function.prototype.bind called on incompatible "+b);var c=Array.prototype.slice.call(arguments,1),d=function(){if(this instanceof d){var e=b.apply(this,c.concat(Array.prototype.slice.call(arguments)));return Object(e)===e?e:this}return b.apply(a,c.concat(Array.prototype.slice.call(arguments)))};return b.prototype&&(Empty.prototype=b.prototype,d.prototype=new Empty,Empty.prototype=null),d}}if(function(){function a(a,b,c){Object.keys(c).forEach(function(d){if(b[d]=c[d],"function"!=typeof c[d])throw new TypeError("extend: Method `"+d+"` is not a function");Object.defineProperty(a.prototype,d,{configurable:!0,value:c[d]})})}function b(a,b,c){return a.prototype[b].apply(this,c)}Object.defineProperty(Object.prototype,"extend",{value:function(){function c(){return this.init.apply(this,arguments),this}var d={},e=Array.prototype.slice.call(arguments,0);if(c.prototype=Object.create(this.prototype),e.forEach(function(b){a(c,d,b.__methods__||b)}),!("init"in c.prototype))throw new TypeError("extend: Class is missing a constructor named `init`");return Object.defineProperty(c.prototype,"_super",{value:b}),Object.defineProperty(c,"__methods__",{value:d}),c}})}(),me.Error=Error.extend({init:function(a){this.name="me.Error",this.message=a}}),Function.prototype.defer=function(){return setTimeout(this.bind.apply(this,arguments),.01)},Number.prototype.clamp=function(a,b){return a>this?a:this>b?b:+this},Number.prototype.random=function(a,b){return~~(Math.random()*(b-a))+a},Number.prototype.randomFloat=function(a,b){return Math.random()*(b-a)+a},Number.prototype.weightedRandom=function(a,b){return~~(Math.pow(Math.random(),2)*(b-a))+a},Number.prototype.round=function(){var a=arguments.length<2?this:arguments[0],b=Math.pow(10,arguments[1]||arguments[0]||0);return~~(.5+a*b)/b},Number.prototype.toHex=function(){return"0123456789ABCDEF".charAt(this-this%16>>4)+"0123456789ABCDEF".charAt(this%16)},Number.prototype.sign=function(){return 0>this?-1:this>0?1:0},Number.prototype.degToRad=function(a){return(a||this)/180*Math.PI},Number.prototype.radToDeg=function(a){return(a||this)*(180/Math.PI)},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/gm,"")}),String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")}),String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/,"")}),String.prototype.isNumeric=function(){return!isNaN(this)&&""!==this.trim()},String.prototype.isBoolean=function(){var a=this.trim();return"true"===a||"false"===a},String.prototype.contains||(String.prototype.contains=function(a,b){return-1!==String.prototype.indexOf.call(this,a,b)}),String.prototype.toHex=function(){for(var a="",b=0;b<this.length;)a+=this.charCodeAt(b++).toString(16);return a},Array.prototype.remove=function(a){var b=Array.prototype.indexOf.call(this,a);return-1!==b&&Array.prototype.splice.call(this,b,1),this},Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;d--;c++)a.call(b||this,this[c],c,this)}),Array.isArray||(Array.isArray=function(a){var b;return b=a instanceof Array}),Array.prototype.random=function(a){return a[Number.prototype.random(0,a.length-1)]},Array.prototype.weightedRandom=function(a){return a[Number.prototype.weightedRandom(0,a.length-1)]},me.Float32Array="undefined"!=typeof Float32Array?Float32Array:Array,"undefined"==typeof window.performance&&(window.performance={}),"undefined"==typeof Date.now&&(Date.now=function(){return(new Date).getTime()}),!window.performance.now){var timeOffset=Date.now();window.performance.timing&&window.performance.timing.navigationStart&&(timeOffset=window.performance.timing.navigationStart),window.performance.now=function(){return Date.now()-timeOffset}}!function(){me.mod="melonJS",me.version="1.2.0",me.sys={fps:60,interpolation:!1,scale:null,scalingInterpolation:!1,gravity:void 0,stopOnAudioError:!0,pauseOnBlur:!0,resumeOnFocus:!0,stopOnBlur:!1,preRender:!1,checkVersion:function(a,b){b=b||me.version;for(var c=a.split("."),d=b.split("."),e=Math.min(c.length,d.length),f=0,g=0;e>g&&!(f=+c[g]-+d[g]);g++);return f?f:c.length-d.length}};var a=!1;Object.defineProperty(me,"initialized",{get:function(){return a}}),me.boot=function(){a||(me.device._check(),me.save._init(),me.loader.setNocache(document.location.href.match(/\?nocache/)||!1),me.timer.init(),me.mapReader=new me.TMXMapReader,me.state.init(),me.pool.init(),me.device.isMobile===!1&&me.input._enableKeyboardEvent(),me.levelDirector.reset(),a=!0)}}(),function(){me.game=function(){var a={},b=!1,c=!0,d=0,e=1,f=null;return a.viewport=null,a.currentLevel=null,a.world=null,a.mergeGroup=!0,a.sortOn="z",a.tmxRenderer=null,a.onLevelLoaded=null,a.init=function(d,e){b||(d=d||me.video.renderer.getWidth(),e=e||me.video.renderer.getHeight(),a.viewport=new me.Viewport(0,0,d,e),a.world=new me.Container(0,0,d,e),a.world.name="rootContainer",me.collision.init(),f=me.video.renderer,me.event.publish(me.event.GAME_INIT),me.input._translatePointerEvents(),c=!0,a.currentLevel={pos:{x:0,y:0}},b=!0)},a.reset=function(){me.collision.quadTree.clear(),a.world.destroy(),a.viewport&&a.viewport.reset(),a.currentLevel={pos:{x:0,y:0}},f.resetTransform(),d=0,e=~~(.5+60/me.sys.fps)},a.getParentContainer=function(a){return a.ancestor},a.repaint=function(){c=!0},a.update=function(b){++d%e===0&&(d=0,me.timer.update(b),me.collision.quadTree.clear(),me.collision.quadTree.insertContainer(a.world),c=a.world.update(me.timer.getDelta())||c,c=a.viewport.update(me.timer.getDelta())||c)},a.draw=function(){if(me.video.renderer===me.WebGLRenderer&&me.video.renderer.startRender(),c){var b=a.viewport.pos.x+~~a.viewport.offset.x,d=a.viewport.pos.y+~~a.viewport.offset.y;a.world.transform.translate(-b,-d),a.viewport.screenX=b-a.currentLevel.pos.x,a.viewport.screenY=d-a.currentLevel.pos.y,a.world.draw(f,a.viewport),a.world.transform.translate(b,d),a.viewport.draw(f)}c=!1,me.video.renderer.blitSurface()},a}()}(),function(){var a=function(a){return a.substring(0,1).toUpperCase()+a.substring(1,a.length)};me.agent=function(){var b={},c=["ms","MS","moz","webkit","o"];return b.prefixed=function(b,d){if(d=d||window,b in d)return d[b];var e,f=a(b);return c.some(function(a){var b=a+f;return e=b in d?d[b]:void 0}),e},b.setPrefixed=function(b,d,e){if(e=e||window,b in e)return void(e[b]=d);var f=a(b);c.some(function(a){var b=a+f;return b in e?(e[b]=d,!0):!1})},b}()}(),function(){me.device=function(){function a(a){a.reading?(c.accelerationX=a.reading.accelerationX,c.accelerationY=a.reading.accelerationY,c.accelerationZ=a.reading.accelerationZ):(c.accelerationX=a.accelerationIncludingGravity.x,c.accelerationY=a.accelerationIncludingGravity.y,c.accelerationZ=a.accelerationIncludingGravity.z)}function b(a){c.gamma=a.gamma,c.beta=a.beta,c.alpha=a.alpha}var c={},d=!1,e=!1,f=null;return c._check=function(){me.device._detectDevice(),me.device.pointerEnabled=me.agent.prefixed("pointerEnabled",navigator),navigator.maxTouchPoints=me.agent.prefixed("maxTouchPoints",navigator)||0,window.gesture=me.agent.prefixed("gesture"),me.device.touch="createTouch"in document||"ontouchstart"in window||navigator.isCocoonJS||me.device.pointerEnabled&&navigator.maxTouchPoints>0,me.device.hasAccelerometer="undefined"!=typeof window.DeviceMotionEvent||"undefined"!=typeof window.Windows&&"function"==typeof Windows.Devices.Sensors.Accelerometer,this.hasPointerLockSupport=me.agent.prefixed("pointerLockElement",document),this.hasPointerLockSupport&&(document.exitPointerLock=me.agent.prefixed("exitPointerLock",document)),window.DeviceOrientationEvent&&(me.device.hasDeviceOrientation=!0),this.hasFullscreenSupport=me.agent.prefixed("fullscreenEnabled",document)||document.mozFullScreenEnabled,document.exitFullscreen=me.agent.prefixed("cancelFullScreen",document)||me.agent.prefixed("exitFullscreen",document),navigator.vibrate=me.agent.prefixed("vibrate",navigator);try{c.localStorage=!!window.localStorage}catch(a){c.localStorage=!1}window.addEventListener("blur",function(){me.sys.stopOnBlur&&me.state.stop(!0),me.sys.pauseOnBlur&&me.state.pause(!0)},!1),window.addEventListener("focus",function(){me.sys.stopOnBlur&&me.state.restart(!0),me.sys.resumeOnFocus&&me.state.resume(!0)},!1);var b,d;"undefined"!=typeof document.hidden?(b="hidden",d="visibilitychange"):"undefined"!=typeof document.mozHidden?(b="mozHidden",d="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(b="msHidden",d="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(b="webkitHidden",d="webkitvisibilitychange"),"string"==typeof d&&document.addEventListener(d,function(){document[b]?(me.sys.stopOnBlur&&me.state.stop(!0),me.sys.pauseOnBlur&&me.state.pause(!0)):(me.sys.stopOnBlur&&me.state.restart(!0),me.sys.resumeOnFocus&&me.state.resume(!0))},!1)},c._detectDevice=function(){me.device.iOS=me.device.ua.match(/iPhone|iPad|iPod/i)||!1,me.device.android=me.device.ua.match(/Android/i)||!1,me.device.android2=me.device.ua.match(/Android 2/i)||!1,me.device.wp=me.device.ua.match(/Windows Phone/i)||!1,me.device.BlackBerry=me.device.ua.match(/BlackBerry/i)||!1,me.device.Kindle=me.device.ua.match(/Kindle|Silk.*Mobile Safari/i)||!1,me.device.isMobile=me.device.ua.match(/Mobi/i)||me.device.iOS||me.device.android||me.device.wp||me.device.BlackBerry||me.device.Kindle||me.device.iOS||!1},c.ua=navigator.userAgent,c.localStorage=!1,c.hasAccelerometer=!1,c.hasDeviceOrientation=!1,c.hasFullscreenSupport=!1,c.hasPointerLockSupport=!1,c.nativeBase64="function"==typeof window.atob,c.touch=!1,c.isMobile=!1,c.iOS=!1,c.android=!1,c.android2=!1,c.wp=!1,c.BlackBerry=!1,c.Kindle=!1,c.orientation=0,c.accelerationX=0,c.accelerationY=0,c.accelerationZ=0,c.gamma=0,c.beta=0,c.alpha=0,c.requestFullscreen=function(a){this.hasFullscreenSupport&&(a=a||me.video.getWrapper(),a.requestFullscreen=me.agent.prefixed("requestFullscreen",a)||a.mozRequestFullScreen,a.requestFullscreen())},c.exitFullscreen=function(){this.hasFullscreenSupport&&document.exitFullscreen()},c.getPixelRatio=function(){if(null===f){var a;a="undefined"!=typeof me.video.renderer?me.video.renderer.getScreenContext():me.CanvasRenderer.getContext2d(document.createElement("canvas"));var b=window.devicePixelRatio||1,c=me.agent.prefixed("backingStorePixelRatio",a)||1;f=b/c}return f},c.getStorage=function(a){switch(a=a||"local"){case"local":return me.save;default:throw new me.Error("storage type "+a+" not supported")}},c.turnOnPointerLock=function(){if(this.hasPointerLockSupport){var a=me.video.getWrapper();if(me.device.ua.match(/Firefox/i)){var b=function(){(me.agent.prefixed("fullscreenElement",document)||document.mozFullScreenElement)===a&&(document.removeEventListener("fullscreenchange",b),document.removeEventListener("mozfullscreenchange",b),a.requestPointerLock=me.agent.prefixed("requestPointerLock",a),a.requestPointerLock())};document.addEventListener("fullscreenchange",b,!1),document.addEventListener("mozfullscreenchange",b,!1),me.device.requestFullscreen()}else a.requestPointerLock()}},c.turnOffPointerLock=function(){this.hasPointerLockSupport&&document.exitPointerLock()},c.watchAccelerometer=function(){if(me.device.hasAccelerometer){if(!d){if("undefined"==typeof Windows)window.addEventListener("devicemotion",a,!1);else{var b=Windows.Devices.Sensors.Accelerometer.getDefault();if(b){var c=b.minimumReportInterval,e=c>=16?c:25;b.reportInterval=e,b.addEventListener("readingchanged",a,!1)}}d=!0}return!0}return!1},c.unwatchAccelerometer=function(){if(d){if("undefined"==typeof Windows)window.removeEventListener("devicemotion",a,!1);else{var b=Windows.Device.Sensors.Accelerometer.getDefault();b.removeEventListener("readingchanged",a,!1)}d=!1}},c.watchDeviceOrientation=function(){return me.device.hasDeviceOrientation&&!e&&(window.addEventListener("deviceorientation",b,!1),e=!0),!1},c.unwatchDeviceOrientation=function(){e&&(window.removeEventListener("deviceorientation",b,!1),e=!1)},c.vibrate=function(a){navigator.vibrate&&navigator.vibrate(a)},c}(),Object.defineProperty(me.device,"isFullscreen",{get:function(){if(me.device.hasFullscreenSupport){var a=me.agent.prefixed("fullscreenElement",document)||document.mozFullScreenElement;return a===me.video.getWrapper()}return!1}}),Object.defineProperty(me.device,"sound",{get:function(){return!Howler.noAudio}})}(),function(){me.timer=function(){var a={},b=0,c=0,d=0,e=0,f=0,g=Math.ceil(1e3/me.sys.fps),h=1e3/me.sys.fps*1.25,i=[],j=0,k=function(a){for(var b=0,c=i.length;c>b;b++)if(i[b].timerId===a){i.splice(b,1);break}},l=function(a){for(var b=0,c=i.length;c>b;b++){var d=i[b];d.pauseable&&me.state.isPaused()||(d.elapsed+=a),d.elapsed>=d.delay&&(d.func.apply(this),d.repeat===!0?d.elapsed-=d.delay:me.timer.clearTimeout(d.timerId))}};return a.tick=1,a.fps=0,a.init=function(){a.reset(),e=d=0},a.reset=function(){d=e=window.performance.now(),f=0,c=0,b=0},a.setTimeout=function(a,b,c){return i.push({func:a,delay:b,elapsed:0,repeat:!1,timerId:++j,pauseable:c===!0||!0}),j},a.setInterval=function(a,b,c){return i.push({func:a,delay:b,elapsed:0,repeat:!0,timerId:++j,pauseable:c===!0||!0}),j},a.clearTimeout=function(a){k.defer(this,a)},a.clearInterval=function(a){k.defer(this,a)},a.getTime=function(){return e},a.getDelta=function(){return f},a.countFPS=function(){b++,c+=f,b%10===0&&(this.fps=(~~(1e3*b/c)).clamp(0,me.sys.fps),c=0,b=0)},a.update=function(b){return d=e,e=b,f=e-d,a.tick=f>h&&me.sys.interpolation?f/g:1,l(f),f},a}()}(),function(){me.pool=function(){var a={},b={};return a.init=function(){a.register("me.Entity",me.Entity),a.register("me.CollectableEntity",me.CollectableEntity),a.register("me.LevelEntity",me.LevelEntity),a.register("TileObject",me.Sprite),a.register("me.Tween",me.Tween,!0),a.register("me.Color",me.Color,!0),a.register("me.Particle",me.Particle,!0)},a.register=function(a,c,d){return d?void(b[a.toLowerCase()]={"class":c,pool:[]}):void(b[a.toLowerCase()]={"class":c,pool:void 0})},a.pull=function(a){var c="string"==typeof a?a.toLowerCase():void 0,d=Array.prototype.slice.call(arguments);if(c&&b[c]){var e;if(!b[c].pool)return e=b[c]["class"],d[0]=e,new(e.bind.apply(e,d));var f,g=b[c];return e=g["class"],g.pool.length>0?(f=g.pool.pop(),"function"==typeof f.init&&f.init.apply(f,d.slice(1)),"function"==typeof f.onResetEvent&&f.onResetEvent.apply(f,d.slice(1))):(d[0]=e,f=new(e.bind.apply(e,d)),f.className=c),f}return c&&console.error("Cannot instantiate entity of type '"+a+"': Class not found!"),null},a.purge=function(){for(var a in b)b.hasOwnProperty(a)&&(b[a].pool=[])},a.push=function(a){var c=a.className;"undefined"!=typeof c&&b[c]&&b[c].pool.push(a)},a}()}(),function(){me.Vector2d=Object.extend({init:function(a,b){return this.set(a||0,b||0)},set:function(a,b){if(a!==+a||b!==+b)throw new me.Vector2d.Error("invalid x,y parameters (not a number)");return this.x=a,this.y=b,this},setZero:function(){return this.set(0,0)},setV:function(a){return this.x=a.x,this.y=a.y,this},add:function(a){return this.x+=a.x,this.y+=a.y,this},sub:function(a){return this.x-=a.x,this.y-=a.y,this},scale:function(a,b){return this.x*=a,this.y*="undefined"!=typeof b?b:a,this},scaleV:function(a){return this.x*=a.x,this.y*=a.y,this},div:function(a){return this.x/=a,this.y/=a,this},abs:function(){return this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y),this},clamp:function(a,b){return new me.Vector2d(this.x.clamp(a,b),this.y.clamp(a,b))},clampSelf:function(a,b){return this.x=this.x.clamp(a,b),this.y=this.y.clamp(a,b),this},minV:function(a){return this.x=this.x<a.x?this.x:a.x,this.y=this.y<a.y?this.y:a.y,this},maxV:function(a){return this.x=this.x>a.x?this.x:a.x,this.y=this.y>a.y?this.y:a.y,this},floor:function(){return new me.Vector2d(~~this.x,~~this.y)},floorSelf:function(){return this.x=~~this.x,this.y=~~this.y,this},ceil:function(){return new me.Vector2d(Math.ceil(this.x),Math.ceil(this.y))},ceilSelf:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},negate:function(){return new me.Vector2d(-this.x,-this.y)},negateSelf:function(){return this.x=-this.x,this.y=-this.y,this},copy:function(a){return this.x=a.x,this.y=a.y,this},equals:function(a){return this.x===a.x&&this.y===a.y},normalize:function(){var a=this.length();return a>0&&(this.x=this.x/a,this.y=this.y/a),this},perp:function(){var a=this.x;return this.x=this.y,this.y=-a,this},rotate:function(a){var b=this.x,c=this.y;return this.x=b*Math.cos(a)-c*Math.sin(a),this.y=b*Math.sin(a)+c*Math.cos(a),this},reverse:function(){return this.x=-this.x,this.y=-this.y,this},dotProduct:function(a){return this.x*a.x+this.y*a.y},length2:function(){return this.dotProduct(this)},length:function(){return Math.sqrt(this.length2())},distance:function(a){return Math.sqrt((this.x-a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y))},angle:function(a){return Math.atan2(a.y-this.y,a.x-this.x)},project:function(a){var b=this.dotProduct(a)/a.length2();return this.x=b*a.x,this.y=b*a.y,this},projectN:function(a){var b=this.dotProduct(a);return this.x=b*a.x,this.y=b*a.y,this},reflect:function(a){var b=this.x,c=this.y;return this.project(a).scale(2),this.x-=b,this.y-=c,this},reflectN:function(a){var b=this.x,c=this.y;return this.projectN(a).scale(2),this.x-=b,this.y-=c,this},clone:function(){return new me.Vector2d(this.x,this.y)},toString:function(){return"x:"+this.x+",y:"+this.y}}),me.Vector2d.Error=me.Error.extend({init:function(a){me.Error.prototype.init.apply(this,[a]),this.name="me.Vector2d.Error"}})}(),function(){me.Rect=Object.extend({init:function(a,b,c,d){this.pos=new me.Vector2d(a,b),this.width=c,this.height=d,this.shapeType="Rectangle",this.hWidth=~~(c/2),this.hHeight=~~(d/2)},setShape:function(a,b,c,d){return this.pos.set(a,b),this.resize(c,d),this},resize:function(a,b){return this.width=a,this.height=b,this.hWidth=~~(a/2),this.hHeight=~~(b/2),this},getBounds:function(){return this},updateBounds:function(){return this},clone:function(){return new me.Rect(this.pos.x,this.pos.y,this.width,this.height)},translate:function(a,b){return this.pos.x+=a,this.pos.y+=b,this},translateV:function(a){return this.translate(a.x,a.y)},union:function(a){var b=Math.min(this.left,a.left),c=Math.min(this.top,a.top);return this.resize(Math.max(this.right,a.right)-b,Math.max(this.bottom,a.bottom)-c),this.pos.set(b,c),this},flipX:function(a){return this.pos.x=a-this.width-this.pos.x,this},flipY:function(a){return this.pos.y=a-this.height-this.pos.y,this},equals:function(a){return this.left===a.left&&this.right===a.right&&this.top===a.top&&this.bottom===a.bottom},overlaps:function(a){return this.left<a.right&&a.left<this.right&&this.top<a.bottom&&a.top<this.bottom},within:function(a){return a.contains(this)},contains:function(a){return a.left>=this.left&&a.right<=this.right&&a.top>=this.top&&a.bottom<=this.bottom},containsPointV:function(a){return this.containsPoint(a.x,a.y)},containsPoint:function(a,b){return a>=this.left&&a<=this.right&&b>=this.top&&b<=this.bottom},toPolygon:function(){var a=this.pos,b=this.width,c=this.height;return new me.Polygon(a.x,a.y,[new me.Vector2d,new me.Vector2d(b,0),new me.Vector2d(b,c),new me.Vector2d(0,c)])},draw:function(a,b){a.setColor(b||"red"),a.setLineWidth(1),a.strokeRect(this.left,this.top,this.width,this.height)}}),Object.defineProperty(me.Rect.prototype,"left",{get:function(){return this.pos.x},configurable:!0}),Object.defineProperty(me.Rect.prototype,"right",{get:function(){return this.pos.x+this.width},configurable:!0}),Object.defineProperty(me.Rect.prototype,"top",{get:function(){return this.pos.y},configurable:!0}),Object.defineProperty(me.Rect.prototype,"bottom",{get:function(){return this.pos.y+this.height},configurable:!0})}(),function(){me.Ellipse=Object.extend({init:function(a,b,c,d){this.pos=new me.Vector2d,this.bounds=void 0,this.radius=new me.Vector2d,this.shapeType="Ellipse",this.setShape(a,b,c,d)},setShape:function(a,b,c,d){return this.pos.set(a,b),this.radius.set(c/2,d/2),this.updateBounds(),this},translate:function(a,b){return this.pos.x+=a,this.pos.y+=b,this.bounds.translate(a,b),this},translateV:function(a){return this.pos.add(a),this.bounds.translateV(a),this},containsPointV:function(a){return this.containsPoint(a.x,a.y)},containsPoint:function(a,b){return a-=this.pos.x,b-=this.pos.y,a*a/(this.radius.x*this.radius.x)+b*b/(this.radius.y*this.radius.y)<=1},getBounds:function(){return this.bounds},updateBounds:function(){var a=this.pos.x-this.radius.x,b=this.pos.y-this.radius.y,c=2*this.radius.x,d=2*this.radius.y;return this.bounds?this.bounds.setShape(a,b,c,d):this.bounds=new me.Rect(a,b,c,d),this.bounds},clone:function(){return new me.Ellipse(this.pos.x,this.pos.y,2*this.radius.x,2*this.radius.y)},draw:function(a,b){a.setColor(b||"red"),a.setLineWidth(1),a.strokeArc(this.pos.x,this.pos.y,this.radius.x,this.radius.y,0,2*Math.PI,!1)}})}(),function(){me.Polygon=Object.extend({init:function(a,b,c){this.pos=new me.Vector2d,this.bounds=void 0,this.points=null,this.shapeType="Polygon",this.setShape(a,b,c)},setShape:function(a,b,c){return this.pos.set(a,b),this.points=c,this.recalc(),this.updateBounds(),this},recalc:function(){var a,b=this.edges=[],c=this.normals=[],d=this.points,e=d.length;if(3>e)throw new me.Polygon.Error("Requires at least 3 points");for(a=0;e>a;a++){var f=(new me.Vector2d).copy(d[(a+1)%e]).sub(d[a]);b.push(f),c.push((new me.Vector2d).copy(f).perp().normalize())}return this},translate:function(a,b){return this.pos.x+=a,this.pos.y+=b,this.bounds.translate(a,b),this},translateV:function(a){return this.pos.add(a),this.bounds.translateV(a),this},containsPointV:function(a){return this.containsPoint(a.x,a.y)},containsPoint:function(a,b){for(var c=!1,d=this.pos.x,e=this.pos.y,f=this.points,g=f.length,h=0,i=g-1;g>h;i=h++){var j=f[h].y+e,k=f[h].x+d,l=f[i].y+e,m=f[i].x+d;j>b!=l>b&&(m-k)*(b-j)/(l-j)+k>a&&(c=!c)}return c},getBounds:function(){return this.bounds},updateBounds:function(){var a=1/0,b=1/0,c=-1/0,d=-1/0;return this.points.forEach(function(e){a=Math.min(a,e.x),b=Math.min(b,e.y),c=Math.max(c,e.x),d=Math.max(d,e.y)}),this.bounds?this.bounds.setShape(a,b,c-a,d-b):this.bounds=new me.Rect(a,b,c-a,d-b),this.bounds.translateV(this.pos)},clone:function(){var a=[];return this.points.forEach(function(b){a.push(new me.Vector2d(b.x,b.y))}),new me.Polygon(this.pos.x,this.pos.y,a)},draw:function(a,b){a.save(),a.setColor(b||"red"),a.setLineWidth(1),a.strokePolygon(this),a.restore()}}),me.Polygon.Error=me.Error.extend({init:function(a){me.Error.prototype.init.apply(this,[a]),this.name="me.Polygon.Error"}})}(),function(){me.Line=me.Polygon.extend({recalc:function(){var a=this.edges=[],b=this.normals=[],c=this.points;if(2!==c.length)throw new me.Line.Error("Requires exactly 2 points");var d=(new me.Vector2d).copy(c[1]).sub(c[0]);return a.push(d),b.push((new me.Vector2d).copy(d).perp().normalize()),this}}),me.Line.Error=me.Error.extend({init:function(a){me.Error.prototype.init.apply(this,[a]),this.name="me.Line.Error"}})}(),function(){me.Matrix2d=Object.extend({init:function(a,b,c,d,e,f){this.a=a||1,this.b=b||0,this.c=c||0,this.d=d||1,this.e=e||0,this.f=f||0},identity:function(){return this.set(1,0,0,1,0,0),this},set:function(a,b,c,d,e,f){return this.a=a,this.b=b,this.c=c,this.d=d,this.e="undefined"!=typeof e?e:this.e,this.f="undefined"!=typeof f?f:this.f,this},multiply:function(a,b,c,d,e,f){var g=this.a,h=this.b,i=this.c,j=this.d;return this.a=a*g+b*i,this.b=a*h+b*j,this.c=c*g+d*i,this.d=c*h+d*j,this.e=e*g+f*i+this.e,this.f=e*h+f*j+this.f,this},scale:function(a,b){return this.a*=a,this.d*=b,this.e*=a,this.f*=b,this},rotate:function(a){if(0!==a){var b=Math.cos(a),c=Math.sin(a),d=this.a,e=this.b,f=this.c,g=this.d,h=this.e,i=this.f;this.a=d*b-e*c,this.b=d*c+e*b,this.c=f*b-g*c,this.d=f*c+g*b,this.e=h*b-i*c,this.f=h*c+i*b}return this},translate:function(a,b){return this.e+=a,this.f+=b,this},translateV:function(a){return this.translate(a.x,a.y)},isIdentity:function(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.e&&0===this.f},clone:function(){return new me.Matrix2d(this.a,this.b,this.c,this.d,this.e,this.f)}})}(),function(){me.Matrix3d=Object.extend({init:function(a){this.val=new me.Float32Array(9),a?this.copy(a):this.identity()},adjoint:function(){var a=this.val,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return a[0]=f*j-g*i,a[1]=d*i-c*j,a[2]=c*g-d*f,a[3]=g*h-e*j,a[4]=b*j-d*h,a[5]=d*e-b*g,a[6]=e*i-f*h,a[7]=c*h-b*i,a[8]=b*f-c*e,this},clone:function(){return new me.Matrix3d(this)},copy:function(a){var b=this.val,c=a.val;return b[0]=c[0],b[1]=c[1],b[2]=c[2],b[3]=c[3],b[4]=c[4],b[5]=c[5],b[6]=c[6],b[7]=c[7],b[8]=c[8],this},determinant:function(){var a=this.val,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)},identity:function(){var a=this.val;a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1},invert:function(){var a=this.val,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=j*f-g*i,l=-j*e+g*h,m=i*e-f*h,n=b*k+c*l+d*m;return n?(n=1/n,a[0]=k*n,a[1]=(-j*c+d*i)*n,a[2]=(g*c-d*f)*n,a[3]=l*n,a[4]=(j*b-d*h)*n,a[5]=(-g*b+d*e)*n,a[6]=m*n,a[7]=(-i*b+c*h)*n,a[8]=(f*b-c*e)*n,this):null},multiply:function(a){var b=this.val,c=a.val,d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return b[0]=m*d+n*g+o*j,b[1]=m*e+n*h+o*k,b[2]=m*f+n*i+o*l,b[3]=p*d+q*g+r*j,b[4]=p*e+q*h+r*k,b[5]=p*f+q*i+r*l,b[6]=s*d+t*g+u*j,b[7]=s*e+t*h+u*k,b[8]=s*f+t*i+u*l,this},rotate:function(a){var b=this.val,c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=Math.sin(a),j=Math.cos(a);return b[0]=j*c+i*f,b[1]=j*d+i*g,b[2]=j*e+i*h,b[3]=j*f-i*c,b[4]=j*g-i*d,b[5]=j*h-i*e,this},scale:function(a,b){var c=this.val;return c[0]=a*c[0],c[1]=a*c[1],c[2]=a*c[2],c[3]=b*c[3],c[4]=b*c[4],c[5]=b*c[5],this},set:function(){var a=this.val;a[0]=arguments[0],a[1]=arguments[1],a[2]=arguments[2],a[3]=arguments[3],a[4]=arguments[4],a[5]=arguments[5],a[6]=arguments[6],a[7]=arguments[7],a[8]=arguments[8]},translate:function(a,b){var c=this.val;c[6]=a*c[0]+b*c[3]+c[6],c[7]=a*c[1]+b*c[4]+c[7],c[8]=a*c[2]+b*c[5]+c[8]},transform:function(a,b,c,d,e,f){var g=this.val;g[0]=a,g[1]=b,g[2]=e,g[3]=c,g[4]=d,g[5]=f},transpose:function(){var a=this.val,b=a[1],c=a[2],d=a[5];return a[1]=a[3],a[2]=a[6],a[3]=b,a[5]=a[7],a[6]=c,a[7]=d,this}})}(),function(){me.Body=me.Rect.extend({init:function(a,b){this.entity=a,this.shapes=b||[],this.collisionMask=me.collision.types.ALL_OBJECT,this.collisionType=me.collision.types.ENEMY_OBJECT,"undefined"==typeof this.vel&&(this.vel=new me.Vector2d),this.vel.set(0,0),"undefined"==typeof this.accel&&(this.accel=new me.Vector2d),this.accel.set(0,0),"undefined"==typeof this.friction&&(this.friction=new me.Vector2d),this.friction.set(0,0),"undefined"==typeof this.maxVel&&(this.maxVel=new me.Vector2d),this.maxVel.set(1e3,1e3),this.gravity="undefined"!=typeof me.sys.gravity?me.sys.gravity:.98,this.falling=!1,this.jumping=!0,this._super(me.Rect,"init",[0,0,a.width,a.height])},addShape:function(a){return this.shapes.push("Rectangle"===a.shapeType?a.toPolygon():a),this.updateBounds(),this.shapes.length},getShape:function(a){return this.shapes[a]},removeShape:function(a){return this.shapes.remove(a),this.updateBounds(),this.shapes.length},removeShapeAt:function(a){return this.removeShape(this.getShape(a))},setCollisionMask:function(a){this.collisionMask=a},respondToCollision:function(a){var b=a.overlapV;this.entity.pos.sub(b),0!==b.x&&(this.vel.x=~~(.5+this.vel.x-b.x)||0),0!==b.y&&(this.vel.y=~~(.5+this.vel.y-b.y)||0,this.falling=b.y>=1,this.jumping=b.y<=-1),this.entity.updateBounds()},updateBounds:function(){if(this.shapes.length>0){var a=this.shapes[0].getBounds();this.pos.setV(a.pos),this.resize(a.width,a.height);for(var b=1;b<this.shapes.length;b++)this.union(this.shapes[b].getBounds())}return this.entity.updateBounds(),this},setVelocity:function(a,b){this.accel.x=0!==a?a:this.accel.x,this.accel.y=0!==b?b:this.accel.y,this.setMaxVelocity(a,b)},setMaxVelocity:function(a,b){this.maxVel.x=a,this.maxVel.y=b},setFriction:function(a,b){this.friction.x=a||0,this.friction.y=b||0},computeVelocity:function(a){this.gravity&&(a.y+=this.gravity*me.timer.tick,this.falling=a.y>0,this.jumping=this.falling?!1:this.jumping),this.friction.x&&(a.x=me.utils.applyFriction(a.x,this.friction.x)),this.friction.y&&(a.y=me.utils.applyFriction(a.y,this.friction.y)),0!==a.y&&(a.y=a.y.clamp(-this.maxVel.y,this.maxVel.y)),0!==a.x&&(a.x=a.x.clamp(-this.maxVel.x,this.maxVel.x))},update:function(){return this.computeVelocity(this.vel),this.entity.pos.add(this.vel),this.entity.updateBounds(),0!==this.vel.x||0!==this.vel.y},destroy:function(){this.entity=null,this.shapes=[]}}),me.Body.Error=me.Error.extend({init:function(a){me.Error.prototype.init.apply(this,[a]),this.name="me.Body.Error"}})}(),function(){function a(a,b,c,d){this.max_objects=b||4,this.max_levels=c||4,this.level=d||0,this.bounds=a,this.objects=[],this.nodes=[]}var b=[],c=function(a,c,d,e){if(b.length>0){var f=b.pop();return f.bounds=a,f.max_objects=c||4,f.max_levels=d||4,f.level=e||0,f}return new me.QuadTree(a,c,d,e)},d=function(a){b.push(a)};a.prototype.split=function(){var a=this.level+1,b=~~(.5+this.bounds.width/2),d=~~(.5+this.bounds.height/2),e=~~(.5+this.bounds.pos.x),f=~~(.5+this.bounds.pos.y);this.nodes[0]=c({pos:{x:e+b,y:f},width:b,height:d},this.max_objects,this.max_levels,a),this.nodes[1]=c({pos:{x:e,y:f},width:b,height:d},this.max_objects,this.max_levels,a),this.nodes[2]=c({pos:{x:e,y:f+d},width:b,height:d},this.max_objects,this.max_levels,a),this.nodes[3]=c({pos:{x:e+b,y:f+d},width:b,height:d},this.max_objects,this.max_levels,a)},a.prototype.getIndex=function(a){var b=-1,c=this.bounds.pos.x+this.bounds.width/2,d=this.bounds.pos.y+this.bounds.height/2,e=a.pos.y<d&&a.pos.y+a.height<d,f=a.pos.y>d;return a.pos.x<c&&a.pos.x+a.width<c?e?b=1:f&&(b=2):a.pos.x>c&&(e?b=0:f&&(b=3)),b},a.prototype.insertContainer=function(a){for(var b,c=a.children.length;c--,b=a.children[c];)b instanceof me.Container?this.insertContainer(b):"undefined"!=typeof b.body&&this.insert(b)},a.prototype.insert=function(a){var b=-1;if(this.nodes.length>0&&(b=this.getIndex(a.getBounds()),-1!==b))return void this.nodes[b].insert(a);if(this.objects.push(a),this.objects.length>this.max_objects&&this.level<this.max_levels){0===this.nodes.length&&this.split();
for(var c=0;c<this.objects.length;)b=this.getIndex(this.objects[c].getBounds()),-1!==b?this.nodes[b].insert(this.objects.splice(c,1)[0]):c+=1}},a.prototype.retrieve=function(a){var b=this.objects;if(this.nodes.length>0){var c=this.getIndex(a.getBounds());if(-1!==c)b=b.concat(this.nodes[c].retrieve(a));else for(var d=0;d<this.nodes.length;d+=1)b=b.concat(this.nodes[d].retrieve(a))}return b},a.prototype.clear=function(a){this.objects=[];for(var b=0;b<this.nodes.length;b+=1)this.nodes[b].clear(a),d(this.nodes[b]);this.nodes=[],"undefined"!=typeof a&&(this.bounds.pos.x=a.pos.x,this.bounds.pos.y=a.pos.y,this.bounds.width=a.width,this.bounds.height=a.height)},me.QuadTree=a}(),function(){function a(a,b,c){for(var d=Number.MAX_VALUE,e=-Number.MAX_VALUE,f=a.length,g=0;f>g;g++){var h=a[g].dotProduct(b);d>h&&(d=h),h>e&&(e=h)}c[0]=d,c[1]=e}function b(b,c,d,e,f,h){var j=i.pop(),k=i.pop(),l=g.pop().copy(c).sub(b),m=l.dotProduct(f);if(a(d,f,j),a(e,f,k),k[0]+=m,k[1]+=m,j[0]>k[1]||k[0]>j[1])return g.push(l),i.push(j),i.push(k),!0;if(h){var n=0;if(j[0]<k[0])if(h.aInB=!1,j[1]<k[1])n=j[1]-k[0],h.bInA=!1;else{var o=j[1]-k[0],p=k[1]-j[0];n=p>o?o:-p}else if(h.bInA=!1,j[1]>k[1])n=j[0]-k[1],h.aInB=!1;else{var q=j[1]-k[0],r=k[1]-j[0];n=r>q?q:-r}var s=Math.abs(n);s<h.overlap&&(h.overlap=s,h.overlapN.copy(f),0>n&&h.overlapN.reverse())}return g.push(l),i.push(j),i.push(k),!1}function c(a,b){var c=a.length2(),g=b.dotProduct(a);return 0>g?d:g>c?f:e}for(var d=-1,e=0,f=1,g=[],h=0;10>h;h++)g.push(new me.Vector2d);for(var i=[],j=0;5>j;j++)i.push([]);me.collision=function(){var a={};return a.quadTree=null,a.maxDepth=4,a.maxChildren=8,a.bounds=null,a.types={NO_OBJECT:0,PLAYER_OBJECT:1,NPC_OBJECT:2,ENEMY_OBJECT:4,COLLECTABLE_OBJECT:8,ACTION_OBJECT:16,PROJECTILE_OBJECT:32,WORLD_SHAPE:64,ALL_OBJECT:4294967295},a.init=function(){a.bounds=me.game.viewport.clone(),a.quadTree=new me.QuadTree(a.bounds,a.maxChildren,a.maxDepth),me.event.subscribe(me.event.LEVEL_LOADED,function(){me.collision.bounds=me.game.world.clone(),me.collision.quadTree.clear(me.collision.bounds)})},a.ResponseObject=function(){this.a=null,this.b=null,this.overlapN=new me.Vector2d,this.overlapV=new me.Vector2d,this.aInB=!0,this.bInA=!0,this.indexShapeA=-1,this.indexShapeB=-1,this.overlap=Number.MAX_VALUE},a.ResponseObject.prototype.clear=function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this.indexShapeA=-1,this.indexShapeB=-1,this},a.response=new a.ResponseObject,a.shouldCollide=function(a,b){return a.body&&b.body&&0!==(a.body.collisionMask&b.body.collisionType)&&0!==(a.body.collisionType&b.body.collisionMask)},a.check=function(b,c){for(var d,e=0,f=c||a.response,g=a.quadTree.retrieve(b),h=g.length;h--,d=g[h];)if((d.inViewport||d.alwaysUpdate)&&d!==b&&a.shouldCollide(b,d)&&b.getBounds().overlaps(d.getBounds())){var i=0;do{var j=b.body.getShape(i),k=0;do{var l=d.body.getShape(k);a["test"+j.shapeType+l.shapeType].call(this,b,j,d,l,f.clear())===!0&&(e++,f.indexShapeA=i,f.indexShapeB=k,b.onCollision(f,d)!==!1&&b.body.respondToCollision.call(b.body,f),d.onCollision(f,b)!==!1&&d.body.respondToCollision.call(d.body,f)),k++}while(k<d.body.shapes.length);i++}while(i<b.body.shapes.length)}return e>0},a.testPolygonPolygon=function(a,c,d,e,f){var h,i=c.points,j=c.normals,k=j.length,l=e.points,m=e.normals,n=m.length,o=g.pop().copy(a.pos).add(c.pos),p=g.pop().copy(d.pos).add(e.pos);for(h=0;k>h;h++)if(b(o,p,i,l,j[h],f))return g.push(o),g.push(p),!1;for(h=0;n>h;h++)if(b(o,p,i,l,m[h],f))return g.push(o),g.push(p),!1;return f&&(f.a=a,f.b=d,f.overlapV.copy(f.overlapN).scale(f.overlap)),g.push(o),g.push(p),!0},a.testEllipseEllipse=function(a,b,c,d,e){var f=g.pop().copy(c.pos).add(d.pos).sub(a.pos).add(b.pos),h=b.radius,i=d.radius,j=h+i,k=j*j,l=f.length2();if(l>k)return g.push(f),!1;if(e){var m=Math.sqrt(l);e.a=a,e.b=c,e.overlap=j-m,e.overlapN.copy(f.normalize()),e.overlapV.copy(f).scale(e.overlap),e.aInB=i>=h&&i-h>=m,e.bInA=h>=i&&h-i>=m}return g.push(f),!0},a.testPolygonEllipse=function(a,b,e,h,i){for(var j=g.pop().copy(e.pos).add(h.pos).sub(a.pos).add(b.pos),k=h.radius,l=k*k,m=b.points,n=b.edges,o=n.length,p=g.pop(),q=g.pop(),r=g.pop(),s=0,t=0;o>t;t++){var u=t===o-1?0:t+1,v=0===t?o-1:t-1,w=0,x=null;p.copy(n[t]),r.copy(j).sub(m[t]),i&&r.length2()>l&&(i.aInB=!1);var y=c(p,r);if(y===d){p.copy(n[v]);var z=g.pop().copy(j).sub(m[v]);if(y=c(p,z),y===f){if(s=r.length(),s>k)return g.push(j),g.push(p),g.push(r),g.push(z),!1;i&&(i.bInA=!1,x=r.normalize(),w=k-s)}g.push(z)}else if(y===f){if(p.copy(n[u]),r.copy(j).sub(m[u]),y=c(p,r),y===d){if(s=r.length(),s>k)return g.push(j),g.push(p),g.push(r),!1;i&&(i.bInA=!1,x=r.normalize(),w=k-s)}}else{q.copy(b.normals[t]),s=r.dotProduct(q);var A=Math.abs(s);if(s>0&&A>k)return g.push(j),g.push(q),g.push(r),!1;i&&(x=q,w=k-s,(s>=0||2*k>w)&&(i.bInA=!1))}x&&i&&Math.abs(w)<Math.abs(i.overlap)&&(i.overlap=w,i.overlapN.copy(x))}return i&&(i.a=a,i.b=e,i.overlapV.copy(i.overlapN).scale(i.overlap)),g.push(j),g.push(p),g.push(q),g.push(r),!0},a.testEllipsePolygon=function(b,c,d,e,f){var g=a.testPolygonEllipse(d,e,b,c,f);if(g&&f){var h=f.a,i=f.aInB;f.overlapN.reverse(),f.overlapV.reverse(),f.a=f.b,f.b=h,f.aInB=f.bInA,f.bInA=i}return g},a}()}(),function(){me.Renderable=me.Rect.extend({init:function(a,b,c,d){this.isRenderable=!0,this.GUID=void 0,this.inViewport=!1,this.alwaysUpdate=!1,this.updateWhenPaused=!1,this.isPersistent=!1,this.floating=!1,this.z=0,this.anchorPoint=new me.Vector2d,this.alpha=1,me.Rect.prototype.init.apply(this,[a,b,c,d]),this.anchorPoint.set(.5,.5),this.setOpacity(1)},getOpacity:function(){return this.alpha},setOpacity:function(a){"number"==typeof a&&(this.alpha=a.clamp(0,1),this.alpha!==this.alpha&&(this.alpha=1))},update:function(){return!1},draw:function(a,b){me.Rect.prototype.draw.apply(this,[a,b])}}),me.Renderable.Error=me.Error.extend({init:function(a){me.Error.prototype.init.apply(this,[a]),this.name="me.Renderable.Error"}})}(),function(){me.Sprite=me.Renderable.extend({init:function(a,b,c,d,e){this._scale=new me.Vector2d,this.scaleFlag=!1,this.lastflipX=!1,this.lastflipY=!1,this.z=0,this.offset=new me.Vector2d,this.angle=0,this._sourceAngle=0,this.image=null,this.flickering=!1,this.flickerDuration=0,this.flickercb=null,this.flickerState=!1,this.isSprite=!0,me.Renderable.prototype.init.apply(this,[a,b,d||c.width,e||c.height]),this.image=c,this._scale.set(1,1),this.lastflipX=this.lastflipY=!1,this.scaleFlag=!1,this.offset.set(0,0),this.isPersistent=!1,this.flickering=!1},setTransparency:function(a){a="#"===a.charAt(0)?a.substring(1,7):a,this.image=me.video.renderer.applyRGBFilter(this.image,"transparent",a.toUpperCase()).canvas},isFlickering:function(){return this.flickering},flicker:function(a,b){this.flickerDuration=a,this.flickerDuration<=0?(this.flickering=!1,this.flickercb=null):this.flickering||(this.flickercb=b,this.flickering=!0)},flipX:function(a){a!==this.lastflipX&&(this.lastflipX=a,this._scale.x=-this._scale.x,this.scaleFlag=1!==this._scale.x||1!==this._scale.y)},flipY:function(a){a!==this.lastflipY&&(this.lastflipY=a,this._scale.y=-this._scale.y,this.scaleFlag=1!==this._scale.x||1!==this._scale.y)},scale:function(a,b){var c=a,d="undefined"==typeof b?a:b;c>0&&(this._scale.x=this._scale.x<0?-c:c),d>0&&(this._scale.y=this._scale.y<0?-d:d),this.scaleFlag=1!==this._scale.x||1!==this._scale.y},scaleV:function(a){this.scale(a.x,a.y)},update:function(a){return this.flickering?(this.flickerDuration-=a,this.flickerDuration<0&&(this.flickercb&&this.flickercb(),this.flicker(-1)),!0):!1},draw:function(a){if(!this.flickering||(this.flickerState=!this.flickerState,this.flickerState)){a.save(),a.setGlobalAlpha(a.globalAlpha()*this.getOpacity());var b=~~this.pos.x,c=~~this.pos.y,d=this.width,e=this.height,f=this.angle+this._sourceAngle;if(this.scaleFlag||0!==f){var g=d*this.anchorPoint.x,h=e*this.anchorPoint.y;a.translate(b+g,c+h),this.scaleFlag&&a.scale(this._scale.x,this._scale.y),0!==f&&a.rotate(f),0!==this._sourceAngle?(d=this.height,e=this.width,b=-h,c=-g):(b=-g,c=-h)}a.drawImage(this.image,this.offset.x,this.offset.y,d,e,b,c,d,e),a.restore()}},destroy:function(){this.onDestroyEvent.apply(this,arguments)},onDestroyEvent:function(){}})}(),function(){me.AnimationSheet=me.Sprite.extend({init:function(a,b,c){this.spacing=0,this.margin=0,this.animationpause=!1,this.animationspeed=100,this.anim={},this.resetAnim=null,this.current=null,this.animationspeed=100,this.spacing=c.spacing||0,this.margin=c.margin||0;var d=c.region||c.image;me.Sprite.prototype.init.apply(this,[a,b,c.image,c.spritewidth,c.spriteheight,this.spacing,this.margin]),this.textureAtlas=null,this.atlasIndices=null,this.buildLocalAtlas(c.atlas,c.atlasIndices,d),this.addAnimation("default",null),this.setCurrentAnimation("default")},buildLocalAtlas:function(a,b,c){if((null===c||"undefined"==typeof c)&&(c=this.image),"undefined"!=typeof a)this.textureAtlas=a,this.atlasIndices=b;else{if(this.textureAtlas=[],(c.width-this.margin)%(this.width+this.spacing)!==0||(c.height-this.margin)%(this.height+this.spacing)!==0)throw new me.Renderable.Error("Animation sheet for image: "+c.src+" is not divisible by "+(this.width+this.spacing)+"x"+(this.height+this.spacing));var d=new me.Vector2d(~~((c.width-this.margin)/(this.width+this.spacing)),~~((c.height-this.margin)/(this.height+this.spacing))),e=0,f=0;c.offset&&(e=c.offset.x,f=c.offset.y);for(var g=0,h=d.x*d.y;h>g;g++)this.textureAtlas[g]={name:""+g,offset:new me.Vector2d(this.margin+(this.spacing+this.width)*(g%d.x)+e,this.margin+(this.spacing+this.height)*~~(g/d.x)+f),width:this.width,height:this.height,hWidth:this.width/2,hHeight:this.height/2,angle:0}}},addAnimation:function(a,b,c){if(this.anim[a]={name:a,frame:[],idx:0,length:0,animationspeed:c||this.animationspeed,nextFrame:0},null==b){b=[];var d=0;this.textureAtlas.forEach(function(){b[d]=d++})}for(var e=0,f=b.length;f>e;e++)if("number"==typeof b[e])this.anim[a].frame[e]=this.textureAtlas[b[e]];else{if(null===this.atlasIndices)throw new me.Renderable.Error("string parameters for addAnimation are only allowed for TextureAtlas");this.anim[a].frame[e]=this.textureAtlas[this.atlasIndices[b[e]]]}this.anim[a].length=this.anim[a].frame.length},setCurrentAnimation:function(a,b){if(!this.anim[a])throw new me.Renderable.Error("animation id '"+a+"' not defined");this.current=this.anim[a],this.resetAnim=b||null,this.setAnimationFrame(this.current.idx),this.current.nextFrame=this.current.animationspeed},isCurrentAnimation:function(a){return this.current.name===a},setAnimationFrame:function(a){this.current.idx=(a||0)%this.current.length;var b=this.current.frame[this.current.idx];this.offset=b.offset,this.width=b.width,this.height=b.height,this.hWidth=b.hWidth,this.hHeight=b.hHeight,this._sourceAngle=b.angle},getCurrentAnimationFrame:function(){return this.current.idx},update:function(a){if(!this.animationpause&&(this.current.nextFrame-=a,this.current.nextFrame<=0)){if(this.setAnimationFrame(++this.current.idx),0===this.current.idx&&this.resetAnim)if("string"==typeof this.resetAnim)this.setCurrentAnimation(this.resetAnim);else if("function"==typeof this.resetAnim&&this.resetAnim()===!1)return this.current.idx=this.current.length-1,this.setAnimationFrame(this.current.idx),me.Sprite.prototype.update.apply(this,[a]),!1;return this.current.nextFrame=this.current.animationspeed,me.Sprite.prototype.update.apply(this,[a])||!0}return me.Sprite.prototype.update.apply(this,[a])}})}(),function(){var a=-(Math.PI/2);me.TextureAtlas=Object.extend({init:function(a,b){if(this.format=null,this.texture=b||null,this.atlas=a||null,a&&a.meta){if(a.meta.app.contains("texturepacker"))if(this.format="texturepacker","undefined"==typeof b){var c=me.utils.getBasename(a.meta.image);if(this.texture=me.loader.getImage(c),null===this.texture)throw new me.TextureAtlas.Error("Atlas texture '"+c+"' not found")}else this.texture=b;if(a.meta.app.contains("ShoeBox")){if(!a.meta.exporter||!a.meta.exporter.contains("melonJS"))throw new me.TextureAtlas.Error("ShoeBox requires the JSON exporter : https://github.com/melonjs/melonJS/tree/master/media/shoebox_JSON_export.sbx");this.format="ShoeBox",this.texture=b}this.atlas=this.initFromTexturePacker(a)}if(null===this.atlas)throw new me.TextureAtlas.Error("texture atlas format not supported")},initFromTexturePacker:function(a){var b={};return a.frames.forEach(function(a){a.hasOwnProperty("filename")&&(b[a.filename]={frame:new me.Rect(a.frame.x,a.frame.y,a.frame.w,a.frame.h),source:new me.Rect(a.spriteSourceSize.x,a.spriteSourceSize.y,a.spriteSourceSize.w,a.spriteSourceSize.h),rotated:a.rotated===!0,trimmed:a.trimmed===!0})}),b},getTexture:function(){return this.texture},getRegion:function(b){var c=this.atlas[b];return c?{name:b,pos:c.source.pos.clone(),offset:c.frame.pos.clone(),width:c.frame.width,height:c.frame.height,hWidth:c.frame.width/2,hHeight:c.frame.height/2,angle:c.rotated===!0?a:0}:null},createSpriteFromName:function(a){var b=this.getRegion(a);if(b){var c=new me.Sprite(0,0,this.getTexture(),b.width,b.height);return c.offset.setV(b.offset),c._sourceAngle=b.angle,c}throw new me.TextureAtlas.Error("TextureAtlas - region for "+a+" not found")},createAnimationFromName:function(a){for(var b=[],c={},d=0;d<a.length;++d)if(b[d]=this.getRegion(a[d]),c[a[d]]=d,null==b[d])throw new me.TextureAtlas.Error("TextureAtlas - region for "+a[d]+" not found");return new me.AnimationSheet(0,0,{image:this.texture,spritewidth:0,spriteheight:0,margin:0,spacing:0,atlas:b,atlasIndices:c})}}),me.TextureAtlas.Error=me.Error.extend({init:function(a){me.Error.prototype.init.apply(this,[a]),this.name="me.TextureAtlas.Error"}})}(),function(){var a=Math.min,b=Math.max;me.Viewport=me.Renderable.extend({init:function(a,b,c,d){this.AXIS={NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},this.bounds=null,this.deadzone=null,this.target=null,this.follow_axis=0,this._shake=null,this._fadeIn=null,this._fadeOut=null,this.screenX=0,this.screenY=0,me.Renderable.prototype.init.apply(this,[a,b,c-a,d-b]),this.bounds=new me.Rect(-1/0,-1/0,1/0,1/0),this.offset=new me.Vector2d,this.target=null,this.follow_axis=this.AXIS.NONE,this._shake={intensity:0,duration:0,axis:this.AXIS.BOTH,onComplete:null},this._fadeOut={color:null,duration:0,tween:null},this._fadeIn={color:null,duration:0,tween:null},this.setDeadzone(this.width/6,this.height/6)},_followH:function(c){var d=this.pos.x;return c.x-this.pos.x>this.deadzone.right?this.pos.x=~~a(c.x-this.deadzone.right,this.bounds.width-this.width):c.x-this.pos.x<this.deadzone.pos.x&&(this.pos.x=~~b(c.x-this.deadzone.pos.x,this.bounds.pos.x)),d!==this.pos.x},_followV:function(c){var d=this.pos.y;return c.y-this.pos.y>this.deadzone.bottom?this.pos.y=~~a(c.y-this.deadzone.bottom,this.bounds.height-this.height):c.y-this.pos.y<this.deadzone.pos.y&&(this.pos.y=~~b(c.y-this.deadzone.pos.y,this.bounds.pos.y)),d!==this.pos.y},reset:function(a,b){this.pos.x=a||0,this.pos.y=b||0,this.target=null,this.follow_axis=null},setDeadzone:function(a,b){null===this.deadzone&&(this.deadzone=new me.Rect(0,0,0,0)),this.deadzone.pos.set(~~((this.width-a)/2),~~((this.height-b)/2-.25*b)),this.deadzone.resize(a,b),this.updateTarget()},setBounds:function(a,b,c,d){this.bounds.pos.set(a,b),this.bounds.resize(c,d)},follow:function(a,b){if(a instanceof me.Entity)this.target=a.pos;else{if(!(a instanceof me.Vector2d))throw new me.Renderable.Error("invalid target for viewport.follow");this.target=a}this.follow_axis="undefined"==typeof b?this.AXIS.BOTH:b,this.updateTarget()},move:function(a,b){this.moveTo(~~(this.pos.x+a),~~(this.pos.y+b))},moveTo:function(a,b){this.pos.x=(~~a).clamp(this.bounds.pos.x,this.bounds.width-this.width),this.pos.y=(~~b).clamp(this.bounds.pos.y,this.bounds.height-this.height),me.event.publish(me.event.VIEWPORT_ONCHANGE,[this.pos])},updateTarget:function(){var a=!1;if(this.target)switch(this.follow_axis){case this.AXIS.NONE:break;case this.AXIS.HORIZONTAL:a=this._followH(this.target);break;case this.AXIS.VERTICAL:a=this._followV(this.target);break;case this.AXIS.BOTH:a=this._followH(this.target),a=this._followV(this.target)||a}return a},update:function(a){var b=this.updateTarget();return this._shake.duration>0&&(this._shake.duration-=a,this._shake.duration<=0?(this._shake.duration=0,this.offset.setZero(),"function"==typeof this._shake.onComplete&&this._shake.onComplete()):((this._shake.axis===this.AXIS.BOTH||this._shake.axis===this.AXIS.HORIZONTAL)&&(this.offset.x=(Math.random()-.5)*this._shake.intensity),(this._shake.axis===this.AXIS.BOTH||this._shake.axis===this.AXIS.VERTICAL)&&(this.offset.y=(Math.random()-.5)*this._shake.intensity)),b=!0),b===!0&&me.event.publish(me.event.VIEWPORT_ONCHANGE,[this.pos]),(null!=this._fadeIn.tween||null!=this._fadeOut.tween)&&(b=!0),b},shake:function(a,b,c,d){this._shake.duration>0||(this._shake={intensity:a,duration:b,axis:c||this.AXIS.BOTH,onComplete:d})},fadeOut:function(a,b,c){this._fadeOut.color=me.pool.pull("me.Color").parseHex(a),this._fadeOut.color.alpha=1,this._fadeOut.duration=b||1e3,this._fadeOut.tween=me.pool.pull("me.Tween",this._fadeOut.color).to({alpha:0},this._fadeOut.duration).onComplete(c||null),this._fadeOut.tween.start()},fadeIn:function(a,b,c){this._fadeIn.color=me.pool.pull("me.Color").parseHex(a),this._fadeIn.color.alpha=0,this._fadeIn.duration=b||1e3,this._fadeIn.tween=me.pool.pull("me.Tween",this._fadeIn.color).to({alpha:1},this._fadeIn.duration).onComplete(c||null),this._fadeIn.tween.start()},getWidth:function(){return this.width},getHeight:function(){return this.height},focusOn:function(a){var b=a.getBounds();this.moveTo(a.pos.x+b.pos.x+b.hWidth,a.pos.y+b.pos.y+b.hHeight)},isVisible:function(a){return a.overlaps(this)},localToWorld:function(a,b,c){return c=c||new me.Vector2d,c.set(a,b).add(this.pos).sub(me.game.currentLevel.pos)},worldToLocal:function(a,b,c){return c=c||new me.Vector2d,c.set(a,b).sub(this.pos).add(me.game.currentLevel.pos)},draw:function(){this._fadeIn.tween&&(me.video.renderer.clearSurface(null,this._fadeIn.color.toRGBA()),1===this._fadeIn.color.alpha&&(this._fadeIn.tween=null,me.pool.push(this._fadeIn.color),this._fadeIn.color=null)),this._fadeOut.tween&&(me.video.renderer.clearSurface(null,this._fadeOut.color.toRGBA()),0===this._fadeOut.color.alpha&&(this._fadeOut.tween=null,me.pool.push(this._fadeOut.color),this._fadeOut.color=null))}})}(),function(){me.GUI_Object=me.Sprite.extend({init:function(a,b,c){this.isClickable=!0,this.holdThreshold=250,this.isHoldable=!1,this.holdTimeout=null,this.updated=!1,this.released=!0,me.Sprite.prototype.init.apply(this,[a,b,"string"==typeof c.image?me.loader.getImage(c.image):c.image,c.spritewidth,c.spriteheight]),this.floating=!0,me.input.registerPointerEvent("pointerdown",this,this.clicked.bind(this)),me.input.registerPointerEvent("pointerup",this,this.release.bind(this))},update:function(){return this.updated?(this.released||(this.updated=!1),!0):!1},clicked:function(a){return this.isClickable?(this.updated=!0,this.isHoldable&&(null!==this.holdTimeout&&me.timer.clearTimeout(this.holdTimeout),this.holdTimeout=me.timer.setTimeout(this.hold.bind(this),this.holdThreshold,!1),this.released=!1),this.onClick(a)):void 0},onClick:function(){return!1},release:function(a){return this.released=!0,me.timer.clearTimeout(this.holdTimeout),this.onRelease(a)},onRelease:function(){return!1},hold:function(){me.timer.clearTimeout(this.holdTimeout),this.released||this.onHold()},onHold:function(){},onDestroyEvent:function(){me.input.releasePointerEvent("pointerdown",this),me.input.releasePointerEvent("pointerup",this),me.timer.clearTimeout(this.holdTimeout)}})}(),function(){var a=function(a,b){a.ancestor&&a.ancestor.removeChildNow(a,b)},b=new me.Rect(0,0,0,0),c=0;me.Container=me.Renderable.extend({init:function(a,b,c,d){this.pendingSort=null,this.transform=new me.Matrix2d,me.Renderable.prototype.init.apply(this,[a,b,c||1/0,d||1/0]),this.bounds=void 0,this.children=[],this.sortOn=me.game.sortOn,this.autoSort=!0,this.transform.identity(),this.drawCount=0},addChild:function(a,b){return"undefined"!=typeof a.ancestor?a.ancestor.removeChildNow(a):a.isRenderable&&(a.GUID=me.utils.createGUID()),"number"==typeof b&&(a.z=b),"undefined"==typeof a.z&&(a.z=this.children.length),a.ancestor=this,this.children.push(a),this.autoSort===!0&&this.sort(),"function"==typeof a.onActivateEvent&&a.onActivateEvent(),a},addChildAt:function(a,b){if(b>=0&&b<this.children.length)return"undefined"!=typeof a.ancestor?a.ancestor.removeChildNow(a):a.isRenderable&&(a.GUID=me.utils.createGUID()),a.ancestor=this,this.children.splice(b,0,a),"function"==typeof a.onActivateEvent&&a.onActivateEvent(),a;throw new me.Container.Error("Index ("+b+") Out Of Bounds for addChildAt()")},swapChildren:function(a,b){var c=this.getChildIndex(a),d=this.getChildIndex(b);if(-1===c||-1===d)throw new me.Container.Error(a+" Both the supplied childs must be a child of the caller "+this);var e=a.z;a.z=b.z,b.z=e,this.children[c]=b,this.children[d]=a},getChildAt:function(a){if(a>=0&&a<this.children.length)return this.children[a];throw new me.Container.Error("Index ("+a+") Out Of Bounds for getChildAt()")},getChildIndex:function(a){return this.children.indexOf(a)},hasChild:function(a){return this===a.ancestor},getChildByProp:function(a,b){function c(a,c){"string"==typeof a[c]?a[c].match(e)&&d.push(a):a[c]===b&&d.push(a)}for(var d=[],e=new RegExp(b,"i"),f=this.children.length-1;f>=0;f--){var g=this.children[f];g instanceof me.Container?(c(g,a),d=d.concat(g.getChildByProp(a,b))):c(g,a)}return d},getChildByName:function(a){return this.getChildByProp("name",a)},getChildByGUID:function(a){var b=this.getChildByProp("GUID",a);return b.length>0?b[0]:null},getBounds:function(){this.bounds?(this.bounds.pos.set(1/0,1/0),this.bounds.resize(-1/0,-1/0)):this.bounds=new me.Rect(1/0,1/0,-1/0,-1/0);for(var a,b,c=this.children.length;c--,b=this.children[c];)b.isRenderable&&(a=b.getBounds(),null!==a&&this.bounds.union(a));return this.bounds},removeChild:function(b,c){b.ancestor&&a.defer(this,b,c)},removeChildNow:function(a,b){if(!this.hasChild(a))throw new me.Container.Error(a+" The supplied child must be a child of the caller "+this);a.ancestor=void 0,"function"==typeof a.onDeactivateEvent&&a.onDeactivateEvent(),b||("function"==typeof a.destroy&&a.destroy(),me.pool.push(a)),this.children.splice(this.getChildIndex(a),1)},setChildsProperty:function(a,b,c){for(var d=this.children.length;d>=0;d--){var e=this.children[d];c===!0&&e instanceof me.Container&&e.setChildsProperty(a,b,c),e[a]=b}},moveUp:function(a){var b=this.getChildIndex(a);b-1>=0&&this.swapChildren(a,this.getChildAt(b-1))},moveDown:function(a){var b=this.getChildIndex(a);b+1<this.children.length&&this.swapChildren(a,this.getChildAt(b+1))},moveToTop:function(a){var b=this.getChildIndex(a);b>0&&(this.children.splice(0,0,this.children.splice(b,1)[0]),a.z=this.children[1].z+1)},moveToBottom:function(a){var b=this.getChildIndex(a);b<this.children.length-1&&(this.children.splice(this.children.length-1,0,this.children.splice(b,1)[0]),a.z=this.children[this.children.length-2].z-1)},sort:function(a){if(null===this.pendingSort){if(a===!0)for(var b,c=this.children.length;c--,b=this.children[c];)b instanceof me.Container&&b.sort(a);this.pendingSort=function(a){a.children.sort(a["_sort"+a.sortOn.toUpperCase()]),a.pendingSort=null,me.game.repaint()}.defer(this,this)}},_sortZ:function(a,b){return b.z-a.z},_sortX:function(a,b){var c=b.z-a.z;return c?c:(b.pos&&b.pos.x)-(a.pos&&a.pos.x)||0},_sortY:function(a,b){var c=b.z-a.z;return c?c:(b.pos&&b.pos.y)-(a.pos&&a.pos.y)||0},destroy:function(){this.pendingSort&&(clearTimeout(this.pendingSort),this.pendingSort=null);for(var a,b=this.children.length;b--,a=this.children[b];)a.isPersistent||this.removeChildNow(a);this.transform.identity()},update:function(a){for(var d,e,f,g,h,i=!1,j=!1,k=me.state.isPaused(),l=me.game.viewport,m=this.children.length;m--,h=this.children[m];)(!k||h.updateWhenPaused)&&(h.isRenderable?(j=c>0||h.floating,j&&c++,d=!j,d&&(g=h.getBounds(),e=g.pos.x,f=g.pos.y,b.translateV(g.pos),b.resize(g.width,g.height)),h.inViewport=j||l.isVisible(b),i|=(h.inViewport||h.alwaysUpdate)&&h.update(a),d&&b.translate(-e,-f),c>0&&c--):i|=h.update(a));return i},draw:function(a,b){var c=me.game.viewport,d=!1;this.drawCount=0,a.save(),a.transform(this.transform.a,this.transform.b,this.transform.c,this.transform.d,this.transform.e,this.transform.f),a.setGlobalAlpha(a.globalAlpha()*this.getOpacity()),a.translate(this.pos.x,this.pos.y);for(var e,f=this.children.length;f--,e=this.children[f];)d=e.floating,(e.inViewport||d)&&e.isRenderable&&(d===!0&&(a.save(),a.translate(c.screenX-this.pos.x,c.screenY-this.pos.y)),e.draw(a,b),d===!0&&a.restore(),this.drawCount++);a.restore()}}),me.Container.Error=me.Renderable.Error.extend({init:function(a){me.Renderable.Error.prototype.init.apply(this,[a]),this.name="me.Container.Error"}})}(),function(){me.ObjectSettings={name:null,image:null,transparent_color:null,spritewidth:null,spriteheight:null,type:null,collisionMask:4294967295},me.Entity=me.Renderable.extend({init:function(a,b,c){if(this.renderable=null,this.bounds=void 0,"number"!=typeof c.width||"number"!=typeof c.height)throw new me.Entity.Error("height and width properties are mandatory when passing settings parameters to an object entity");if(me.Renderable.prototype.init.apply(this,[a,b,c.width,c.height]),c.image){var d="object"==typeof c.image?c.image:me.loader.getImage(c.image);this.renderable=new me.AnimationSheet(0,0,{image:d,spritewidth:~~(c.spritewidth||c.width),spriteheight:~~(c.spriteheight||c.height),spacing:~~c.spacing,margin:~~c.margin}),c.transparent_color&&this.renderable.setTransparency(c.transparent_color)}if(this.name=c.name?c.name.toLowerCase():"",this.type=c.type,this.alive=!0,this.body=new me.Body(this,"function"==typeof c.getTMXShapes?c.getTMXShapes():[]),this.body.updateBounds(),"undefined"!=typeof c.collisionMask&&this.body.setCollisionMask(c.collisionMask),"undefined"!=typeof c.collisionType){if("undefined"==typeof me.collision.types[c.collisionType])throw new me.Entity.Error("Invalid value for the collisionType property");this.body.collisionType=me.collision.types[c.collisionType]}},getBounds:function(){return this.bounds},updateBounds:function(){return this.bounds||(this.bounds=new me.Rect(0,0,0,0)),this.bounds.pos.setV(this.pos).add(this.body.pos),this.bounds.resize(this.body.width,this.body.height),this.bounds},distanceTo:function(a){var b=this.pos.x+this.hWidth-(a.pos.x+a.hWidth),c=this.pos.y+this.hHeight-(a.pos.y+a.hHeight);return Math.sqrt(b*b+c*c)},distanceToPoint:function(a){var b=this.pos.x+this.hWidth-a.x,c=this.pos.y+this.hHeight-a.y;return Math.sqrt(b*b+c*c)},angleTo:function(a){var b=this.getBounds(),c=a.getBounds(),d=c.pos.x+c.hWidth-(b.pos.x+b.hWidth),e=c.pos.y+c.hHeight-(b.pos.y+b.hHeight);return Math.atan2(e,d)},angleToPoint:function(a){var b=this.getBounds(),c=a.x-(b.pos.x+b.hWidth),d=a.y-(b.pos.y+b.hHeight);return Math.atan2(d,c)},update:function(a){return this.renderable?this.renderable.update(a):!1},draw:function(a){if(this.renderable){var b=this.getBounds(),c=~~(.5+b.pos.x+this.anchorPoint.x*(b.width-this.renderable.width)),d=~~(.5+b.pos.y+this.anchorPoint.y*(b.height-this.renderable.height));a.translate(c,d),this.renderable.draw(a),a.translate(-c,-d)}},destroy:function(){this.renderable&&(this.renderable.destroy.apply(this.renderable,arguments),this.renderable=null),this.body.destroy.apply(this.body,arguments),this.body=null},onDestroyEvent:function(){},onCollision:function(){return!1}}),me.CollectableEntity=me.Entity.extend({init:function(a,b,c){me.Entity.prototype.init.apply(this,[a,b,c]),this.body.collisionType=me.collision.types.COLLECTABLE_OBJECT}}),me.LevelEntity=me.Entity.extend({init:function(a,b,c){me.Entity.prototype.init.apply(this,[a,b,c]),this.nextlevel=c.to,this.fade=c.fade,this.duration=c.duration,this.fading=!1,this.name="levelEntity",this.gotolevel=c.to,this.body.collisionType=me.collision.types.ACTION_OBJECT},onFadeComplete:function(){me.levelDirector.loadLevel(this.gotolevel),me.game.viewport.fadeOut(this.fade,this.duration)},goTo:function(a){this.gotolevel=a||this.nextlevel,this.fade&&this.duration?this.fading||(this.fading=!0,me.game.viewport.fadeIn(this.fade,this.duration,this.onFadeComplete.bind(this))):me.levelDirector.loadLevel(this.gotolevel)},onCollision:function(){return"levelEntity"===this.name&&this.goTo(),!1}}),me.Entity.Error=me.Renderable.Error.extend({init:function(a){me.Renderable.Error.prototype.init.apply(this,[a]),this.name="me.Entity.Error"}})}(),function(){me.ScreenObject=Object.extend({init:function(){},reset:function(){me.game.reset(),this.onResetEvent.apply(this,arguments)},destroy:function(){this.onDestroyEvent.apply(this,arguments)},onResetEvent:function(){},onDestroyEvent:function(){}}),function(){var a=0,b=me.agent.prefixed("requestAnimationFrame"),c=me.agent.prefixed("cancelAnimationFrame")||me.agent.prefixed("cancelRequestAnimationFrame");b&&c||(b=function(b){var c=window.performance.now(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e},c=function(a){window.clearTimeout(a)}),window.requestAnimationFrame=b,window.cancelAnimationFrame=c}(),me.state=function(){function a(){-1===i&&-1!==h&&(me.timer.reset(),i=window.requestAnimationFrame(d))}function b(){j&&-1!==h&&(me.timer.reset(),j=!1)}function c(){j=!0}function d(a){me.game.update(a),me.game.draw(),-1!==i&&(i=window.requestAnimationFrame(d))}function e(){window.cancelAnimationFrame(i),i=-1}function f(b){e(),k[h]&&k[h].screen.destroy(),k[b]&&(h=b,k[h].screen.reset.apply(k[h].screen,n),a(),m&&m(),me.game.repaint())}var g={},h=-1,i=-1,j=!1,k={},l={color:"",duration:0},m=null,n=null,o=0;return g.LOADING=0,g.MENU=1,g.READY=2,g.PLAY=3,g.GAMEOVER=4,g.GAME_END=5,g.SCORE=6,g.CREDITS=7,g.SETTINGS=8,g.USER=100,g.onPause=null,g.onResume=null,g.onStop=null,g.onRestart=null,g.init=function(){g.set(g.LOADING,new me.DefaultLoadingScreen)},g.stop=function(a){h!==g.LOADING&&g.isRunning()&&(e(),a===!0&&me.audio.pauseTrack(),o=window.performance.now(),me.event.publish(me.event.STATE_STOP),"function"==typeof g.onStop&&g.onStop())},g.pause=function(a){h===g.LOADING||g.isPaused()||(c(),a===!0&&me.audio.pauseTrack(),o=window.performance.now(),me.event.publish(me.event.STATE_PAUSE),"function"==typeof g.onPause&&g.onPause())},g.restart=function(b){g.isRunning()||(a(),b===!0&&me.audio.resumeTrack(),o=window.performance.now()-o,me.game.repaint(),me.event.publish(me.event.STATE_RESTART,[o]),"function"==typeof g.onRestart&&g.onRestart())},g.resume=function(a){g.isPaused()&&(b(),a===!0&&me.audio.resumeTrack(),o=window.performance.now()-o,me.event.publish(me.event.STATE_RESUME,[o]),"function"==typeof g.onResume&&g.onResume())},g.isRunning=function(){return-1!==i},g.isPaused=function(){return j},g.set=function(a,b){k[a]={},k[a].screen=b,k[a].transition=!0},g.current=function(){return k[h].screen},g.transition=function(a,b,c){"fade"===a&&(l.color=b,l.duration=c)},g.setTransition=function(a,b){k[a].transition=b},g.change=function(a){if("undefined"==typeof k[a])throw new me.Error("Undefined ScreenObject for state '"+a+"'");n=null,arguments.length>1&&(n=Array.prototype.slice.call(arguments,1)),l.duration&&k[a].transition?(m=function(){me.game.viewport.fadeOut(l.color,l.duration)},me.game.viewport.fadeIn(l.color,l.duration,function(){f.defer(this,a)})):f.defer(this,a)},g.isCurrent=function(a){return h===a},g}()}(),function(){var a=me.Renderable.extend({init:function(a,b,c){me.Renderable.prototype.init.apply(this,[a.x,a.y,b,c]),this.invalidate=!1,this.barHeight=4,this.progress=0},onProgressUpdate:function(a){this.progress=~~(a*this.width),this.invalidate=!0},update:function(){return this.invalidate===!0?(this.invalidate=!1,!0):!1},draw:function(a){a.setColor("#000000"),a.fillRect(0,this.height/2-this.barHeight/2,this.width,this.barHeight),a.setColor("#55aa00"),a.fillRect(2,this.height/2-this.barHeight/2,this.progress,this.barHeight)}}),b=me.Renderable.extend({init:function(a,b,c){me.Renderable.prototype.init.apply(this,[b,c,100,85]),this.iconCanvas=a;var d=me.CanvasRenderer.getContext2d(this.iconCanvas);
d.translate(this.pos.x,this.pos.y),d.beginPath(),d.moveTo(.7,48.9),d.bezierCurveTo(10.8,68.9,38.4,75.8,62.2,64.5),d.bezierCurveTo(86.1,53.1,97.2,27.7,87,7.7),d.lineTo(87,7.7),d.bezierCurveTo(89.9,15.4,73.9,30.2,50.5,41.4),d.bezierCurveTo(27.1,52.5,5.2,55.8,.7,48.9),d.lineTo(.7,48.9),d.lineTo(.7,48.9),d.closePath(),d.fillStyle="rgb(255, 255, 255)",d.fill(),d.beginPath(),d.moveTo(84,7),d.bezierCurveTo(87.6,14.7,72.5,30.2,50.2,41.6),d.bezierCurveTo(27.9,53,6.9,55.9,3.2,48.2),d.bezierCurveTo(-.5,40.4,14.6,24.9,36.9,13.5),d.bezierCurveTo(59.2,2.2,80.3,-.8,84,7),d.lineTo(84,7),d.closePath(),d.lineWidth=5.3,d.strokeStyle="rgb(255, 255, 255)",d.lineJoin="miter",d.miterLimit=4,d.stroke()},draw:function(a){a.drawImage(this.iconCanvas,0,0)}}),c=me.Renderable.extend({init:function(a,b){me.Renderable.prototype.init.apply(this,[0,0,a,b]),this.logo1=new me.Font("century gothic",32,"white","middle"),this.logo2=new me.Font("century gothic",32,"#55aa00","middle"),this.logo2.bold(),this.logo1.textBaseline=this.logo2.textBaseline="alphabetic"},draw:function(a){var b=a.measureText(this.logo1,"melon").width,c=(this.width-b-a.measureText(this.logo2,"JS").width)/2,d=this.height/2+a.measureText(this.logo2,"melon").height;a.drawFont(this.logo1,"melon",c,d),c+=b,a.drawFont(this.logo2,"JS",c,d)}});me.DefaultLoadingScreen=me.ScreenObject.extend({onResetEvent:function(){me.game.reset(),me.game.world.addChild(new me.ColorLayer("background","#202020",0));var d=new a(new me.Vector2d,me.video.renderer.getWidth(),me.video.renderer.getHeight());this.handle=me.event.subscribe(me.event.LOADER_PROGRESS,d.onProgressUpdate.bind(d)),me.game.world.addChild(d,1),this.iconCanvas=me.video.createCanvas(me.game.viewport.width,me.game.viewport.height,!1),this.iconCanvas.style.display="none",document.body.appendChild(this.iconCanvas);var e=new b(this.iconCanvas,(me.video.renderer.getWidth()-100)/2,me.video.renderer.getHeight()/2-d.barHeight/2-90);me.game.world.addChild(e,1),me.game.world.addChild(new c(me.video.renderer.getWidth(),me.video.renderer.getHeight()),1)},onDestroyEvent:function(){this.handle&&(me.event.unsubscribe(this.handle),this.handle=null),document.body.removeChild(this.iconCanvas)}})}(),function(){me.loader=function(){function a(){l===k?f.onload?(clearTimeout(m),setTimeout(function(){f.onload(),me.event.publish(me.event.LOADER_COMPLETE)},300)):console.error("no load callback defined"):m=setTimeout(a,100)}function b(a,b,c){g[a.name]=new Image,g[a.name].onload=b,g[a.name].onerror=c,g[a.name].src=a.src+f.nocache}function c(a,b,c){function d(b,c){h[a.name]={data:b,isTMX:"tmx"===a.type,format:c}}if("tmx"===a.type&&me.levelDirector.addTMXLevel(a.name),a.data)return d(a.data,a.format),void b();var e=new XMLHttpRequest,g=me.utils.getFileExtension(a.src).toLowerCase();e.overrideMimeType&&e.overrideMimeType("json"===g?"application/json":"text/xml"),e.open("GET",a.src+f.nocache,!0),e.ontimeout=c,e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status||0===e.status&&e.responseText){var a=null;switch(g){case"xml":case"tmx":a=me.device.ua.match(/msie/i)||!e.responseXML?(new DOMParser).parseFromString(e.responseText,"text/xml"):e.responseXML,a=me.TMXUtils.parse(a).map,g="json";break;case"json":a=JSON.parse(e.responseText);break;default:throw new f.Error("TMX file format "+g+"not supported !")}d(a,g),b()}else c()},e.send(null)}function d(a,b,c){var d=new XMLHttpRequest;d.overrideMimeType&&d.overrideMimeType("application/json"),d.open("GET",a.src+f.nocache,!0),d.ontimeout=c,d.onreadystatechange=function(){4===d.readyState&&(200===d.status||0===d.status&&d.responseText?(j[a.name]=JSON.parse(d.responseText),b()):c())},d.send(null)}function e(a,b,c){var d=new XMLHttpRequest;d.open("GET",a.src+f.nocache,!0),d.responseType="arraybuffer",d.onerror=c,d.onload=function(){var c=d.response;if(c){for(var e=new Uint8Array(c),f=[],g=0;g<e.byteLength;g++)f[g]=String.fromCharCode(e[g]);i[a.name]=f.join(""),b()}},d.send()}var f={},g={},h={},i={},j={},k=0,l=0,m=0;return f.nocache="",f.onload=void 0,f.onProgress=void 0,f.Error=me.Error.extend({init:function(a){me.Error.prototype.init.apply(this,[a]),this.name="me.loader.Error"}}),f.onResourceLoaded=function(a){l++;var b=f.getLoadProgress();f.onProgress&&f.onProgress(b,a),me.event.publish(me.event.LOADER_PROGRESS,[b,a])},f.onLoadingError=function(a){throw new f.Error("Failed loading resource "+a.src)},f.setNocache=function(a){f.nocache=a?"?"+~~(1e7*Math.random()):""},f.preload=function(b){for(var c=0;c<b.length;c++)k+=f.load(b[c],f.onResourceLoaded.bind(f,b[c]),f.onLoadingError.bind(f,b[c]));a()},f.load=function(a,g,h){switch(a.name=a.name.toLowerCase(),a.type){case"binary":return e.call(this,a,g,h),1;case"image":return b.call(this,a,g,h),1;case"json":return d.call(this,a,g,h),1;case"tmx":case"tsx":return c.call(this,a,g,h),1;case"audio":return me.audio.load(a,g,h),1;default:throw new f.Error("load : unknown or invalid resource type : "+a.type)}},f.unload=function(a){switch(a.name=a.name.toLowerCase(),a.type){case"binary":return a.name in i?(delete i[a.name],!0):!1;case"image":return a.name in g?("function"==typeof g[a.name].dispose&&g[a.name].dispose(),delete g[a.name],!0):!1;case"json":return a.name in j?(delete j[a.name],!0):!1;case"tmx":case"tsx":return a.name in h?(delete h[a.name],!0):!1;case"audio":return me.audio.unload(a.name);default:throw new f.Error("unload : unknown or invalid resource type : "+a.type)}},f.unloadAll=function(){var a;for(a in i)i.hasOwnProperty(a)&&f.unload({name:a,type:"binary"});for(a in g)g.hasOwnProperty(a)&&f.unload({name:a,type:"image"});for(a in h)h.hasOwnProperty(a)&&f.unload({name:a,type:"tmx"});for(a in j)j.hasOwnProperty(a)&&f.unload({name:a,type:"json"});me.audio.unloadAll()},f.getTMX=function(a){return a=""+a,a=a.toLowerCase(),a in h?h[a].data:null},f.getBinary=function(a){return a=""+a,a=a.toLowerCase(),a in i?i[a]:null},f.getImage=function(a){return a=""+a,a=a.toLowerCase(),a in g?g[a]:null},f.getJSON=function(a){return a=""+a,a=a.toLowerCase(),a in j?j[a]:null},f.getLoadProgress=function(){return l/k},f}()}(),function(){me.Font=me.Renderable.extend({init:function(a,b,c,d){this.fontSize=new me.Vector2d,this.fillStyle=c||"#000000",this.strokeStyle="#000000",this.lineWidth=1,this.textAlign=d||"left",this.textBaseline="top",this.lineHeight=1,this.setFont(a,b,c,d),this.pos=new me.Vector2d(0,0),me.Renderable.prototype.init.apply(this,[this.pos.x,this.pos.y,0,this.fontSize.y]),this.gid||(this.gid=me.utils.createGUID())},bold:function(){this.font="bold "+this.font},italic:function(){this.font="italic "+this.font},setFont:function(a,b,c,d){var e=a.split(",").map(function(a){return a=a.trim(),/(^".*"$)|(^'.*'$)/.test(a)?a:'"'+a+'"'});this.fontSize.y=+b,this.height=this.fontSize.y,"number"==typeof b&&(b+="px"),this.font=b+" "+e.join(","),this.fillStyle=c,d&&(this.textAlign=d)},measureText:function(a,b){a.font=this.font,a.fillStyle=this.fillStyle,a.textAlign=this.textAlign,a.textBaseline=this.textBaseline,this.height=this.width=0;for(var c=(""+b).split("\n"),d=0;d<c.length;d++)this.width=Math.max(a.measureText(c[d].trimRight()).width,this.width),this.height+=this.fontSize.y*this.lineHeight;return{width:this.width,height:this.height}},draw:function(a,b,c,d){c=~~c,d=~~d,this.pos.set(c,d),a.font=this.font,a.fillStyle=this.fillStyle,a.textAlign=this.textAlign,a.textBaseline=this.textBaseline;for(var e=(""+b).split("\n"),f=0;f<e.length;f++)a.fillText(e[f].trimRight(),c,d),d+=this.fontSize.y*this.lineHeight},drawStroke:function(a,b,c,d){c=~~c,d=~~d,this.pos.set(c,d),a.font=this.font,a.fillStyle=this.fillStyle,a.strokeStyle=this.strokeStyle,a.lineWidth=this.lineWidth,a.textAlign=this.textAlign,a.textBaseline=this.textBaseline;for(var e=(""+b).split("\n"),f=0;f<e.length;f++){var g=e[f].trimRight();a.strokeText(g,c,d),a.fillText(g,c,d),d+=this.fontSize.y*this.lineHeight}}})}(),function(){me.BitmapFont=me.Font.extend({init:function(a,b,c,d){this.sSize=new me.Vector2d,this.firstChar=32,this.charCount=0,me.Font.prototype.init.apply(this,[a,null,null]),this.firstChar=d||32,this.loadFontMetrics(a,b),this.textAlign="left",this.textBaseline="top",c&&this.resize(c)},loadFontMetrics:function(a,b){this.font=me.loader.getImage(a),this.fontSize.x=b.x||b,this.fontSize.y=b.y||this.font.height,this.sSize.copy(this.fontSize),this.height=this.sSize.y,this.charCount=~~(this.font.width/this.fontSize.x)},set:function(a,b){this.textAlign=a,b&&this.resize(b)},resize:function(a){this.sSize.setV(this.fontSize),this.sSize.x*=a,this.sSize.y*=a,this.height=this.sSize.y},measureText:function(a,b){var c=(""+b).split("\n");this.height=this.width=0;for(var d=0;d<c.length;d++)this.width=Math.max(c[d].trimRight().length*this.sSize.x,this.width),this.height+=this.sSize.y*this.lineHeight;return{width:this.width,height:this.height}},draw:function(a,b,c,d){var e=(""+b).split("\n"),f=c,g=this.sSize.y*this.lineHeight,h=a.globalAlpha();a.setGlobalAlpha(a.globalAlpha()*this.getOpacity()),this.pos.set(c,d);for(var i=0;i<e.length;i++){c=f;var j=e[i].trimRight(),k=j.length*this.sSize.x;switch(this.textAlign){case"right":c-=k;break;case"center":c-=.5*k}switch(this.textBaseline){case"middle":d-=.5*g;break;case"ideographic":case"alphabetic":case"bottom":d-=g}for(var l=0,m=j.length;m>l;l++){var n=j.charCodeAt(l)-this.firstChar;n>=0&&a.drawImage(this.font,this.fontSize.x*(n%this.charCount),this.fontSize.y*~~(n/this.charCount),this.fontSize.x,this.fontSize.y,~~c,~~d,this.sSize.x,this.sSize.y),c+=this.sSize.x}d+=g}a.setGlobalAlpha(h)}})}(),function(){me.audio=function(){function a(a,b){if(h++>3){var e="melonJS: failed loading "+a;if(me.sys.stopOnAudioError!==!1)throw new c.Error(e);me.audio.disable(),b&&b(),console.log(e+", disabling audio")}else d[a].load()}function b(a){g=a}var c={},d={},e={},f=null,g=null,h=0;return c.Error=me.Error.extend({init:function(a){me.Error.prototype.init.apply(this,[a]),this.name="me.audio.Error"}}),c.init=function(a){if(!me.initialized)throw new c.Error("me.audio.init() called before engine initialization.");return a="string"==typeof a?a:"mp3",this.audioFormats=a.split(","),!Howler.noAudio},c.enable=function(){this.unmuteAll()},c.disable=function(){this.muteAll()},c.load=function(b,f,g){var i=[];if("undefined"==typeof this.audioFormats||0===this.audioFormats.length)throw new c.Error("target audio extension(s) should be set through me.audio.init() before calling the preloader.");for(var j=0;j<this.audioFormats.length;j++)i.push(b.src+b.name+"."+this.audioFormats[j]+me.loader.nocache);return d[b.name]=new Howl({urls:i,volume:Howler.volume(),onend:function(a){e[a]&&(e[a](),e[a]=null)},onloaderror:function(){d[b.name]=this,a.call(me.audio,b.name,g)},onload:function(){d[b.name]=this,h=0,f&&f()}}),1},c.play=function(a,b,c,f,g){var h=d[a.toLowerCase()];return h&&"undefined"!=typeof h?(h.loop(b||!1),h.volume("number"==typeof f?f.clamp(0,1):Howler.volume()),"function"==typeof c||"function"==typeof g?h.play(void 0,function(a){c&&(e[a]=c),g&&g(a)}):h.play(),h):void 0},c.stop=function(a,b){var c=d[a.toLowerCase()];c&&"undefined"!=typeof c&&c.stop(b)},c.pause=function(a,b){var c=d[a.toLowerCase()];c&&"undefined"!=typeof c&&c.pause(b)},c.playTrack=function(a,c){return f=a.toLowerCase(),me.audio.play(f,!0,null,c,navigator.isCocoonJS&&!Howler.usingWebAudio?b:void 0)},c.stopTrack=function(){null!==f&&(d[f].stop(navigator.isCocoonJS&&!Howler.usingWebAudio?g:void 0),f=null)},c.pauseTrack=function(){null!==f&&d[f].pause(navigator.isCocoonJS&&!Howler.usingWebAudio?g:void 0)},c.resumeTrack=function(){null!==f&&d[f].play(null,navigator.isCocoonJS&&!Howler.usingWebAudio?b:void 0)},c.getCurrentTrack=function(){return f},c.setVolume=function(a){Howler.volume(a)},c.getVolume=function(){return Howler.volume()},c.mute=function(a,b){b="undefined"==typeof b?!0:!!b;var c=d[a.toLowerCase()];c&&"undefined"!=typeof c&&c.mute(!0)},c.unmute=function(a){c.mute(a,!1)},c.muteAll=function(){Howler.mute()},c.unmuteAll=function(){Howler.unmute()},c.unload=function(a){return a=a.toLowerCase(),a in d?(d[a].unload(),delete d[a],!0):!1},c.unloadAll=function(){for(var a in d)d.hasOwnProperty(a)&&c.unload(a)},c}()}(),function(){me.CanvasRenderer=function(){var a={},b=null,c=null,d=null,e=null,f=null,g=0,h=0;return a.init=function(a,i,j,k,l,m){return b=a,c=this.getContext2d(b),d=k,d?(e=me.video.createCanvas(i,j,!1),f=this.getContext2d(e)):(e=b,f=c),h=l,g=m,this},a.applyRGBFilter=function(b,c,d){var e,f,g=a.getContext2d(me.video.createCanvas(b.width,b.height,!1)),h=me.utils.getPixels(b),i=h.data;switch(c){case"b&w":for(e=0,f=i.length;f>e;e+=4){var j=3*i[e]+4*i[e+1]+i[e+2]>>>3;i[e]=j,i[e+1]=j,i[e+2]=j}break;case"brightness":var k=Math.abs(d).clamp(0,1);for(e=0,f=i.length;f>e;e+=4)i[e]*=k,i[e+1]*=k,i[e+2]*=k;break;case"transparent":var l=me.pool.pull("me.Color").parseHex(d),m=me.pool.pull("me.Color");for(e=0,f=i.length;f>e;e+=4)m.setColor(i[e],i[e+1],i[e+2]),m.equals(l)&&(i[e+3]=0);me.pool.push(l),me.pool.push(m);break;default:return null}return g.putImageData(h,0,0),g},a.blitSurface=function(){a.blitSurface=d?function(){c.drawImage(e,0,0,e.width,e.height,0,0,h,g)}:function(){},a.blitSurface()},a.clearSurface=function(a,b){null===a&&(a=f);var c=a.canvas;a.save(),a.setTransform(1,0,0,1,0,0),a.fillStyle=b,a.fillRect(0,0,c.width,c.height),a.restore()},a.drawFont=function(a,b,c,d){a.draw(f,b,c,d)},a.drawLine=function(a,b,c,d){f.beginPath(),f.translate(a,b),f.moveTo(0,0),f.lineTo(c,d),f.stroke(),f.closePath()},a.drawImage=function(){f.drawImage.apply(f,arguments)},a.fillArc=function(a,b,c,d,e,g,h){null===h&&(h=!1),f.save(),f.beginPath(),f.translate(a-c,b-d),f.scale(c,d),f.arc(1,1,1,e,g,h),f.restore(),f.fill()},a.fillRect=function(a,b,c,d){f.fillRect(a,b,c,d)},a.getScreenCanvas=function(){return b},a.getScreenContext=function(){return c},a.getContext2d=function(a){if("undefined"==typeof a||null===a)throw new me.video.Error("You must pass a canvas element in order to create a 2d context");if("undefined"==typeof a.getContext)throw new me.video.Error("Your browser does not support HTML5 canvas.");var b;return b=navigator.isCocoonJS?a.getContext("2d",{antialias:me.sys.scalingInterpolation}):a.getContext("2d"),b.canvas||(b.canvas=a),this.setImageSmoothing(b,me.sys.scalingInterpolation),b},a.getHeight=function(){return e.height},a.getCanvas=function(){return e},a.getColor=function(){return f.fillStyle},a.getContext=function(){return f},a.getWidth=function(){return e.width},a.globalAlpha=function(){return f.globalAlpha},a.measureText=function(a,b){return a.measureText(f,b)},a.resetTransform=function(){f.setTransform(1,0,0,1,0,0)},a.resize=function(a,d){b.width=h=e.width*a,b.height=g=e.height*d,me.device.getPixelRatio()>1&&(b.style.width=b.width/me.device.getPixelRatio()+"px",b.style.height=b.height/me.device.getPixelRatio()+"px"),this.setImageSmoothing(c,me.sys.scalingInterpolation),this.blitSurface()},a.restore=function(){f.restore()},a.rotate=function(a){f.rotate(a)},a.save=function(){f.save()},a.scale=function(a,b){f.scale(a,b)},a.setAlpha=function(a){f.globalCompositeOperation=a?"source-over":"copy"},a.setColor=function(a){f.strokeStyle=a,f.fillStyle=a},a.setGlobalAlpha=function(a){f.globalAlpha=a},a.setImageSmoothing=function(a,b){me.agent.setPrefixed("imageSmoothingEnabled",b===!0,a)},a.setLineWidth=function(a){f.lineWidth=a},a.strokeArc=function(a,b,c,d,e,g,h){null===h&&(h=!1),f.save(),f.beginPath(),f.translate(a-c,b-d),f.scale(c,d),f.arc(1,1,1,e,g,h),f.restore(),f.stroke()},a.strokeLine=function(a,b,d,e){c.beginPath(),c.moveTo(a,b),c.lineTo(d,e),c.stroke()},a.strokePolygon=function(a){this.translate(a.pos.x,a.pos.y),f.beginPath(),f.moveTo(a.points[0].x,a.points[0].y);for(var b,c=1;c<a.points.length;c++)b=a.points[c],f.lineTo(b.x,b.y);f.lineTo(a.points[0].x,a.points[0].y),f.stroke()},a.strokeRect=function(a,b,c,d){f.strokeRect(a,b,c,d)},a.transform=function(a,b,c,d,e,g){f.transform(a,b,c,d,e,g)},a.translate=function(a,b){f.translate(a,b)},a}()}(),function(){me.video=function(){var a={},b=null,c=null,d=-1,e=!1,f=!1,g=!0,h=1/0,i=1/0;return a.Error=me.Error.extend({init:function(a){me.Error.prototype.init.apply(this,[a]),this.name="me.video.Error"}}),a.init=function(d,h,i,j,k,l,m){if(!me.initialized)throw new a.Error("me.video.init() called before engine initialization.");e=k||!1,f="auto"===l||!1,g="undefined"!=typeof m?m:!0,l=f?1:+l||1,me.sys.scale=new me.Vector2d(l,l),(f||1!==l)&&(e=!0);var n=i*me.sys.scale.x,o=j*me.sys.scale.y;if(window.addEventListener("resize",throttle(100,!1,function(a){me.event.publish(me.event.WINDOW_ONRESIZE,[a])}),!1),window.addEventListener("orientationchange",function(a){me.event.publish(me.event.WINDOW_ONORIENTATION_CHANGE,[a])},!1),me.event.subscribe(me.event.WINDOW_ONRESIZE,me.video.onresize.bind(me.video)),me.event.subscribe(me.event.WINDOW_ONORIENTATION_CHANGE,me.video.onresize.bind(me.video)),b=a.createCanvas(n,o,!0),d&&(c=document.getElementById(d)),c||(c=document.body),c.appendChild(b),!b.getContext)return!1;switch(h){case me.video.WEBGL:this.renderer=me.WebGLRenderer.init(b.width,b.height,b);break;default:this.renderer=me.CanvasRenderer.init(b,i,j,e,n,o)}var p=me.device.getPixelRatio();if(p>1&&(b.style.width=b.width/p+"px",b.style.height=b.height/p+"px"),window.getComputedStyle){var q=window.getComputedStyle(b,null);me.video.setMaxSize(parseInt(q.maxWidth,10),parseInt(q.maxHeight,10))}return me.video.onresize(),me.game.init(),!0},a.getPos=function(a){return a=a||this.renderer.getScreenCanvas(),a.getBoundingClientRect?a.getBoundingClientRect():{left:0,top:0}},a.setMaxSize=function(a,b){h=a||1/0,i=b||1/0},a.createCanvas=function(c,d,e){if(0===c||0===d)throw new a.Error("width or height was zero, Canvas could not be initialized !");var f=document.createElement("canvas");return e===!0&&navigator.isCocoonJS&&me.device.android2!==!0&&(f.screencanvas=!0),f.width=c||b.width,f.height=d||b.height,f},a.getWrapper=function(){return c},a.onresize=function(){var a=1,b=1;if(me.device.orientation="undefined"!=typeof window.orientation?window.orientation:window.outerWidth>window.outerHeight?90:0,f){var c=me.video.renderer.getScreenCanvas().parentNode,e=Math.min(h,c.width||window.innerWidth),j=Math.min(i,c.height||window.innerHeight);if(g){var k=me.video.renderer.getWidth()/me.video.renderer.getHeight(),l=e/j;a=b=k>l?e/me.video.renderer.getWidth():j/me.video.renderer.getHeight()}else a=e/me.video.renderer.getWidth(),b=j/me.video.renderer.getHeight();if(a*=me.device.getPixelRatio(),b*=me.device.getPixelRatio(),1!==a||1!==b)return d>=0&&clearTimeout(d),void(d=me.video.updateDisplaySize.defer(this,a,b))}me.input._offset=me.video.getPos()},a.updateDisplaySize=function(a,b){me.sys.scale.set(a,b),this.renderer.resize(a,b),me.input._offset=me.video.getPos(),d=-1},a.setAlpha=function(a){"function"==typeof this.renderer.setAlpha&&this.renderer.setAlpha(a)},a}(),me.video.CANVAS=0,me.video.WEBGL=1}(),function(){me.WebGLRenderer=function(){var a={},b=null,c=[],d={},e=null,f=null,g=null,h=null,i=[],j=null,k=null,l=null,m=null,n=null;return a.init=function(a,c,d){return b=d,g=b.getContext("experimental-webgl"),g.FALSE=!1,g.TRUE=!0,this.uniformMatrix=new me.Matrix3d,k=new me.Matrix3d,this.context=g,this.createShader(),l.bind(),g.enableVertexAttribArray(l.attributes.aTexture.location),g.enableVertexAttribArray(l.attributes.aPosition.location),h=new me.Color(255,255,255,1),e=me.video.createCanvas(a,c,!1),f=me.CanvasRenderer.getContext2d(e),n=g.createTexture(),g.bindTexture(g.TEXTURE_2D,n),g.texImage2D(g.TEXTURE_2D,0,g.RGBA,1,1,0,g.RGBA,g.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),this.createBuffers(),g.clearColor(0,0,0,1),g.enable(g.DEPTH_TEST),g.enable(g.BLEND),g.blendFunc(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA),this},a.bindTexture=function(a){(null===a.texture||"undefined"==typeof a.texture)&&(a.texture=stackgl.gltexture2d(g,a))},a.blitSurface=function(){},a.clearSurface=function(a,b){this.setColor(b),a.clearColor(h.r/255,h.g/255,h.b/255,1)},a.createBuffers=function(){m=g.createBuffer(),j=g.createBuffer()},a.createShader=function(){l=stackgl.createShader(g)},a.drawFont=function(a,c,g,h){var i,j=a.gid;if(d[j]){var k=d[j];(a.font!==k.font||a.fontSize!==k.fontSize||a.fillStyle!==k.fillStyle||a.textAlign!==k.textAlign||a.textBaseline!==k.textBaseline||a.lineHeight!==k.lineHeight||c!==k.text)&&(k.font=a.font,k.fontSize=a.fontSize,k.fillStyle=a.fillStyle,k.textAlign=a.textAlign,k.textBaseline=a.textBaseline,k.lineHeight=a.lineHeight,k.text=c,a.draw(f,c,g,h),i=a.measureText(f,c),k.width=i.width,k.height=i.height,k.image=f.getImageData(0,0,e.width,e.height),f.clearRect(0,0,b.width,b.height))}else a.draw(f,c,g,h),i=a.measureText(f,c),d[j]={font:a.font,fontSize:a.fontSize,fillStyle:a.fillStyle,textAlign:a.textAlign,textBaseline:a.textBaseline,lineHeight:a.lineHeight,text:a.text,image:f.getImageData(0,0,e.width,e.height),width:i.width,height:i.height},f.clearRect(0,0,b.width,b.height);this.drawImage(d[j].image,g,h,d[j].width,d[j].height)},a.drawImage=function(a,b,c,d,e,f,i,n,o){"undefined"==typeof a.texture&&this.bindTexture(a),"undefined"==typeof d?(d=n=a.width,e=o=a.height,f=b,i=c,b=0,c=0):"undefined"==typeof f&&(f=b,i=c,n=d,o=e,d=a.width,e=a.height,b=0,c=0),this.uniformMatrix.identity();var p=b/a.width,q=1-c/a.height,r=(b+d)/a.width,s=1-(c+e)/a.height,t=f,u=i,v=t+n,w=u+o,x=new Float32Array([t,u,v,u,t,w,t,w,v,u,v,w]);g.bindBuffer(g.ARRAY_BUFFER,j),g.bufferData(g.ARRAY_BUFFER,x,g.STATIC_DRAW),g.vertexAttribPointer(l.attributes.aPosition.location,2,g.FLOAT,!1,0,0);var y=new Float32Array([p,q,r,q,p,s,p,s,r,q,r,s]);g.bindBuffer(g.ARRAY_BUFFER,m),l.uniforms.texture=a.texture.bind(),g.bufferData(g.ARRAY_BUFFER,y,g.STATIC_DRAW),g.vertexAttribPointer(l.attributes.aTexture.location,2,g.FLOAT,!1,0,0),this.uniformMatrix.multiply(k),l.uniforms.uMatrix=this.uniformMatrix.val,l.uniforms.uColor=h.toGL(),g.drawArrays(g.TRIANGLES,0,6)},a.fillRect=function(a,b,c,d){var e=a,f=b,i=a+c,o=b+d,p=new Float32Array([e,f,i,f,e,o,e,o,i,f,i,o]);g.bindBuffer(g.ARRAY_BUFFER,j),g.bufferData(g.ARRAY_BUFFER,p,g.STATIC_DRAW),g.vertexAttribPointer(l.attributes.aPosition.location,2,g.FLOAT,!1,0,0);var q=new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]);g.activeTexture(g.TEXTURE0),g.bindBuffer(g.ARRAY_BUFFER,m),g.bufferData(g.ARRAY_BUFFER,q,g.STATIC_DRAW),g.vertexAttribPointer(l.attributes.aTexture.location,2,g.FLOAT,!1,0,0),this.uniformMatrix.multiply(k),l.uniforms.uMatrix=this.uniformMatrix.val,g.bindTexture(g.TEXTURE_2D,n),l.uniforms.uColor=h.toGL(),g.drawArrays(g.TRIANGLES,0,6)},a.getCanvas=function(){return b},a.getColor=function(){return h.toHex()},a.getContext=function(){return g},a.getHeight=function(){return g.canvas.height},a.getScreenCanvas=function(){return b},a.getScreenContext=function(){return g},a.getWidth=function(){return g.canvas.width},a.globalAlpha=function(){return h.alpha},a.measureText=function(a,b){return a.measureText(f,b)},a.resetTransform=function(){this.uniformMatrix.identity()},a.resize=function(){me.device.getPixelRatio()>1&&(b.style.width=b.width/me.device.getPixelRatio()+"px",b.style.height=b.height/me.device.getPixelRatio()+"px")},a.restore=function(){h.parseHex(c.pop()),this.uniformMatrix=i.pop()},a.rotate=function(a){this.uniformMatrix.rotate(a)},a.save=function(){c.push(this.getColor());var a=new me.Matrix3d;this.uniformMatrix.copy(a),i.push(this.uniformMatrix),this.uniformMatrix=a},a.scale=function(a,b){this.uniformMatrix.scale(a,b)},a.setAlpha=function(){},a.setProjection=function(){k.set(2/b.width,0,0,0,-2/b.height,0,-1,1,1)},a.setImageSmoothing=function(){},a.setGlobalAlpha=function(a){h.alpha=a},a.setColor=function(a){a.match(/^\#/)?h.parseHex(a):a.match(/^rgb/)?h.parseRGB(a):h.parseCSS(a)},a.startRender=function(){g.viewport(0,0,b.width,b.height),me.video.renderer.setProjection()},a.transform=function(a,b,c,d,e,f){this.uniformMatrix.transform(a,b,c,d,e,f)},a.translate=function(a,b){this.uniformMatrix.translate(a,b)},a}()}(),function(){me.input=function(){var a={};return a._preventDefault=function(a){return a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,a.preventDefault?a.preventDefault():a.returnValue=!1,!1},a.preventDefault=!0,a}()}(),function(){var a=me.input;a._KeyBinding={};var b={},c={},d={},e={},f={},g=!1;a._enableKeyboardEvent=function(){g||(window.addEventListener("keydown",a._keydown,!1),window.addEventListener("keyup",a._keyup,!1),g=!0)},a._keydown=function(c,g,h){g=g||c.keyCode||c.which;var i=a._KeyBinding[g];if(me.event.publish(me.event.KEYDOWN,[i,g,i?!d[i]:!0]),i){if(!d[i]){var j=h?h:g;e[i][j]||(b[i]++,e[i][j]=!0)}return f[g]?a._preventDefault(c):!0}return!0},a._keyup=function(c,g,h){g=g||c.keyCode||c.which;var i=a._KeyBinding[g];if(me.event.publish(me.event.KEYUP,[i,g]),i){var j=h?h:g;return e[i][j]=void 0,b[i]>0&&b[i]--,d[i]=!1,f[g]?a._preventDefault(c):!0}return!0},a.KEY={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:42,INSERT:45,DELETE:46,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,WINDOW_KEY:91,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,FORWAND_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222},a.isKeyPressed=function(a){return b[a]&&!d[a]?(c[a]&&(d[a]=!0),!0):!1},a.keyStatus=function(a){return b[a]>0},a.triggerKeyEvent=function(b,c){c?a._keydown({},b):a._keyup({},b)},a.bindKey=function(g,h,i,j){a._enableKeyboardEvent(),"boolean"!=typeof j&&(j=a.preventDefault),a._KeyBinding[g]=h,f[g]=j,b[h]=0,c[h]=i?i:!1,d[h]=!1,e[h]={}},a.unlockKey=function(a){d[a]=!1},a.unbindKey=function(d){var g=a._KeyBinding[d];b[g]=0,c[g]=!1,e[g]={},a._KeyBinding[d]=null,f[d]=null}}(),function(){function a(a,b){for(var c=2;c<a.length;++c)"undefined"!=typeof a[c]&&me.video.renderer.getScreenCanvas().addEventListener(a[c],b,!1)}function b(){j||(w.push({x:0,y:0}),h.mouse.pos=new me.Vector2d(0,0),h._offset=me.video.getPos(),window.addEventListener("scroll",throttle(100,!1,function(a){h._offset=me.video.getPos(),me.event.publish(me.event.WINDOW_ONSCROLL,[a])}),!1),m=navigator.pointerEnabled?n:navigator.msPointerEnabled?o:me.device.touch?q:p,a(m,g),k="onwheel"in document.createElement("div")?"wheel":"mousewheel",window.addEventListener(k,e,!1),"undefined"==typeof h.throttlingInterval&&(h.throttlingInterval=~~(1e3/me.sys.fps)),h.throttlingInterval<17?me.video.renderer.getScreenCanvas().addEventListener(m[r],f,!1):me.video.renderer.getScreenCanvas().addEventListener(m[r],throttle(h.throttlingInterval,!1,function(a){f(a)}),!1),j=!0)}function c(a){var b=!1,c=i[a.type];if(c||(c=m.indexOf(a.type)===u?i[m[t]]:i[a.type]),c){me.game.viewport.localToWorld(0,0,v);for(var d=0,e=w.length;e>d;d++){if("undefined"!=typeof a.timeStamp){if(a.timeStamp<l)continue;l=a.timeStamp}me.device.pointerEnabled||(a.pointerId=w[d].id),a.gameScreenX=w[d].x,a.gameScreenY=w[d].y,a.gameWorldX=a.gameScreenX+v.x,a.gameWorldY=a.gameScreenY+v.y;for(var f,g=c.length;g--,f=c[g];)if(f.floating===!0?(a.gameX=a.gameScreenX,a.gameY=a.gameScreenY):(a.gameX=a.gameWorldX,a.gameY=a.gameWorldY),f.rect.getBounds().containsPoint(a.gameX,a.gameY)&&f.cb(a)===!1){b=!0;break}}}return b}function d(a){var b;if(w.length=0,a.touches)for(var c=0,d=a.changedTouches.length;d>c;c++){var e=a.changedTouches[c];b=h.globalToLocal(e.clientX,e.clientY),b.id=e.identifier,w.push(b)}else b=h.globalToLocal(a.clientX,a.clientY),b.id=a.pointerId||1,w.push(b);a.isPrimary!==!1&&h.mouse.pos.set(w[0].x,w[0].y)}function e(a){if(a.target===me.video.renderer.getScreenCanvas()){var b={deltaMode:1,type:"mousewheel",deltaX:a.deltaX,deltaY:a.deltaY,deltaZ:a.deltaZ};if("mousewheel"===k&&(b.deltaY=-1/40*a.wheelDelta,a.wheelDeltaX&&(b.deltaX=-1/40*a.wheelDeltaX)),c(b))return h._preventDefault(a)}return!0}function f(a){return d(a),c(a)?h._preventDefault(a):!0}function g(a){if(d(a),c(a))return h._preventDefault(a);var b=a.button||0,e=h.mouse.bind[b];return e?a.type===m[s]?h._keydown(a,e,b+1):h._keyup(a,e,b+1):!0}var h=me.input,i={},j=!1,k="mousewheel",l=0,m=null,n=["mousewheel","pointermove","pointerdown","pointerup","pointercancel",void 0,void 0],o=["mousewheel","MSPointerMove","MSPointerDown","MSPointerUp","MSPointerCancel",void 0,void 0],p=["mousewheel","mousemove","mousedown","mouseup",void 0,void 0,void 0],q=[void 0,"touchmove","touchstart","touchend","touchcancel",void 0,void 0],r=1,s=2,t=3,u=4,v=new me.Vector2d,w=[];h._offset=null,h.mouse={pos:null,LEFT:0,MIDDLE:1,RIGHT:2,bind:[0,0,0]},h.throttlingInterval=void 0,h.globalToLocal=function(a,b){var c=h._offset,d=me.device.getPixelRatio();a-=c.left,b-=c.top;var e=me.sys.scale;return(1!==e.x||1!==e.y)&&(a/=e.x,b/=e.y),new me.Vector2d(a*d,b*d)},h.bindPointer=function(){var a=arguments.length<2?h.mouse.LEFT:arguments[0],c=arguments.length<2?arguments[0]:arguments[1];if(b(),!h._KeyBinding[c])throw new me.Error("no action defined for keycode "+c);h.mouse.bind[a]=c},h.unbindPointer=function(a){h.mouse.bind["undefined"==typeof a?me.input.mouse.LEFT:a]=null},h.registerPointerEvent=function(a,c,d,e){if(b(),-1===n.indexOf(a))throw new me.Error("invalid event type : "+a);n!==m&&(a=m[n.indexOf(a)]),i[a]||(i[a]=[]);var f=c.floating===!0?!0:!1;e&&(f=e===!0?!0:!1),i[a].push({rect:c,cb:d,floating:f})},h.releasePointerEvent=function(a,b){if(-1===n.indexOf(a))throw new me.Error("invalid event type : "+a);n!==m&&(a=m[n.indexOf(a)]),i[a]||(i[a]=[]);var c=i[a];if(c)for(var d,e=c.length;e--,d=c[e];)d.rect===b&&(d.rect=d.cb=d.floating=null,i[a].splice(e,1))},h._translatePointerEvents=function(){h.registerPointerEvent("pointermove",me.game.viewport,function(a){return me.event.publish(me.event.MOUSEMOVE,[a]),!1})}}(),function(){var a=function(){var a={},b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return a.decode=function(a){if(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,""),me.device.nativeBase64)return window.atob(a);for(var c,d,e,f,g,h,i,j=[],k=0;k<a.length;)f=b.indexOf(a.charAt(k++)),g=b.indexOf(a.charAt(k++)),h=b.indexOf(a.charAt(k++)),i=b.indexOf(a.charAt(k++)),c=f<<2|g>>4,d=(15&g)<<4|h>>2,e=(3&h)<<6|i,j.push(String.fromCharCode(c)),64!==h&&j.push(String.fromCharCode(d)),64!==i&&j.push(String.fromCharCode(e));return j=j.join("")},a.encode=function(a){if(a=a.replace(/\r\n/g,"\n"),me.device.nativeBase64)return window.btoa(a);for(var c,d,e,f,g,h,i,j=[],k=0;k<a.length;)c=a.charCodeAt(k++),d=a.charCodeAt(k++),e=a.charCodeAt(k++),f=c>>2,g=(3&c)<<4|d>>4,h=(15&d)<<2|e>>6,i=63&e,isNaN(d)?h=i=64:isNaN(e)&&(i=64),j.push(b.charAt(f)),j.push(b.charAt(g)),j.push(b.charAt(h)),j.push(b.charAt(i));return j=j.join("")},a}();me.utils=function(){var b={},c="",d=0,e=/^.*(\\|\/|\:)/,f=/\.[^\.]*$/;return b.decodeBase64=function(b){return a.decode(b)},b.encodeBase64=function(b){return a.encode(b)},b.decodeBase64AsArray=function(b,c){c=c||1;var d,e,f,g,h=a.decode(b);for(g="function"==typeof window.Uint32Array?new Uint32Array(h.length/c):[],d=0,f=h.length/c;f>d;d++)for(g[d]=0,e=c-1;e>=0;--e)g[d]+=h.charCodeAt(d*c+e)<<(e<<3);return g},b.decompress=function(){throw new me.Error("GZIP/ZLIB compressed TMX Tile Map not supported!")},b.decodeCSV=function(a,b){a=a.trim().split("\n");for(var c=[],d=0;d<a.length;d++)for(var e=a[d].split(",",b),f=0;f<e.length;f++)c.push(+e[f]);return c},b.getBasename=function(a){return a.replace(e,"").replace(f,"")},b.getFileExtension=function(a){return a.substring(a.lastIndexOf(".")+1,a.length)},b.getPixels=function(a){if(a instanceof HTMLImageElement){var b=me.CanvasRenderer.getContext2d(me.video.createCanvas(a.width,a.height));return b.drawImage(a,0,0),b.getImageData(0,0,a.width,a.height)}return a.getContext("2d").getImageData(0,0,a.width,a.height)},b.resetGUID=function(a){c=a.toString().toUpperCase().toHex(),d=0
},b.createGUID=function(){return c+"-"+d++},b.applyFriction=function(a,b){return 0>a+b?a+b*me.timer.tick:a-b>0?a-b*me.timer.tick:0},b}()}(),function(){var a={black:[0,0,0],silver:[192,192,129],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255],orange:[255,165,0],aliceblue:[240,248,245],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,35],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],"darkgray[*]":[169,169,169],darkgreen:[0,100,0],"darkgrey[*]":[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]};me.Color=Object.extend({init:function(a,b,c,d){return this.r=a||0,this.g=b||0,this.b=c||0,this.alpha=d||1,this.glArray=new Float32Array([a/255,b/255,c/255,d]),this},onResetEvent:function(a,b,c,d){return this.setColor(a,b,c,d)},setColor:function(a,b,c,d){return this.r=(~~a||0).clamp(0,255),this.g=(~~b||0).clamp(0,255),this.b=(~~c||0).clamp(0,255),this.alpha="undefined"==typeof d?1:d.clamp(0,1),this.glArray[0]=this.r/255,this.glArray[1]=this.g/255,this.glArray[2]=this.b/255,this.glArray[3]=this.alpha,this},clone:function(){return me.pool.pull("me.Color",this.r,this.g,this.b,this.alpha)},add:function(a){return this.setColor(this.r+a.r,this.g+a.g,this.b+a.b,(this.alpha+a.alpha)/2)},darken:function(a){return a=a.clamp(0,1),this.setColor(this.r*a,this.g*a,this.b*a,this.alpha)},lighten:function(a){return a=a.clamp(0,1),this.setColor(this.r+(255-this.r)*a,this.g+(255-this.g)*a,this.b+(255-this.b)*a,this.alpha)},random:function(){return this.setColor(256*Math.random(),256*Math.random(),256*Math.random(),this.alpha)},equals:function(a){return this.r===a.r&&this.g===a.g&&this.b===a.b&&this.alpha===a.alpha},parseCSS:function(b){return b in a?this.setColor.apply(this,a[b]):this.parseRGB(b)},parseRGB:function(a){var b;if("rgba"===a.substring(0,4))b=5;else{if("rgb"!==a.substring(0,3))return this.parseHex(a);b=4}var c=a.slice(b,-1).split(/\s*,\s*/);return this.setColor.apply(this,c)},parseHex:function(a){"#"===a.charAt(0)&&(a=a.substring(1,a.length));var b,c,d;return a.length<6?(b=parseInt(a.charAt(0)+a.charAt(0),16),c=parseInt(a.charAt(1)+a.charAt(1),16),d=parseInt(a.charAt(2)+a.charAt(2),16)):(b=parseInt(a.substring(0,2),16),c=parseInt(a.substring(2,4),16),d=parseInt(a.substring(4,6),16)),this.setColor(b,c,d)},toGL:function(){return this.glArray},toHex:function(){return"#"+this.r.toHex()+this.g.toHex()+this.b.toHex()},toRGB:function(){return"rgb("+this.r+","+this.g+","+this.b+")"},toRGBA:function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.alpha+")"}})}(),function(){me.save=function(){function a(a){return"add"===a||"remove"===a}var b={},c={_init:function(){if(me.device.localStorage===!0){var a=JSON.parse(localStorage.getItem("me.save"))||[];a.forEach(function(a){b[a]=JSON.parse(localStorage.getItem("me.save."+a))})}},add:function(d){Object.keys(d).forEach(function(e){a(e)||(!function(a){Object.defineProperty(c,a,{configurable:!0,enumerable:!0,get:function(){return b[a]},set:function(c){b[a]=c,me.device.localStorage===!0&&localStorage.setItem("me.save."+a,JSON.stringify(c))}})}(e),e in b||(c[e]=d[e]))}),me.device.localStorage===!0&&localStorage.setItem("me.save",JSON.stringify(Object.keys(b)))},remove:function(c){a(c)||"undefined"!=typeof b[c]&&(delete b[c],me.device.localStorage===!0&&(localStorage.removeItem("me.save."+c),localStorage.setItem("me.save",JSON.stringify(Object.keys(b)))))}};return c}()}(),function(){me.TMXConstants={COLLISION_GROUP:"collision",TMX_TAG_MAP:"map",TMX_TAG_NAME:"name",TMX_TAG_VALUE:"value",TMX_TAG_VERSION:"version",TMX_TAG_ORIENTATION:"orientation",TMX_TAG_WIDTH:"width",TMX_TAG_HEIGHT:"height",TMX_TAG_TYPE:"type",TMX_TAG_OPACITY:"opacity",TMX_TAG_TRANS:"trans",TMX_TAG_TILEWIDTH:"tilewidth",TMX_TAG_TILEHEIGHT:"tileheight",TMX_TAG_TILEOFFSET:"tileoffset",TMX_TAG_FIRSTGID:"firstgid",TMX_TAG_GID:"gid",TMX_TAG_TILE:"tile",TMX_TAG_ID:"id",TMX_TAG_DATA:"data",TMX_TAG_COMPRESSION:"compression",TMX_TAG_GZIP:"gzip",TMX_TAG_ZLIB:"zlib",TMX_TAG_ENCODING:"encoding",TMX_TAG_ATTR_BASE64:"base64",TMX_TAG_CSV:"csv",TMX_TAG_SPACING:"spacing",TMX_TAG_MARGIN:"margin",TMX_TAG_PROPERTIES:"properties",TMX_TAG_PROPERTY:"property",TMX_TAG_IMAGE:"image",TMX_TAG_SOURCE:"source",TMX_TAG_VISIBLE:"visible",TMX_TAG_TILESET:"tileset",TMX_TAG_LAYER:"layer",TMX_TAG_TILE_LAYER:"tilelayer",TMX_TAG_IMAGE_LAYER:"imagelayer",TMX_TAG_OBJECTGROUP:"objectgroup",TMX_TAG_OBJECT:"object",TMX_TAG_X:"x",TMX_TAG_Y:"y",TMX_TAG_POLYGON:"polygon",TMX_TAG_POLYLINE:"polyline",TMX_TAG_ELLIPSE:"ellipse",TMX_TAG_POINTS:"points",TMX_BACKGROUND_COLOR:"backgroundcolor"}}(),function(a){me.TMXUtils=function(){function b(a){if(!a||a.isBoolean())a=a?"true"===a:!0;else if(a.isNumeric())a=Number(a);else if(a.match(/^json:/i)){var b=a.split(/^json:/i)[1];try{a=JSON.parse(b)}catch(c){throw new me.Error("Unable to parse JSON: "+b)}}return a}var c={},d=function(a,c){if(c.attributes&&c.attributes.length>0)for(var d=0;d<c.attributes.length;d++){var e=c.attributes.item(d);"undefined"!=typeof e.name?a[e.name]=b(e.value):a[e.nodeName]=b(e.nodeValue)}};return c.parse=function(a,b){var c={},e="";if(b=b||1,1===a.nodeType&&d(c,a),a.hasChildNodes()){for(var f=0;f<a.childNodes.length;f++){var g=a.childNodes.item(f),h=g.nodeName;if("undefined"==typeof c[h])if(3===g.nodeType){var i=g.nodeValue.trim();i&&i.length>0&&(e+=i)}else 1===g.nodeType&&(c[h]=me.TMXUtils.parse(g,b),c[h]._draworder=b++);else Array.isArray(c[h])===!1&&(c[h]=[c[h]]),c[h].push(me.TMXUtils.parse(g,b)),c[h][c[h].length-1]._draworder=b++}e.length>0&&(c.value=e,e="")}return c},c.applyTMXProperties=function(c,d){var e=d[a.TMX_TAG_PROPERTIES];if("undefined"!=typeof e)if("undefined"!=typeof e.property){var f=e.property;Array.isArray(f)===!0?f.forEach(function(a){c[a.name]=a.value}):c[f.name]=f.value}else for(var g in e)e.hasOwnProperty(g)&&(c[g]=b(e[g]))},c}()}(me.TMXConstants),function(a){me.TMXObjectGroup=Object.extend({init:function(b,c,d,e){this.name=null,this.width=0,this.height=0,this.z=0,this.objects=[];var f=this;this.name=b,this.width=c[a.TMX_TAG_WIDTH],this.height=c[a.TMX_TAG_HEIGHT],this.z=e,this.objects=[];var g="undefined"!=typeof c[a.TMX_TAG_VISIBLE]?c[a.TMX_TAG_VISIBLE]:!0;this.opacity=g===!0?(+c[a.TMX_TAG_OPACITY]||1).clamp(0,1):0,me.TMXUtils.applyTMXProperties(this,c);var h=c.objects||c.object;Array.isArray(h)===!0?h.forEach(function(a){f.objects.push(new me.TMXObject(a,d,e))}):f.objects.push(new me.TMXObject(h,d,e))},destroy:function(){this.objects=null},getObjectCount:function(){return this.objects.length},getObjectByIndex:function(a){return this.objects[a]}}),me.TMXObject=Object.extend({init:function(b,c,d){if(this.points=void 0,this.name=b[a.TMX_TAG_NAME],this.x=+b[a.TMX_TAG_X],this.y=+b[a.TMX_TAG_Y],this.z=+d,this.width=+b[a.TMX_TAG_WIDTH]||0,this.height=+b[a.TMX_TAG_HEIGHT]||0,this.gid=+b[a.TMX_TAG_GID]||null,this.type=b[a.TMX_TAG_TYPE],this.isEllipse=!1,this.isPolygon=!1,this.isPolyLine=!1,"number"==typeof this.gid)this.setImage(this.gid,c);else if("undefined"!=typeof b[a.TMX_TAG_ELLIPSE])this.isEllipse=!0;else{var e=b[a.TMX_TAG_POLYGON];if("undefined"!=typeof e?this.isPolygon=!0:(e=b[a.TMX_TAG_POLYLINE],"undefined"!=typeof e&&(this.isPolyLine=!0)),"undefined"!=typeof e)if(this.points=[],"undefined"!=typeof e.points){e=e.points.split(" ");for(var f,g=0;g<e.length;g++)f=e[g].split(","),this.points.push(new me.Vector2d(+f[0],+f[1]))}else{var h=this;e.forEach(function(a){h.points.push(new me.Vector2d(+a.x,+a.y))})}}me.game.tmxRenderer.adjustPosition(this),me.TMXUtils.applyTMXProperties(this,b)},setImage:function(a,b){var c=b.getTilesetByGid(this.gid);this.width=c.tilewidth,this.height=c.tileheight,this.spritewidth=this.width;var d=new me.Tile(this.x,this.y,c.tilewidth,c.tileheight,this.gid);this.image=c.getTileImage(d),"undefined"==typeof this.name&&(this.name="TileObject")},getTMXShapes:function(){if(this.isEllipse===!0)return[new me.Ellipse(this.width/2,this.height/2,this.width,this.height)];if(this.isPolygon===!0)return[new me.Polygon(0,0,this.points)];if(this.isPolyLine===!0){for(var a=this.points,b=a.length-1,c=[],d=0;b>d;d++)c.push(new me.Line(0,0,[a[d],a[d+1]]));return c}return[new me.Polygon(0,0,[new me.Vector2d,new me.Vector2d(this.width,0),new me.Vector2d(this.width,this.height),new me.Vector2d(0,this.height)])]},getObjectPropertyByName:function(a){return this[a]}})}(me.TMXConstants),function(a){var b=2147483648,c=1073741824,d=536870912;me.Tile=me.Rect.extend({init:function(a,e,f,g,h){this.tileset=null,this.transform=null,me.Rect.prototype.init.apply(this,[a*f,e*g,f,g]),this.col=a,this.row=e,this.tileId=h,this.flippedX=0!==(this.tileId&b),this.flippedY=0!==(this.tileId&c),this.flippedAD=0!==(this.tileId&d),this.flipped=this.flippedX||this.flippedY||this.flippedAD,this.flipped===!0&&this.createTransform(),this.tileId&=~(b|c|d)},createTransform:function(){null===this.transform&&(this.transform=new me.Matrix2d),this.transform.identity(),this.flippedAD&&(this.transform.set(0,1,1,0),this.transform.translate(0,this.height-this.width)),this.flippedX&&(this.transform.a*=-1,this.transform.c*=-1,this.transform.translate(this.flippedAD?this.height:this.width,0)),this.flippedY&&(this.transform.b*=-1,this.transform.d*=-1,this.transform.translate(0,this.flippedAD?this.width:this.height))}}),me.TMXTileset=Object.extend({init:function(b){this.TileProperties=[],this.tileXOffset=[],this.tileYOffset=[],this.firstgid=this.lastgid=+b[a.TMX_TAG_FIRSTGID];var c=b[a.TMX_TAG_SOURCE];if(c&&"tsx"===me.utils.getFileExtension(c).toLowerCase()&&(c=me.utils.getBasename(c),b=me.loader.getTMX(c),!b))throw new me.Error(c+" TSX tileset not found");this.name=b[a.TMX_TAG_NAME],this.tilewidth=+b[a.TMX_TAG_TILEWIDTH],this.tileheight=+b[a.TMX_TAG_TILEHEIGHT],this.spacing=+b[a.TMX_TAG_SPACING]||0,this.margin=+b[a.TMX_TAG_MARGIN]||0,this.tileoffset=new me.Vector2d(0,0);var d=b[a.TMX_TAG_TILEOFFSET];d&&(this.tileoffset.x=+d[a.TMX_TAG_X],this.tileoffset.y=+d[a.TMX_TAG_Y]);var e=b.tileproperties;if(e)for(var f in e)e.hasOwnProperty(f)&&this.setTileProperty(f+this.firstgid,e[f]);else if(b[a.TMX_TAG_TILE]){e=b[a.TMX_TAG_TILE],Array.isArray(e)||(e=[e]);for(var g=0;g<e.length;g++){var h=e[g][a.TMX_TAG_ID]+this.firstgid,i={};me.TMXUtils.applyTMXProperties(i,e[g]),this.setTileProperty(h,i)}}var j="string"==typeof b[a.TMX_TAG_IMAGE]?b[a.TMX_TAG_IMAGE]:b[a.TMX_TAG_IMAGE].source;if(j=me.utils.getBasename(j),this.image=j?me.loader.getImage(j):null,this.image){this.hTileCount=~~((this.image.width-this.margin)/(this.tilewidth+this.spacing)),this.vTileCount=~~((this.image.height-this.margin)/(this.tileheight+this.spacing)),this.lastgid=this.firstgid+(this.hTileCount*this.vTileCount-1||0);var k=b[a.TMX_TAG_TRANS]||b[a.TMX_TAG_IMAGE][a.TMX_TAG_TRANS];"undefined"!=typeof k&&(this.image=me.video.renderer.applyRGBFilter(this.image,"transparent",k.toUpperCase()).canvas)}else console.log("melonJS: '"+j+"' file for tileset '"+this.name+"' not found!")},setTileProperty:function(a,b){this.TileProperties[a]=b},contains:function(a){return a>=this.firstgid&&a<=this.lastgid},getTileImage:function(a){var b=me.CanvasRenderer.getContext2d(me.video.createCanvas(this.tilewidth,this.tileheight));return this.drawTile(b,0,0,a),b.canvas},getTileProperties:function(a){return this.TileProperties[a]},getTileOffsetX:function(a){var b=this.tileXOffset[a];return"undefined"==typeof b&&(b=this.tileXOffset[a]=this.margin+(this.spacing+this.tilewidth)*(a%this.hTileCount)),b},getTileOffsetY:function(a){var b=this.tileYOffset[a];return"undefined"==typeof b&&(b=this.tileYOffset[a]=this.margin+(this.spacing+this.tileheight)*~~(a/this.hTileCount)),b},drawTile:function(a,b,c,d){if(d.flipped){a.save();var e=d.transform;a.transform(e.a,e.b,e.c,e.d,e.e+b,e.f+c),b=c=0}var f=d.tileId-this.firstgid;a.drawImage(this.image,this.getTileOffsetX(f),this.getTileOffsetY(f),this.tilewidth,this.tileheight,b,c,this.tilewidth,this.tileheight),d.flipped&&a.restore()}}),me.TMXTilesetGroup=Object.extend({init:function(){this.tilesets=[]},add:function(a){this.tilesets.push(a)},getTilesetByIndex:function(a){return this.tilesets[a]},getTilesetByGid:function(a){for(var b=-1,c=0,d=this.tilesets.length;d>c;c++){if(this.tilesets[c].contains(a))return this.tilesets[c];this.tilesets[c].firstgid===this.tilesets[c].lastgid&&a>=this.tilesets[c].firstgid&&(b=c)}if(-1!==b)return this.tilesets[b];throw new me.Error("no matching tileset found for gid "+a)}})}(me.TMXConstants),function(){me.TMXOrthogonalRenderer=Object.extend({init:function(a,b,c,d){this.cols=a,this.rows=b,this.tilewidth=c,this.tileheight=d},canRender:function(a){return"orthogonal"===a.orientation&&this.cols===a.cols&&this.rows===a.rows&&this.tilewidth===a.tilewidth&&this.tileheight===a.tileheight},pixelToTileCoords:function(a,b){return new me.Vector2d(this.pixelToTileX(a),this.pixelToTileY(b))},pixelToTileX:function(a){return a/this.tilewidth},pixelToTileY:function(a){return a/this.tileheight},tileToPixelCoords:function(a,b){return new me.Vector2d(a*this.tilewidth,b*this.tileheight)},adjustPosition:function(a){"number"==typeof a.gid&&(a.y-=a.height)},drawTile:function(a,b,c,d,e){e.drawTile(a,e.tileoffset.x+b*this.tilewidth,e.tileoffset.y+(c+1)*this.tileheight-e.tileheight,d)},drawTileLayer:function(a,b,c){var d=this.pixelToTileCoords(c.pos.x,c.pos.y).floorSelf(),e=this.pixelToTileCoords(c.pos.x+c.width+this.tilewidth,c.pos.y+c.height+this.tileheight).ceilSelf();e.x=e.x>this.cols?this.cols:e.x,e.y=e.y>this.rows?this.rows:e.y;for(var f=d.y;f<e.y;f++)for(var g=d.x;g<e.x;g++){var h=b.layerData[g][f];h&&this.drawTile(a,g,f,h,h.tileset)}}}),me.TMXIsometricRenderer=Object.extend({init:function(a,b,c,d){this.cols=a,this.rows=b,this.tilewidth=c,this.tileheight=d,this.hTilewidth=c/2,this.hTileheight=d/2,this.originX=this.rows*this.hTilewidth},canRender:function(a){return"isometric"===a.orientation&&this.cols===a.cols&&this.rows===a.rows&&this.tilewidth===a.tilewidth&&this.tileheight===a.tileheight},pixelToTileCoords:function(a,b){return new me.Vector2d(this.pixelToTileX(a,b),this.pixelToTileY(b,a))},pixelToTileX:function(a,b){return b/this.tileheight+(a-this.originX)/this.tilewidth},pixelToTileY:function(a,b){return a/this.tileheight-(b-this.originX)/this.tilewidth},tileToPixelCoords:function(a,b){return new me.Vector2d((a-b)*this.hTilewidth+this.originX,(a+b)*this.hTileheight)},adjustPosition:function(a){var b=a.x/this.hTilewidth,c=a.y/this.tileheight,d=this.tileToPixelCoords(b,c);d.x-=a.width/2,d.y-=a.height,a.x=d.x,a.y=d.y},drawTile:function(a,b,c,d,e){e.drawTile(a,(this.cols-1)*e.tilewidth+(b-c)*e.tilewidth>>1,-e.tilewidth+(b+c)*e.tileheight>>2,d)},drawTileLayer:function(a,b,c){var d=b.tileset,e=d.tileoffset,f=this.pixelToTileCoords(c.pos.x-d.tilewidth,c.pos.y-d.tileheight).floorSelf(),g=this.pixelToTileCoords(c.pos.x+c.width+d.tilewidth,c.pos.y+c.height+d.tileheight).ceilSelf(),h=this.tileToPixelCoords(g.x,g.y),i=this.tileToPixelCoords(f.x,f.y);i.x-=this.hTilewidth,i.y+=this.tileheight;var j=i.y-c.pos.y>this.hTileheight,k=c.pos.x-i.x<this.hTilewidth;j&&(k?(f.x--,i.x-=this.hTilewidth):(f.y--,i.x+=this.hTilewidth),i.y-=this.hTileheight);for(var l=j^k,m=f.clone(),n=i.y;n-this.tileheight<h.y;n+=this.hTileheight){m.setV(f);for(var o=i.x;o<h.x;o+=this.tilewidth){if(m.x>=0&&m.y>=0&&m.x<this.cols&&m.y<this.rows){var p=b.layerData[m.x][m.y];p&&(d=p.tileset,e=d.tileoffset,d.drawTile(a,e.x+o,e.y+n-d.tileheight,p))}m.x++,m.y--}l?(f.y++,i.x-=this.hTilewidth,l=!1):(f.x++,i.x+=this.hTilewidth,l=!0)}}})}(),function(a){me.ColorLayer=me.Renderable.extend({init:function(a,b,c){me.Renderable.prototype.init.apply(this,[0,0,1/0,1/0]),this.name=a,this.color=b,this.z=c,this.floating=!0},draw:function(a,b){var c=a.globalAlpha();a.setGlobalAlpha(c*this.getOpacity());var d=me.game.viewport.pos;a.setColor(this.color),a.fillRect(b.left-d.x,b.top-d.y,b.width,b.height),a.setGlobalAlpha(c)}}),me.ImageLayer=me.Renderable.extend({init:function(a,b,c,d,e,f){if(this.name=a,this.image=d?me.loader.getImage(me.utils.getBasename(d)):null,!this.image)throw new me.Error("'"+d+"' file for Image Layer '"+this.name+"' not found!");this.imagewidth=this.image.width,this.imageheight=this.image.height;var g=me.game.viewport;b=b?Math.min(g.width,b):g.width,c=c?Math.min(g.height,c):g.height,me.Renderable.prototype.init.apply(this,[0,0,b,c]),this.z=e,this.ratio=new me.Vector2d(1,1),"undefined"!=typeof f&&("number"==typeof f?this.ratio.set(f,f):this.ratio.setV(f)),this.lastpos=g.pos.clone(),this.floating=!0,this._repeat="repeat",this.repeatX=!0,this.repeatY=!0,Object.defineProperty(this,"repeat",{get:function(){return this._repeat},set:function(a){switch(this._repeat=a,this._repeat){case"no-repeat":this.repeatX=!1,this.repeatY=!1;break;case"repeat-x":this.repeatX=!0,this.repeatY=!1;break;case"repeat-y":this.repeatX=!1,this.repeatY=!0;break;default:this.repeatX=!0,this.repeatY=!0}}}),this.anchorPoint.set(0,0),this.handle=me.event.subscribe(me.event.VIEWPORT_ONCHANGE,this.updateLayer.bind(this))},updateLayer:function(a){(0!==this.ratio.x||0!==this.ratio.y)&&(this.repeatX||this.repeatY?(this.pos.x+=(a.x-this.lastpos.x)*this.ratio.x%this.imagewidth,this.pos.x=(this.imagewidth+this.pos.x)%this.imagewidth,this.pos.y+=(a.y-this.lastpos.y)*this.ratio.y%this.imageheight,this.pos.y=(this.imageheight+this.pos.y)%this.imageheight):(this.pos.x+=(a.x-this.lastpos.x)*this.ratio.x,this.pos.y+=(a.y-this.lastpos.y)*this.ratio.y),this.lastpos.setV(a))},draw:function(a,b){var c=me.game.viewport,d=0!==this.anchorPoint.y||0!==this.anchorPoint.x,e=~~(this.anchorPoint.x*(c.width-this.imagewidth)),f=~~(this.anchorPoint.y*(c.height-this.imageheight));d&&a.translate(e,f),a.setGlobalAlpha(a.globalAlpha()*this.getOpacity());var g,h;if(0===this.ratio.x&&0===this.ratio.y)g=Math.min(b.width,this.imagewidth),h=Math.min(b.height,this.imageheight),a.drawImage(this.image,b.left,b.top,g,h,b.left,b.top,g,h);else{var i=~~this.pos.x,j=~~this.pos.y,k=0,l=0;for(g=Math.min(this.imagewidth-i,this.width),h=Math.min(this.imageheight-j,this.height);;){do a.drawImage(this.image,i,j,g,h,k,l,g,h),j=0,l+=h,h=Math.min(this.imageheight,this.height-l);while(this.repeatY&&l<this.height);if(k+=g,!this.repeatX||k>=this.width)break;i=0,g=Math.min(this.imagewidth,this.width-k),j=~~this.pos.y,l=0,h=Math.min(this.imageheight-~~this.pos.y,this.height)}}d&&a.translate(-e,-f)},destroy:function(){this.handle&&(me.event.unsubscribe(this.handle),this.handle=null),this.image=null,this.lastpos=null}}),me.TMXLayer=me.Renderable.extend({init:function(a,b,c,d,e){me.Renderable.prototype.init.apply(this,[0,0,0,0]),this.tilewidth=a,this.tileheight=b,this.orientation=c,this.tilesets=d,this.tileset=this.tilesets?this.tilesets.getTilesetByIndex(0):null,this.z=e},initFromJSON:function(b){this.name=b[a.TMX_TAG_NAME],this.cols=+b[a.TMX_TAG_WIDTH],this.rows=+b[a.TMX_TAG_HEIGHT];var c="undefined"!=typeof b[a.TMX_TAG_VISIBLE]?b[a.TMX_TAG_VISIBLE]:!0;this.setOpacity(c?+b[a.TMX_TAG_OPACITY]:0),"isometric"===this.orientation?(this.width=(this.cols+this.rows)*(this.tilewidth/2),this.height=(this.cols+this.rows)*(this.tileheight/2)):(this.width=this.cols*this.tilewidth,this.height=this.rows*this.tileheight),me.TMXUtils.applyTMXProperties(this,b),"undefined"==typeof this.preRender&&(this.preRender=me.sys.preRender),this.preRender===!0&&(this.layerCanvas=me.video.createCanvas(this.cols*this.tilewidth,this.rows*this.tileheight),this.layerSurface=me.CanvasRenderer.getContext2d(this.layerCanvas))},destroy:function(){this.preRender&&(this.layerCanvas=null,this.layerSurface=null),this.renderer=null,this.layerData=null,this.tileset=null,this.tilesets=null},setRenderer:function(a){this.renderer=a},initArray:function(a,b){this.layerData=[];for(var c=0;a>c;c++){this.layerData[c]=[];for(var d=0;b>d;d++)this.layerData[c][d]=null}},getTileId:function(a,b){var c=this.getTile(a,b);return c?c.tileId:null},getTile:function(a,b){return this.layerData[~~this.renderer.pixelToTileX(a,b)][~~this.renderer.pixelToTileY(b,a)]},setTile:function(a,b,c){var d=new me.Tile(a,b,this.tilewidth,this.tileheight,c);return d.tileset=this.tileset.contains(d.tileId)?this.tileset:this.tileset=this.tilesets.getTilesetByGid(d.tileId),this.layerData[a][b]=d,d},clearTile:function(a,b){this.layerData[a][b]=null,this.preRender&&this.layerSurface.clearRect(a*this.tilewidth,b*this.tileheight,this.tilewidth,this.tileheight)},draw:function(a,b){if(this.preRender){var c=Math.min(b.width,this.width),d=Math.min(b.height,this.height);this.layerSurface.globalAlpha=a.globalAlpha()*this.getOpacity(),this.layerSurface.globalAlpha>0&&a.drawImage(this.layerCanvas,b.pos.x,b.pos.y,c,d,b.pos.x,b.pos.y,c,d)}else{var e=a.globalAlpha();a.setGlobalAlpha(a.globalAlpha()*this.getOpacity()),a.globalAlpha()>0&&this.renderer.drawTileLayer(a,this,b),a.setGlobalAlpha(e)}}})}(me.TMXConstants),function(){me.TMXTileMap=me.Renderable.extend({init:function(a){this.levelId=a,this.z=0,this.name=null,this.cols=0,this.rows=0,this.tilewidth=0,this.tileheight=0,this.tilesets=null,this.mapLayers=[],this.objectGroups=[],this.version="",this.orientation="",this.tilesets=null,this.initialized=!1,me.Renderable.prototype.init.apply(this,[0,0,0,0])},setDefaultPosition:function(a,b){if(this.width<a||this.height<b){var c=~~((a-this.width)/2),d=~~((b-this.height)/2);this.pos.set(c>0?c:0,d>0?d:0)}},getObjectGroupByName:function(a){var b=null;a=a.trim().toLowerCase();for(var c=this.objectGroups.length;c--;)if(this.objectGroups[c].name.toLowerCase().contains(a)){b=this.objectGroups[c];break}return b},getObjectGroups:function(){return this.objectGroups},getLayers:function(){return this.mapLayers},getLayerByName:function(a){var b=null;a=a.trim().toLowerCase();for(var c=this.mapLayers.length;c--;)if(this.mapLayers[c].name.toLowerCase().contains(a)){b=this.mapLayers[c];break}return b},clearTile:function(a,b){for(var c=this.mapLayers.length;c--;)this.mapLayers[c]instanceof me.TMXLayer&&this.mapLayers[c].clearTile(a,b)},destroy:function(){var a;if(this.initialized===!0){for(a=this.mapLayers.length;a--;)this.mapLayers[a]=null;for(a=this.objectGroups.length;a--;)this.objectGroups[a].destroy(),this.objectGroups[a]=null;this.tilesets=null,this.mapLayers.length=0,this.objectGroups.length=0,this.pos.set(0,0),this.initialized=!1}}})}(),function(a){me.TMXMapReader=Object.extend({init:function(){},readMap:function(b,c){if(b.initialized!==!0){var d=0,e=this;b.version=c[a.TMX_TAG_VERSION],b.orientation=c[a.TMX_TAG_ORIENTATION],b.cols=+c[a.TMX_TAG_WIDTH],b.rows=+c[a.TMX_TAG_HEIGHT],b.tilewidth=+c[a.TMX_TAG_TILEWIDTH],b.tileheight=+c[a.TMX_TAG_TILEHEIGHT],"isometric"===b.orientation?(b.width=(b.cols+b.rows)*(b.tilewidth/2),b.height=(b.cols+b.rows)*(b.tileheight/2)):(b.width=b.cols*b.tilewidth,b.height=b.rows*b.tileheight),b.backgroundcolor=c[a.TMX_BACKGROUND_COLOR],b.z=d++,me.TMXUtils.applyTMXProperties(b,c),b.backgroundcolor&&b.mapLayers.push(new me.ColorLayer("background_color",b.backgroundcolor,d++)),b.background_image&&b.mapLayers.push(new me.ImageLayer("background_image",b.width,b.height,b.background_image,d++)),null!==me.game.tmxRenderer&&me.game.tmxRenderer.canRender(b)||(me.game.tmxRenderer=this.getNewDefaultRenderer(b)),b.tilesets||(b.tilesets=new me.TMXTilesetGroup);var f=c.tilesets||c.tileset;if(Array.isArray(f)===!0?f.forEach(function(a){b.tilesets.add(e.readTileset(a))}):b.tilesets.add(e.readTileset(f)),"undefined"!=typeof c.layers)c.layers.forEach(function(c){switch(c.type){case a.TMX_TAG_IMAGE_LAYER:b.mapLayers.push(e.readImageLayer(b,c,d++));break;case a.TMX_TAG_TILE_LAYER:b.mapLayers.push(e.readLayer(b,c,d++));break;case a.TMX_TAG_OBJECTGROUP:b.objectGroups.push(e.readObjectGroup(b,c,d++))}});else if("undefined"!=typeof c.layer){var g=c.layer;if(Array.isArray(g)===!0?g.forEach(function(a){b.mapLayers.push(e.readLayer(b,a,a._draworder))}):b.mapLayers.push(e.readLayer(b,g,g._draworder)),"undefined"!=typeof c[a.TMX_TAG_OBJECTGROUP]){var h=c[a.TMX_TAG_OBJECTGROUP];Array.isArray(h)===!0?h.forEach(function(a){b.objectGroups.push(e.readObjectGroup(b,a,a._draworder))}):b.objectGroups.push(e.readObjectGroup(b,h,h._draworder))}if("undefined"!=typeof c[a.TMX_TAG_IMAGE_LAYER]){var i=c[a.TMX_TAG_IMAGE_LAYER];Array.isArray(i)===!0?i.forEach(function(a){b.mapLayers.push(e.readImageLayer(b,a,a._draworder))}):b.mapLayers.push(e.readImageLayer(b,i,i._draworder))}}b.initialized=!0}},getNewDefaultRenderer:function(a){switch(a.orientation){case"orthogonal":return new me.TMXOrthogonalRenderer(a.cols,a.rows,a.tilewidth,a.tileheight);case"isometric":return new me.TMXIsometricRenderer(a.cols,a.rows,a.tilewidth,a.tileheight);default:throw new me.Error(a.orientation+" type TMX Tile Map not supported!")}},setLayerData:function(b,c,d,e){b.initArray(b.cols,b.rows);var f=Array.isArray(c)===!0?c:c.value;switch(d){case"json":f=c;break;case a.TMX_TAG_CSV:case a.TMX_TAG_ATTR_BASE64:d===a.TMX_TAG_CSV?f=me.utils.decodeCSV(f,b.cols):(f=me.utils.decodeBase64AsArray(f,4),null!==e&&(f=me.utils.decompress(f,e)));break;default:throw new me.Error("TMX Tile Map "+d+" encoding not supported!")}for(var g=0,h=0;h<b.rows;h++)for(var i=0;i<b.cols;i++){var j=null==d?this.TMXParser.getIntAttribute(f[g++],a.TMX_TAG_GID):f[g++];if(0!==j){var k=b.setTile(i,h,j);b.preRender&&b.renderer.drawTile(b.layerSurface,i,h,k,k.tileset)}}},readLayer:function(b,c,d){var e=new me.TMXLayer(b.tilewidth,b.tileheight,b.orientation,b.tilesets,d);e.initFromJSON(c),e.setRenderer(me.game.tmxRenderer.canRender(e)?me.game.tmxRenderer:me.mapReader.getNewDefaultRenderer(e));var f=Array.isArray(c[a.TMX_TAG_DATA])?c[a.TMX_TAG_ENCODING]:c[a.TMX_TAG_DATA][a.TMX_TAG_ENCODING];return this.setLayerData(e,c[a.TMX_TAG_DATA],f||"json",null),e},readImageLayer:function(b,c,d){var e=c[a.TMX_TAG_NAME],f=+c[a.TMX_TAG_WIDTH],g=+c[a.TMX_TAG_HEIGHT],h="string"!=typeof c[a.TMX_TAG_IMAGE]?c[a.TMX_TAG_IMAGE].source:c[a.TMX_TAG_IMAGE],i=new me.ImageLayer(e,f*b.tilewidth,g*b.tileheight,h,d),j="undefined"!=typeof c[a.TMX_TAG_VISIBLE]?c[a.TMX_TAG_VISIBLE]:!0;if(i.setOpacity(j===!0?(+c[a.TMX_TAG_OPACITY]||1).clamp(0,1):0),me.TMXUtils.applyTMXProperties(i,c),"number"==typeof i.ratio){var k=i.ratio;i.ratio=new me.Vector2d(k,k)}return i},readTileset:function(a){return new me.TMXTileset(a)},readObjectGroup:function(b,c,d){return new me.TMXObjectGroup(c[a.TMX_TAG_NAME],c,b.tilesets,d)}})}(me.TMXConstants),function(){me.levelDirector=function(){var a={},b={},c=[],d=0,e=function(a,b){b.autoSort=!1,me.game.currentLevel=a,me.game.viewport.setBounds(0,0,Math.max(a.width,me.game.viewport.width),Math.max(a.height,me.game.viewport.height)),a.setDefaultPosition(me.game.viewport.width,me.game.viewport.height);for(var c=a.getLayers(),d=c.length;d--;)b.addChild(c[d]);for(var e=b,f=!1,g=a.getObjectGroups(),h=0;h<g.length;h++){var i=g[h];f=i.name.toLowerCase().contains(me.TMXConstants.COLLISION_GROUP),me.game.mergeGroup===!1&&(e=new me.Container,e.name=i.name,e.z=i.z,e.setOpacity(i.opacity),e.autoSort=!1);for(var j=0;j<i.objects.length;j++){var k,l=i.objects[j];f===!1?k=me.pool.pull(l.name,l.x,l.y,"TileObject"===l.name?l.image:l):(k=me.pool.pull("me.Entity",l.x,l.y,l),k.body.collisionType=me.collision.types.WORLD_SHAPE),k&&(k.z=i.z,me.game.mergeGroup===!0&&k.isRenderable===!0&&(k.setOpacity(k.getOpacity()*i.opacity),k.renderable instanceof me.Renderable&&k.renderable.setOpacity(k.renderable.getOpacity()*i.opacity)),e.addChild(k))}me.game.mergeGroup===!1&&(b.addChild(e),e.autoSort=!0)}b.sort(!0),b.autoSort=!0,me.game.world.transform.translateV(me.game.currentLevel.pos),me.game.world.resize(me.game.currentLevel.width,me.game.currentLevel.height),me.game.onLevelLoaded&&me.game.onLevelLoaded.call(me.game.onLevelLoaded,a.name),me.event.publish(me.event.LEVEL_LOADED,[a.name])};return a.reset=function(){},a.addLevel=function(){throw new me.Error("no level loader defined")},a.addTMXLevel=function(a,d){return null!=b[a]?!1:(b[a]=new me.TMXTileMap(a),b[a].name=a,c.push(a),d&&d(),!0)},a.loadLevel=function(f){if(f=f.toString().toLowerCase(),"undefined"==typeof b[f])throw new me.Error("level "+f+" not found");if(!(b[f]instanceof me.TMXTileMap))throw new me.Error("no level loader defined");var g=me.state.isRunning();return g&&me.state.stop(),me.game.reset(),me.utils.resetGUID(f),b[a.getCurrentLevelId()]&&b[a.getCurrentLevelId()].destroy(),me.mapReader.readMap(b[f],me.loader.getTMX(f)),d=c.indexOf(f),e(b[f],me.game.world),g&&me.state.restart.defer(this),!0},a.getCurrentLevelId=function(){return c[d]},a.reloadLevel=function(){return a.loadLevel(a.getCurrentLevelId())},a.nextLevel=function(){return d+1<c.length?a.loadLevel(c[d+1]):!1},a.previousLevel=function(){return d-1>=0?a.loadLevel(c[d-1]):!1},a.levelCount=function(){return c.length},a}()}(),/**
 * @preserve Tween JS
 * https://github.com/sole/Tween.js
 */
function(){me.Tween=function(a){var b=a,c={},d={},e={},f=1e3,g=0,h=!1,i=!1,j=0,k=null,l=me.Tween.Easing.Linear.None,m=me.Tween.Interpolation.Linear,n=[],o=null,p=!1,q=null,r=null;for(var s in a)"object"!=typeof a&&(c[s]=parseFloat(a[s],10));this.onResetEvent=function(a){b=a,c={},d={},e={},l=me.Tween.Easing.Linear.None,m=me.Tween.Interpolation.Linear,h=!1,i=!1,f=1e3,j=0,o=null,p=!1,q=null,r=null},this.to=function(a,b){return void 0!==b&&(f=b),d=a,this},this.start=function(a){p=!1,me.game.world.addChild(this),k=("undefined"==typeof a?me.timer.getTime():a)+j;for(var f in d){if(d[f]instanceof Array){if(0===d[f].length)continue;d[f]=[b[f]].concat(d[f])}c[f]=b[f],c[f]instanceof Array==!1&&(c[f]*=1),e[f]=c[f]||0}return this},this.stop=function(){return me.game.world.hasChild(this)&&me.game.world.removeChildNow(this),this},this.delay=function(a){return j=a,this},me.event.subscribe(me.event.STATE_RESUME,function(a){k&&(k+=a)}),this.repeat=function(a){return g=a,this},this.yoyo=function(a){return h=a,this},this.easing=function(a){if("function"!=typeof a)throw new me.Tween.Error("invalid easing function for me.Tween.easing()");return l=a,this},this.interpolation=function(a){return m=a,this},this.chain=function(){return n=arguments,this},this.onStart=function(a){return o=a,this},this.onUpdate=function(a){return q=a,this},this.onComplete=function(a){return r=a,this},this.update=function(){var a,s=me.timer.getTime();if(k>s)return!0;p===!1&&(null!==o&&o.call(b),p=!0);var t=(s-k)/f;t=t>1?1:t;var u=l(t);for(a in d){var v=c[a]||0,w=d[a];w instanceof Array?b[a]=m(w,u):("string"==typeof w&&(w=v+parseFloat(w,10)),"number"==typeof w&&(b[a]=v+(w-v)*u))}if(null!==q&&q.call(b,u),1===t){if(g>0){isFinite(g)&&g--;for(a in e){if("string"==typeof d[a]&&(e[a]=e[a]+parseFloat(d[a],10)),h){var x=e[a];e[a]=d[a],d[a]=x}c[a]=e[a]}return h&&(i=!i),k=s+j,!0}me.game.world.removeChildNow(this),null!==r&&r.call(b);for(var y=0,z=n.length;z>y;y++)n[y].start(s);return!1}return!0}},me.Tween.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return(a*=2)<1?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return(a*=2)<1?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return(a*=2)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return(a*=2)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:(a*=2)<1?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),-(c*Math.pow(2,10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d)))},Out:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),c*Math.pow(2,-10*a)*Math.sin(2*(a-b)*Math.PI/d)+1)},InOut:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),(a*=2)<1?-.5*c*Math.pow(2,10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d):c*Math.pow(2,-10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d)*.5+1)}},Back:{In:function(a){var b=1.70158;return a*a*((b+1)*a-b)},Out:function(a){var b=1.70158;return--a*a*((b+1)*a+b)+1},InOut:function(a){var b=2.5949095;return(a*=2)<1?.5*a*a*((b+1)*a-b):.5*((a-=2)*a*((b+1)*a+b)+2)}},Bounce:{In:function(a){return 1-me.Tween.Easing.Bounce.Out(1-a)},Out:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*me.Tween.Easing.Bounce.In(2*a):.5*me.Tween.Easing.Bounce.Out(2*a-1)+.5}}},me.Tween.Interpolation={Linear:function(a,b){var c=a.length-1,d=c*b,e=Math.floor(d),f=me.Tween.Interpolation.Utils.Linear;return 0>b?f(a[0],a[1],d):b>1?f(a[c],a[c-1],c-d):f(a[e],a[e+1>c?c:e+1],d-e)},Bezier:function(a,b){var c,d=0,e=a.length-1,f=Math.pow,g=me.Tween.Interpolation.Utils.Bernstein;for(c=0;e>=c;c++)d+=f(1-b,e-c)*f(b,c)*a[c]*g(e,c);return d},CatmullRom:function(a,b){var c=a.length-1,d=c*b,e=Math.floor(d),f=me.Tween.Interpolation.Utils.CatmullRom;return a[0]===a[c]?(0>b&&(e=Math.floor(d=c*(1+b))),f(a[(e-1+c)%c],a[e],a[(e+1)%c],a[(e+2)%c],d-e)):0>b?a[0]-(f(a[0],a[0],a[1],a[1],-d)-a[0]):b>1?a[c]-(f(a[c],a[c],a[c-1],a[c-1],d-c)-a[c]):f(a[e?e-1:0],a[e],a[e+1>c?c:e+1],a[e+2>c?c:e+2],d-e)},Utils:{Linear:function(a,b,c){return(b-a)*c+a},Bernstein:function(a,b){var c=me.Tween.Interpolation.Utils.Factorial;return c(a)/c(b)/c(a-b)},Factorial:function(){var a=[1];return function(b){var c,d=1;if(a[b])return a[b];for(c=b;c>1;c--)d*=c;return a[b]=d}}(),CatmullRom:function(a,b,c,d,e){var f=.5*(c-a),g=.5*(d-b),h=e*e,i=e*h;return(2*b-2*c+f+g)*i+(-3*b+3*c-2*f-g)*h+f*e+b}}},me.Tween.Error=me.Error.extend({init:function(a){me.Error.prototype.init.apply(this,[a]),this.name="me.Tween.Error"}})}(),/**
 * @preserve MinPubSub
 * a micro publish/subscribe messaging framework
 * @see https://github.com/daniellmb/MinPubSub
 * @author Daniel Lamb <daniellmb.com>
 *
 * Released under the MIT License
 */
function(){me.event=function(){var a={},b={};return a.STATE_PAUSE="me.state.onPause",a.STATE_RESUME="me.state.onResume",a.STATE_STOP="me.state.onStop",a.STATE_RESTART="me.state.onRestart",a.GAME_INIT="me.game.onInit",a.LEVEL_LOADED="me.game.onLevelLoaded",a.LOADER_COMPLETE="me.loader.onload",a.LOADER_PROGRESS="me.loader.onProgress",a.KEYDOWN="me.input.keydown",a.KEYUP="me.input.keyup",a.MOUSEMOVE="me.game.pointermove",a.DRAGSTART="me.game.dragstart",a.DRAGEND="me.game.dragend",a.WINDOW_ONRESIZE="window.onresize",a.WINDOW_ONORIENTATION_CHANGE="window.orientationchange",a.WINDOW_ONSCROLL="window.onscroll",a.VIEWPORT_ONCHANGE="viewport.onchange",a.publish=function(a,c){for(var d=b[a],e=d?d.length:0;e--;)d[e].apply(window,c||[])},a.subscribe=function(a,c){return b[a]||(b[a]=[]),b[a].push(c),[a,c]},a.unsubscribe=function(a,c){var d=b[c?a:a[0]],e=d?d.length:0;for(c=c||a[1];e--;)d[e]===c&&d.splice(e,1)},a}()}(),/*!
 *  howler.js v1.1.25
 *  howlerjs.com
 *
 *  (c) 2013-2014, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
function(){var a={},b=null,c=!0,d=!1;try{"undefined"!=typeof AudioContext?b=new AudioContext:"undefined"!=typeof webkitAudioContext?b=new webkitAudioContext:c=!1}catch(e){c=!1}if(!c)if("undefined"!=typeof Audio)try{new Audio}catch(e){d=!0}else d=!0;if(c){var f="undefined"==typeof b.createGain?b.createGainNode():b.createGain();f.gain.value=1,f.connect(b.destination)}var g=function(a){this._volume=1,this._muted=!1,this.usingWebAudio=c,this.ctx=b,this.noAudio=d,this._howls=[],this._codecs=a,this.iOSAutoEnable=!0};g.prototype={volume:function(a){var b=this;if(a=parseFloat(a),a>=0&&1>=a){b._volume=a,c&&(f.gain.value=a);for(var d in b._howls)if(b._howls.hasOwnProperty(d)&&b._howls[d]._webAudio===!1)for(var e=0;e<b._howls[d]._audioNode.length;e++)b._howls[d]._audioNode[e].volume=b._howls[d]._volume*b._volume;return b}return c?f.gain.value:b._volume},mute:function(){return this._setMuted(!0),this},unmute:function(){return this._setMuted(!1),this},_setMuted:function(a){var b=this;b._muted=a,c&&(f.gain.value=a?0:b._volume);for(var d in b._howls)if(b._howls.hasOwnProperty(d)&&b._howls[d]._webAudio===!1)for(var e=0;e<b._howls[d]._audioNode.length;e++)b._howls[d]._audioNode[e].muted=a},codecs:function(a){return this._codecs[a]},_enableiOSAudio:function(){var a=this;if(!b||!a._iOSEnabled&&/iPhone|iPad|iPod/i.test(navigator.userAgent)){a._iOSEnabled=!1;var c=function(){var d=b.createBuffer(1,1,22050),e=b.createBufferSource();e.buffer=d,e.connect(b.destination),"undefined"==typeof e.start?e.noteOn(0):e.start(0),setTimeout(function(){(e.playbackState===e.PLAYING_STATE||e.playbackState===e.FINISHED_STATE)&&(a._iOSEnabled=!0,a.iOSAutoEnable=!1,window.removeEventListener("touchstart",c,!1))},0)};return window.addEventListener("touchstart",c,!1),a}}};var h=null,i={};d||(h=new Audio,i={mp3:!!h.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!h.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!h.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!h.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!h.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(h.canPlayType("audio/x-m4a;")||h.canPlayType("audio/m4a;")||h.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(h.canPlayType("audio/x-mp4;")||h.canPlayType("audio/mp4;")||h.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!h.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")});var j=new g(i),k=function(a){var d=this;d._autoplay=a.autoplay||!1,d._buffer=a.buffer||!1,d._duration=a.duration||0,d._format=a.format||null,d._loop=a.loop||!1,d._loaded=!1,d._sprite=a.sprite||{},d._src=a.src||"",d._pos3d=a.pos3d||[0,0,-.5],d._volume=void 0!==a.volume?a.volume:1,d._urls=a.urls||[],d._rate=a.rate||1,d._model=a.model||null,d._onload=[a.onload||function(){}],d._onloaderror=[a.onloaderror||function(){}],d._onend=[a.onend||function(){}],d._onpause=[a.onpause||function(){}],d._onplay=[a.onplay||function(){}],d._onendTimer=[],d._webAudio=c&&!d._buffer,d._audioNode=[],d._webAudio&&d._setupAudioNode(),"undefined"!=typeof b&&b&&j.iOSAutoEnable&&j._enableiOSAudio(),j._howls.push(d),d.load()};if(k.prototype={load:function(){var a=this,b=null;if(d)return void a.on("loaderror");for(var c=0;c<a._urls.length;c++){var e,f;if(a._format)e=a._format;else{if(f=a._urls[c],e=/^data:audio\/([^;,]+);/i.exec(f),e||(e=/\.([^.]+)$/.exec(f.split("?",1)[0])),!e)return void a.on("loaderror");e=e[1].toLowerCase()}if(i[e]){b=a._urls[c];break}}if(!b)return void a.on("loaderror");if(a._src=b,a._webAudio)l(a,b);else{var h=new Audio;h.addEventListener("error",function(){h.error&&4===h.error.code&&(g.noAudio=!0),a.on("loaderror",{type:h.error?h.error.code:0})},!1),a._audioNode.push(h),h.src=b,h._pos=0,h.preload="auto",h.volume=j._muted?0:a._volume*j.volume();var k=function(){a._duration=Math.ceil(10*h.duration)/10,0===Object.getOwnPropertyNames(a._sprite).length&&(a._sprite={_default:[0,1e3*a._duration]}),a._loaded||(a._loaded=!0,a.on("load")),a._autoplay&&a.play(),h.removeEventListener("canplaythrough",k,!1)};h.addEventListener("canplaythrough",k,!1),h.load()}return a},urls:function(a){var b=this;return a?(b.stop(),b._urls="string"==typeof a?[a]:a,b._loaded=!1,b.load(),b):b._urls},play:function(a,c){var d=this;return"function"==typeof a&&(c=a),a&&"function"!=typeof a||(a="_default"),d._loaded?d._sprite[a]?(d._inactiveNode(function(e){e._sprite=a;var f=e._pos>0?e._pos:d._sprite[a][0]/1e3,g=0;d._webAudio?(g=d._sprite[a][1]/1e3-e._pos,e._pos>0&&(f=d._sprite[a][0]/1e3+f)):g=d._sprite[a][1]/1e3-(f-d._sprite[a][0]/1e3);var h,i=!(!d._loop&&!d._sprite[a][2]),k="string"==typeof c?c:Math.round(Date.now()*Math.random())+"";if(function(){var b={id:k,sprite:a,loop:i};h=setTimeout(function(){!d._webAudio&&i&&d.stop(b.id).play(a,b.id),d._webAudio&&!i&&(d._nodeById(b.id).paused=!0,d._nodeById(b.id)._pos=0,d._clearEndTimer(b.id)),d._webAudio||i||d.stop(b.id),d.on("end",k)},1e3*g),d._onendTimer.push({timer:h,id:b.id})}(),d._webAudio){var l=d._sprite[a][0]/1e3,m=d._sprite[a][1]/1e3;e.id=k,e.paused=!1,o(d,[i,l,m],k),d._playStart=b.currentTime,e.gain.value=d._volume,"undefined"==typeof e.bufferSource.start?e.bufferSource.noteGrainOn(0,f,g):e.bufferSource.start(0,f,g)}else{if(4!==e.readyState&&(e.readyState||!navigator.isCocoonJS))return d._clearEndTimer(k),function(){var b=d,f=a,g=c,h=e,i=function(){b.play(f,g),h.removeEventListener("canplaythrough",i,!1)};h.addEventListener("canplaythrough",i,!1)}(),d;e.readyState=4,e.id=k,e.currentTime=f,e.muted=j._muted||e.muted,e.volume=d._volume*j.volume(),setTimeout(function(){e.play()},0)}return d.on("play"),"function"==typeof c&&c(k),d}),d):("function"==typeof c&&c(),d):(d.on("load",function(){d.play(a,c)}),d)},pause:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.pause(a)}),b;b._clearEndTimer(a);var c=a?b._nodeById(a):b._activeNode();if(c)if(c._pos=b.pos(null,a),b._webAudio){if(!c.bufferSource||c.paused)return b;c.paused=!0,"undefined"==typeof c.bufferSource.stop?c.bufferSource.noteOff(0):c.bufferSource.stop(0)}else c.pause();return b.on("pause"),b},stop:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.stop(a)}),b;b._clearEndTimer(a);var c=a?b._nodeById(a):b._activeNode();if(c)if(c._pos=0,b._webAudio){if(!c.bufferSource||c.paused)return b;c.paused=!0,"undefined"==typeof c.bufferSource.stop?c.bufferSource.noteOff(0):c.bufferSource.stop(0)}else isNaN(c.duration)||(c.pause(),c.currentTime=0);return b},mute:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.mute(a)}),b;var c=a?b._nodeById(a):b._activeNode();return c&&(b._webAudio?c.gain.value=0:c.muted=!0),b},unmute:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.unmute(a)}),b;var c=a?b._nodeById(a):b._activeNode();return c&&(b._webAudio?c.gain.value=b._volume:c.muted=!1),b},volume:function(a,b){var c=this;if(a=parseFloat(a),a>=0&&1>=a){if(c._volume=a,!c._loaded)return c.on("play",function(){c.volume(a,b)}),c;var d=b?c._nodeById(b):c._activeNode();return d&&(c._webAudio?d.gain.value=a:d.volume=a*j.volume()),c}return c._volume},loop:function(a){var b=this;return"boolean"==typeof a?(b._loop=a,b):b._loop},sprite:function(a){var b=this;return"object"==typeof a?(b._sprite=a,b):b._sprite},pos:function(a,c){var d=this;if(!d._loaded)return d.on("load",function(){d.pos(a)}),"number"==typeof a?d:d._pos||0;a=parseFloat(a);var e=c?d._nodeById(c):d._activeNode();if(e)return a>=0?(d.pause(c),e._pos=a,d.play(e._sprite,c),d):d._webAudio?e._pos+(b.currentTime-d._playStart):e.currentTime;if(a>=0)return d;for(var f=0;f<d._audioNode.length;f++)if(d._audioNode[f].paused&&4===d._audioNode[f].readyState)return d._webAudio?d._audioNode[f]._pos:d._audioNode[f].currentTime},pos3d:function(a,b,c,d){var e=this;if(b="undefined"!=typeof b&&b?b:0,c="undefined"!=typeof c&&c?c:-.5,!e._loaded)return e.on("play",function(){e.pos3d(a,b,c,d)}),e;if(!(a>=0||0>a))return e._pos3d;if(e._webAudio){var f=d?e._nodeById(d):e._activeNode();f&&(e._pos3d=[a,b,c],f.panner.setPosition(a,b,c),f.panner.panningModel=e._model||"HRTF")}return e},fade:function(a,b,c,d,e){var f=this,g=Math.abs(a-b),h=a>b?"down":"up",i=g/.01,j=c/i;if(!f._loaded)return f.on("load",function(){f.fade(a,b,c,d,e)}),f;f.volume(a,e);for(var k=1;i>=k;k++)!function(){var a=f._volume+("up"===h?.01:-.01)*k,c=Math.round(1e3*a)/1e3,g=b;setTimeout(function(){f.volume(c,e),c===g&&d&&d()},j*k)}()},fadeIn:function(a,b,c){return this.volume(0).play().fade(0,a,b,c)},fadeOut:function(a,b,c,d){var e=this;return e.fade(e._volume,a,b,function(){c&&c(),e.pause(d),e.on("end")},d)},_nodeById:function(a){for(var b=this,c=b._audioNode[0],d=0;d<b._audioNode.length;d++)if(b._audioNode[d].id===a){c=b._audioNode[d];break}return c},_activeNode:function(){for(var a=this,b=null,c=0;c<a._audioNode.length;c++)if(!a._audioNode[c].paused){b=a._audioNode[c];break}return a._drainPool(),b},_inactiveNode:function(a){for(var b=this,c=null,d=0;d<b._audioNode.length;d++)if(b._audioNode[d].paused&&4===b._audioNode[d].readyState){a(b._audioNode[d]),c=!0;break}if(b._drainPool(),!c){var e;if(b._webAudio)e=b._setupAudioNode(),a(e);else{b.load(),e=b._audioNode[b._audioNode.length-1];var f=navigator.isCocoonJS?"canplaythrough":"loadedmetadata",g=function(){e.removeEventListener(f,g,!1),a(e)};e.addEventListener(f,g,!1)}}},_drainPool:function(){var a,b=this,c=0;for(a=0;a<b._audioNode.length;a++)b._audioNode[a].paused&&c++;for(a=b._audioNode.length-1;a>=0&&!(5>=c);a--)b._audioNode[a].paused&&(b._webAudio&&b._audioNode[a].disconnect(0),c--,b._audioNode.splice(a,1))},_clearEndTimer:function(a){for(var b=this,c=0,d=0;d<b._onendTimer.length;d++)if(b._onendTimer[d].id===a){c=d;break}var e=b._onendTimer[c];e&&(clearTimeout(e.timer),b._onendTimer.splice(c,1))},_setupAudioNode:function(){var a=this,c=a._audioNode,d=a._audioNode.length;return c[d]="undefined"==typeof b.createGain?b.createGainNode():b.createGain(),c[d].gain.value=a._volume,c[d].paused=!0,c[d]._pos=0,c[d].readyState=4,c[d].connect(f),c[d].panner=b.createPanner(),c[d].panner.panningModel=a._model||"equalpower",c[d].panner.setPosition(a._pos3d[0],a._pos3d[1],a._pos3d[2]),c[d].panner.connect(c[d]),c[d]},on:function(a,b){var c=this,d=c["_on"+a];if("function"==typeof b)d.push(b);else for(var e=0;e<d.length;e++)b?d[e].call(c,b):d[e].call(c);return c},off:function(a,b){var c=this,d=c["_on"+a],e=b?b.toString():null;if(e){for(var f=0;f<d.length;f++)if(e===d[f].toString()){d.splice(f,1);break}}else c["_on"+a]=[];return c},unload:function(){for(var b=this,c=b._audioNode,d=0;d<b._audioNode.length;d++)c[d].paused||(b.stop(c[d].id),b.on("end",c[d].id)),b._webAudio?c[d].disconnect(0):c[d].src="";for(d=0;d<b._onendTimer.length;d++)clearTimeout(b._onendTimer[d].timer);var e=j._howls.indexOf(b);null!==e&&e>=0&&j._howls.splice(e,1),delete a[b._src],b=null}},c)var l=function(b,c){if(c in a)return b._duration=a[c].duration,void n(b);if(/^data:[^;]+;base64,/.test(c)){for(var d=atob(c.split(",")[1]),e=new Uint8Array(d.length),f=0;f<d.length;++f)e[f]=d.charCodeAt(f);m(e.buffer,b,c)}else{var g=new XMLHttpRequest;g.open("GET",c,!0),g.responseType="arraybuffer",g.onload=function(){m(g.response,b,c)},g.onerror=function(){b._webAudio&&(b._buffer=!0,b._webAudio=!1,b._audioNode=[],delete b._gainNode,delete a[c],b.load())};try{g.send()}catch(h){g.onerror()}}},m=function(c,d,e){b.decodeAudioData(c,function(b){b&&(a[e]=b,n(d,b))},function(){d.on("loaderror")})},n=function(a,b){a._duration=b?b.duration:a._duration,0===Object.getOwnPropertyNames(a._sprite).length&&(a._sprite={_default:[0,1e3*a._duration]}),a._loaded||(a._loaded=!0,a.on("load")),a._autoplay&&a.play()},o=function(c,d,e){var f=c._nodeById(e);f.bufferSource=b.createBufferSource(),f.bufferSource.buffer=a[c._src],f.bufferSource.connect(f.panner),f.bufferSource.loop=d[0],d[0]&&(f.bufferSource.loopStart=d[1],f.bufferSource.loopEnd=d[1]+d[2]),f.bufferSource.playbackRate.value=c._rate};"function"==typeof define&&define.amd&&define(function(){return{Howler:j,Howl:k}}),"undefined"!=typeof exports&&(exports.Howler=j,exports.Howl=k),"undefined"!=typeof window&&(window.Howler=j,window.Howl=k)}(),!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.stackgl=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a){if(!a)return h;for(var b=0;b<a.args.length;++b){var c=a.args[b];a.args[b]=0===b?{name:c,lvalue:!0,rvalue:!!a.rvalue,count:a.count||1}:{name:c,lvalue:!1,rvalue:!0,count:1}}return a.thisVars||(a.thisVars=[]),a.localVars||(a.localVars=[]),a}function e(a){return g({args:a.args,pre:d(a.pre),body:d(a.body),post:d(a.proc),funcName:a.funcName})}function f(a){for(var b=[],c=0;c<a.args.length;++c)b.push("a"+c);var d=new Function("P",["return function ",a.funcName,"_ndarrayops(",b.join(","),") {P(",b.join(","),");return a0}"].join(""));return d(e(a))}var g=a("cwise-compiler"),h={body:"",args:[],thisVars:[],localVars:[]},i={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var a in i){var b=i[a];c[a]=f({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+b+"c"},funcName:a}),c[a+"eq"]=f({args:["array","array"],body:{args:["a","b"],body:"a"+b+"=b"},rvalue:!0,funcName:a+"eq"}),c[a+"s"]=f({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+b+"s"},funcName:a+"s"}),c[a+"seq"]=f({args:["array","scalar"],body:{args:["a","s"],body:"a"+b+"=s"},rvalue:!0,funcName:a+"seq"})}}();var j={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var a in j){var b=j[a];c[a]=f({args:["array","array"],body:{args:["a","b"],body:"a="+b+"b"},funcName:a}),c[a+"eq"]=f({args:["array"],body:{args:["a"],body:"a="+b+"a"},rvalue:!0,count:2,funcName:a+"eq"})}}();var k={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var a in k){var b=k[a];c[a]=f({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+b+"c"},funcName:a}),c[a+"s"]=f({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+b+"s"},funcName:a+"s"}),c[a+"eq"]=f({args:["array","array"],body:{args:["a","b"],body:"a=a"+b+"b"},rvalue:!0,count:2,funcName:a+"eq"}),c[a+"seq"]=f({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+b+"s"},rvalue:!0,count:2,funcName:a+"seq"})}}();var l=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var a=0;a<l.length;++a){var b=l[a];c[b]=f({args:["array","array"],pre:{args:[],body:"this_f=Math."+b,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:b}),c[b+"eq"]=f({args:["array"],pre:{args:[],body:"this_f=Math."+b,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:b+"eq"})}}();var m=["max","min","atan2","pow"];!function(){for(var a=0;a<m.length;++a){var b=m[a];c[b]=f({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+b,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:b}),c[b+"s"]=f({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+b,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:b+"s"}),c[b+"eq"]=f({args:["array","array"],pre:{args:[],body:"this_f=Math."+b,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:b+"eq"}),c[b+"seq"]=f({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+b,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:b+"seq"})}}();var n=["atan2","pow"];!function(){for(var a=0;a<n.length;++a){var b=n[a];c[b+"op"]=f({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+b,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:b+"op"}),c[b+"ops"]=f({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+b,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:b+"ops"}),c[b+"opeq"]=f({args:["array","array"],pre:{args:[],body:"this_f=Math."+b,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:b+"opeq"}),c[b+"opseq"]=f({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+b,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:b+"opseq"})}}(),c.any=g({args:["array"],pre:h,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),c.all=g({args:["array"],pre:h,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),c.sum=g({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),c.prod=g({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),c.norm2squared=g({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),c.norm2=g({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),c.norminf=g({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),c.norm1=g({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),c.sup=g({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),c.inf=g({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),c.argmin=g({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),c.argmax=g({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),c.random=f({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),c.assign=f({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),c.assigns=f({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),c.equals=g({args:["array","array"],pre:h,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})},{"cwise-compiler":2}],2:[function(a,b){"use strict";function c(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function d(a){var b=new c;b.pre=a.pre,b.body=a.body,b.post=a.post;var d=a.args.slice(0);b.argTypes=d;for(var f=0;f<d.length;++f){var g=d[f];if("array"===g){if(b.arrayArgs.push(f),b.shimArgs.push("array"+f),f<b.pre.args.length&&b.pre.args[f].count>0)throw new Error("cwise: pre() block may not reference array args");if(f<b.post.args.length&&b.post.args[f].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===g)b.scalarArgs.push(f),b.shimArgs.push("scalar"+f);else if("index"===g){if(b.indexArgs.push(f),f<b.pre.args.length&&b.pre.args[f].count>0)throw new Error("cwise: pre() block may not reference array index");if(f<b.body.args.length&&b.body.args[f].lvalue)throw new Error("cwise: body() block may not write to array index");if(f<b.post.args.length&&b.post.args[f].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===g){if(b.shapeArgs.push(f),f<b.pre.args.length&&b.pre.args[f].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(f<b.body.args.length&&b.body.args[f].lvalue)throw new Error("cwise: body() block may not write to array shape");if(f<b.post.args.length&&b.post.args[f].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof g||!g.offset)throw new Error("cwise: Unknown argument type "+d[f]);b.argTypes[f]="offset",b.offsetArgs.push({array:g.array,offset:g.offset}),b.offsetArgIndex.push(f)}}if(b.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(b.pre.args.length>d.length)throw new Error("cwise: Too many arguments in pre() block");if(b.body.args.length>d.length)throw new Error("cwise: Too many arguments in body() block");if(b.post.args.length>d.length)throw new Error("cwise: Too many arguments in post() block");return b.debug=!!a.printCode||!!a.debug,b.funcName=a.funcName||"cwise",b.blockSize=a.blockSize||64,e(b)}var e=a("./lib/thunk.js");b.exports=d},{"./lib/thunk.js":4}],3:[function(a,b){"use strict";function c(a,b,c){var d,e,f=a.length,g=b.arrayArgs.length,h=b.indexArgs.length>0,i=[],j=[],k=0,l=0;for(d=0;f>d;++d)j.push(["i",d,"=0"].join(""));for(e=0;g>e;++e)for(d=0;f>d;++d)l=k,k=a[d],j.push(0===d?["d",e,"s",d,"=t",e,"p",k].join(""):["d",e,"s",d,"=(t",e,"p",k,"-s",l,"*t",e,"p",l,")"].join(""));for(i.push("var "+j.join(",")),d=f-1;d>=0;--d)k=a[d],i.push(["for(i",d,"=0;i",d,"<s",k,";++i",d,"){"].join(""));for(i.push(c),d=0;f>d;++d){for(l=k,k=a[d],e=0;g>e;++e)i.push(["p",e,"+=d",e,"s",d].join(""));h&&(d>0&&i.push(["index[",l,"]-=s",l].join("")),i.push(["++index[",k,"]"].join(""))),i.push("}")}return i.join("\n")}function d(a,b,d,e){for(var f=b.length,g=d.arrayArgs.length,h=d.blockSize,i=d.indexArgs.length>0,j=[],k=0;g>k;++k)j.push(["var offset",k,"=p",k].join(""));for(var k=a;f>k;++k)j.push(["for(var j"+k+"=SS[",b[k],"]|0;j",k,">0;){"].join("")),j.push(["if(j",k,"<",h,"){"].join("")),j.push(["s",b[k],"=j",k].join("")),j.push(["j",k,"=0"].join("")),j.push(["}else{s",b[k],"=",h].join("")),j.push(["j",k,"-=",h,"}"].join("")),i&&j.push(["index[",b[k],"]=j",k].join(""));for(var k=0;g>k;++k){for(var l=["offset"+k],m=a;f>m;++m)l.push(["j",m,"*t",k,"p",b[m]].join(""));j.push(["p",k,"=(",l.join("+"),")"].join(""))}j.push(c(b,d,e));for(var k=a;f>k;++k)j.push("}");return j.join("\n")}function e(a){for(var b=0,c=a[0].length;c>b;){for(var d=1;d<a.length;++d)if(a[d][b]!==a[0][b])return b;++b}return b}function f(a,b,c){for(var d=a.body,e=[],f=[],g=0;g<a.args.length;++g){var h=a.args[g];if(!(h.count<=0)){var i=new RegExp(h.name,"g"),j="",k=b.arrayArgs.indexOf(g);switch(b.argTypes[g]){case"offset":var l=b.offsetArgIndex.indexOf(g),m=b.offsetArgs[l];k=m.array,j="+q"+l;case"array":j="p"+k+j;var n="l"+g,o="a"+k;1===h.count?"generic"===c[k]?h.lvalue?(e.push(["var ",n,"=",o,".get(",j,")"].join("")),d=d.replace(i,n),f.push([o,".set(",j,",",n,")"].join(""))):d=d.replace(i,[o,".get(",j,")"].join("")):d=d.replace(i,[o,"[",j,"]"].join("")):"generic"===c[k]?(e.push(["var ",n,"=",o,".get(",j,")"].join("")),d=d.replace(i,n),h.lvalue&&f.push([o,".set(",j,",",n,")"].join(""))):(e.push(["var ",n,"=",o,"[",j,"]"].join("")),d=d.replace(i,n),h.lvalue&&f.push([o,"[",j,"]=",n].join("")));break;case"scalar":d=d.replace(i,"Y"+b.scalarArgs.indexOf(g));break;case"index":d=d.replace(i,"index");break;case"shape":d=d.replace(i,"shape")}}}return[e.join("\n"),d,f.join("\n")].join("\n").trim()}function g(a){for(var b=new Array(a.length),c=!0,d=0;d<a.length;++d){var e=a[d],f=e.match(/\d+/);f=f?f[0]:"",b[d]=0===e.charAt(0)?"u"+e.charAt(1)+f:e.charAt(0)+f,d>0&&(c=c&&b[d]===b[d-1])}return c?b[0]:b.join("")}function h(a,b){for(var h=0|b[1].length,j=new Array(a.arrayArgs.length),k=new Array(a.arrayArgs.length),l=["SS"],m=["'use strict'"],n=[],o=0;h>o;++o)n.push(["s",o,"=SS[",o,"]"].join(""));for(var p=0;p<a.arrayArgs.length;++p){l.push("a"+p),l.push("t"+p),l.push("p"+p),k[p]=b[2*p],j[p]=b[2*p+1];for(var o=0;h>o;++o)n.push(["t",p,"p",o,"=t",p,"[",o,"]"].join(""))}for(var p=0;p<a.scalarArgs.length;++p)l.push("Y"+p);if(a.shapeArgs.length>0&&n.push("shape=SS.slice(0)"),a.indexArgs.length>0){for(var q=new Array(h),p=0;h>p;++p)q[p]="0";n.push(["index=[",q.join(","),"]"].join(""))}for(var p=0;p<a.offsetArgs.length;++p){for(var r=a.offsetArgs[p],s=[],o=0;o<r.offset.length;++o)0!==r.offset[o]&&s.push(1===r.offset[o]?["t",r.array,"p",o].join(""):[r.offset[o],"*t",r.array,"p",o].join(""));n.push(0===s.length?"q"+p+"=0":["q",p,"=",s.join("+")].join(""))}var t=i([].concat(a.pre.thisVars).concat(a.body.thisVars).concat(a.post.thisVars));n=n.concat(t),m.push("var "+n.join(","));for(var p=0;p<a.arrayArgs.length;++p)m.push("p"+p+"|=0");a.pre.body.length>3&&m.push(f(a.pre,a,k));var u=f(a.body,a,k),v=e(j);m.push(h>v?d(v,j[0],a,u):c(j[0],a,u)),a.post.body.length>3&&m.push(f(a.post,a,k)),a.debug&&console.log("Generated cwise routine for ",b,":\n\n",m.join("\n"));var w=[a.funcName||"unnamed","_cwise_loop_",j[0].join("s"),"m",v,g(k)].join(""),x=new Function(["function ",w,"(",l.join(","),"){",m.join("\n"),"} return ",w].join(""));return x()}var i=a("uniq");b.exports=h},{uniq:5}],4:[function(a,b){"use strict";function c(a){var b=["'use strict'","var CACHED={}"],c=[],e=a.funcName+"_cwise_thunk";b.push(["return function ",e,"(",a.shimArgs.join(","),"){"].join(""));for(var f=[],g=[],h=[["array",a.arrayArgs[0],".shape"].join("")],i=0;i<a.arrayArgs.length;++i){var j=a.arrayArgs[i];c.push(["t",j,"=array",j,".dtype,","r",j,"=array",j,".order"].join("")),f.push("t"+j),f.push("r"+j),g.push("t"+j),g.push("r"+j+".join()"),h.push("array"+j+".data"),h.push("array"+j+".stride"),h.push("array"+j+".offset|0")}for(var i=0;i<a.scalarArgs.length;++i)h.push("scalar"+a.scalarArgs[i]);c.push(["type=[",g.join(","),"].join()"].join("")),c.push("proc=CACHED[type]"),b.push("var "+c.join(",")),b.push(["if(!proc){","CACHED[type]=proc=compile([",f.join(","),"])}","return proc(",h.join(","),")}"].join("")),a.debug&&console.log("Generated thunk:",b.join("\n"));var k=new Function("compile",b.join("\n"));return k(d.bind(void 0,a))}var d=a("./compile.js");b.exports=c},{"./compile.js":3}],5:[function(a,b){"use strict";function c(a,b){for(var c=1,d=a.length,e=a[0],f=a[0],g=1;d>g;++g)if(f=e,e=a[g],b(e,f)){if(g===c){c++;continue}a[c++]=e}return a.length=c,a}function d(a){for(var b=1,c=a.length,d=a[0],e=a[0],f=1;c>f;++f,e=d)if(e=d,d=a[f],d!==e){if(f===b){b++;continue}a[b++]=d}return a.length=b,a}function e(a,b,e){return 0===a.length?a:b?(e||a.sort(b),c(a,b)):(e||a.sort(),d(a))}b.exports=e},{}],6:[function(a,b){(function(c){function d(a,b){return a[0]-b[0]}function e(){var a,b=this.stride,c=new Array(b.length);for(a=0;a<c.length;++a)c[a]=[Math.abs(b[a]),a];c.sort(d);var e=new Array(c.length);for(a=0;a<e.length;++a)e[a]=c[a][1];return e}function f(a,b){var c=["View",b,"d",a].join("");0>b&&(c="View_Nil"+a);var d="generic"===a;if(-1===b){var f="function "+c+"(a){this.data=a;};var proto="+c+".prototype;proto.dtype='"+a+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+c+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+c+"(a){return new "+c+"(a);}",g=new Function(f);return g()}if(0===b){var f="function "+c+"(a,d) {this.data = a;this.offset = d};var proto="+c+".prototype;proto.dtype='"+a+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+c+"_copy() {return new "+c+"(this.data,this.offset)};proto.pick=function "+c+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+c+"_get(){return "+(d?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+c+"_set(v){return "+(d?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+c+"(a,b,c,d){return new "+c+"(a,d)}",g=new Function("TrivialArray",f);return g(m[a][0])}var f=["'use strict'"],h=i(b),k=h.map(function(a){return"i"+a}),l="this.offset+"+h.map(function(a){return"this._stride"+a+"*i"+a}).join("+");f.push("function "+c+"(a,"+h.map(function(a){return"b"+a}).join(",")+","+h.map(function(a){return"c"+a}).join(",")+",d){this.data=a");for(var n=0;b>n;++n)f.push("this._shape"+n+"=b"+n+"|0");for(var n=0;b>n;++n)f.push("this._stride"+n+"=c"+n+"|0");f.push("this.offset=d|0}","var proto="+c+".prototype","proto.dtype='"+a+"'","proto.dimension="+b);var o="VStride"+b+"d"+a,p="VShape"+b+"d"+a,q={stride:o,shape:p};for(var r in q){var s=q[r];f.push("function "+s+"(v) {this._v=v} var aproto="+s+".prototype","aproto.length="+b);for(var t=[],n=0;b>n;++n)t.push(["this._v._",r,n].join(""));f.push("aproto.toJSON=function "+s+"_toJSON(){return ["+t.join(",")+"]}","aproto.valueOf=aproto.toString=function "+s+"_toString(){return ["+t.join(",")+"].join()}");
for(var n=0;b>n;++n)f.push("Object.defineProperty(aproto,"+n+",{get:function(){return this._v._"+r+n+"},set:function(v){return this._v._"+r+n+"=v|0},enumerable:true})");for(var n=0;n<j.length;++n)j[n]in Array.prototype&&f.push("aproto."+j[n]+"=Array.prototype."+j[n]);f.push(["Object.defineProperty(proto,'",r,"',{get:function ",s,"_get(){return new ",s,"(this)},set: function ",s,"_set(v){"].join(""));for(var n=0;b>n;++n)f.push("this._"+r+n+"=v["+n+"]|0");f.push("return v}})")}f.push("Object.defineProperty(proto,'size',{get:function "+c+"_size(){return "+h.map(function(a){return"this._shape"+a}).join("*"),"}})"),1===b?f.push("proto.order=[0]"):(f.push("Object.defineProperty(proto,'order',{get:"),4>b?(f.push("function "+c+"_order(){"),2===b?f.push("return (Math.abs(this._stride0)>Math.abs(this._stride1))?[1,0]:[0,1]}})"):3===b&&f.push("var s0=Math.abs(this._stride0),s1=Math.abs(this._stride1),s2=Math.abs(this._stride2);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):f.push("ORDER})")),f.push("proto.set=function "+c+"_set("+k.join(",")+",v){"),f.push(d?"return this.data.set("+l+",v)}":"return this.data["+l+"]=v}"),f.push("proto.get=function "+c+"_get("+k.join(",")+"){"),f.push(d?"return this.data.get("+l+")}":"return this.data["+l+"]}"),f.push("proto.index=function "+c+"_index(",k.join(),"){return "+l+"}"),f.push("proto.hi=function "+c+"_hi("+k.join(",")+"){return new "+c+"(this.data,"+h.map(function(a){return["(typeof i",a,"!=='number'||i",a,"<0)?this._shape",a,":i",a,"|0"].join("")}).join(",")+","+h.map(function(a){return"this._stride"+a}).join(",")+",this.offset)}");var u=h.map(function(a){return"a"+a+"=this._shape"+a}),v=h.map(function(a){return"c"+a+"=this._stride"+a});f.push("proto.lo=function "+c+"_lo("+k.join(",")+"){var b=this.offset,d=0,"+u.join(",")+","+v.join(","));for(var n=0;b>n;++n)f.push("if(typeof i"+n+"==='number'&&i"+n+">=0){d=i"+n+"|0;b+=c"+n+"*d;a"+n+"-=d}");f.push("return new "+c+"(this.data,"+h.map(function(a){return"a"+a}).join(",")+","+h.map(function(a){return"c"+a}).join(",")+",b)}"),f.push("proto.step=function "+c+"_step("+k.join(",")+"){var "+h.map(function(a){return"a"+a+"=this._shape"+a}).join(",")+","+h.map(function(a){return"b"+a+"=this._stride"+a}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var n=0;b>n;++n)f.push("if(typeof i"+n+"==='number'){d=i"+n+"|0;if(d<0){c+=b"+n+"*(a"+n+"-1);a"+n+"=ceil(-a"+n+"/d)}else{a"+n+"=ceil(a"+n+"/d)}b"+n+"*=d}");f.push("return new "+c+"(this.data,"+h.map(function(a){return"a"+a}).join(",")+","+h.map(function(a){return"b"+a}).join(",")+",c)}");for(var w=new Array(b),x=new Array(b),n=0;b>n;++n)w[n]="a[i"+n+"]",x[n]="b[i"+n+"]";f.push("proto.transpose=function "+c+"_transpose("+k+"){"+k.map(function(a,b){return a+"=("+a+"===undefined?"+b+":"+a+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+c+"(this.data,"+w.join(",")+","+x.join(",")+",this.offset)}"),f.push("proto.pick=function "+c+"_pick("+k+"){var a=[],b=[],c=this.offset");for(var n=0;b>n;++n)f.push("if(typeof i"+n+"==='number'&&i"+n+">=0){c=(c+this._stride"+n+"*i"+n+")|0}else{a.push(this._shape"+n+");b.push(this._stride"+n+")}");f.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),f.push("return function construct_"+c+"(data,shape,stride,offset){return new "+c+"(data,"+h.map(function(a){return"shape["+a+"]"}).join(",")+","+h.map(function(a){return"stride["+a+"]"}).join(",")+",offset)}");var g=new Function("CTOR_LIST","ORDER",f.join("\n"));return g(m[a],e)}function g(a){if(l&&c.isBuffer(a))return"buffer";if(k)switch(Object.prototype.toString.call(a)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(a)?"array":"generic"}function h(a,b,c,d){if(void 0===a){var e=m.array[0];return e([])}"number"==typeof a&&(a=[a]),void 0===b&&(b=[a.length]);var h=b.length;if(void 0===c){c=new Array(h);for(var i=h-1,j=1;i>=0;--i)c[i]=j,j*=b[i]}if(void 0===d){d=0;for(var i=0;h>i;++i)c[i]<0&&(d-=(b[i]-1)*c[i])}for(var k=g(a),l=m[k];l.length<=h+1;)l.push(f(k,l.length-1));var e=l[h+1];return e(a,b,c,d)}var i=a("iota-array"),j=["concat","join","slice","toString","indexOf","lastIndexOf","forEach","every","some","filter","map","reduce","reduceRight"],k="undefined"!=typeof Float64Array,l="undefined"!=typeof c,m={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};b.exports=h}).call(this,a("buffer").Buffer)},{buffer:21,"iota-array":7}],7:[function(a,b){"use strict";function c(a){for(var b=new Array(a),c=0;a>c;++c)b[c]=c;return b}b.exports=c},{}],8:[function(a,b,c){"use strict";"use restrict";function d(a){var b=32;return a&=-a,a&&b--,65535&a&&(b-=16),16711935&a&&(b-=8),252645135&a&&(b-=4),858993459&a&&(b-=2),1431655765&a&&(b-=1),b}var e=32;c.INT_BITS=e,c.INT_MAX=2147483647,c.INT_MIN=-1<<e-1,c.sign=function(a){return(a>0)-(0>a)},c.abs=function(a){var b=a>>e-1;return(a^b)-b},c.min=function(a,b){return b^(a^b)&-(b>a)},c.max=function(a,b){return a^(a^b)&-(b>a)},c.isPow2=function(a){return!(a&a-1||!a)},c.log2=function(a){var b,c;return b=(a>65535)<<4,a>>>=b,c=(a>255)<<3,a>>>=c,b|=c,c=(a>15)<<2,a>>>=c,b|=c,c=(a>3)<<1,a>>>=c,b|=c,b|a>>1},c.log10=function(a){return a>=1e9?9:a>=1e8?8:a>=1e7?7:a>=1e6?6:a>=1e5?5:a>=1e4?4:a>=1e3?3:a>=100?2:a>=10?1:0},c.popCount=function(a){return a-=a>>>1&1431655765,a=(858993459&a)+(a>>>2&858993459),16843009*(a+(a>>>4)&252645135)>>>24},c.countTrailingZeros=d,c.nextPow2=function(a){return a+=0===a,--a,a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,a|=a>>>16,a+1},c.prevPow2=function(a){return a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,a|=a>>>16,a-(a>>>1)},c.parity=function(a){return a^=a>>>16,a^=a>>>8,a^=a>>>4,a&=15,27030>>>a&1};var f=new Array(256);!function(a){for(var b=0;256>b;++b){var c=b,d=b,e=7;for(c>>>=1;c;c>>>=1)d<<=1,d|=1&c,--e;a[b]=d<<e&255}}(f),c.reverse=function(a){return f[255&a]<<24|f[a>>>8&255]<<16|f[a>>>16&255]<<8|f[a>>>24&255]},c.interleave2=function(a,b){return a&=65535,a=16711935&(a|a<<8),a=252645135&(a|a<<4),a=858993459&(a|a<<2),a=1431655765&(a|a<<1),b&=65535,b=16711935&(b|b<<8),b=252645135&(b|b<<4),b=858993459&(b|b<<2),b=1431655765&(b|b<<1),a|b<<1},c.deinterleave2=function(a,b){return a=a>>>b&1431655765,a=858993459&(a|a>>>1),a=252645135&(a|a>>>2),a=16711935&(a|a>>>4),a=65535&(a|a>>>16),a<<16>>16},c.interleave3=function(a,b,c){return a&=1023,a=4278190335&(a|a<<16),a=251719695&(a|a<<8),a=3272356035&(a|a<<4),a=1227133513&(a|a<<2),b&=1023,b=4278190335&(b|b<<16),b=251719695&(b|b<<8),b=3272356035&(b|b<<4),b=1227133513&(b|b<<2),a|=b<<1,c&=1023,c=4278190335&(c|c<<16),c=251719695&(c|c<<8),c=3272356035&(c|c<<4),c=1227133513&(c|c<<2),a|c<<2},c.deinterleave3=function(a,b){return a=a>>>b&1227133513,a=3272356035&(a|a>>>2),a=251719695&(a|a>>>4),a=4278190335&(a|a>>>8),a=1023&(a|a>>>16),a<<22>>22},c.nextCombination=function(a){var b=a|a-1;return b+1|(~b&-~b)-1>>>d(a)+1}},{}],9:[function(a,b){"use strict";function c(a,b,d){var e=0|a[d];if(0>=e)return[];var f,g=new Array(e);if(d===a.length-1)for(f=0;e>f;++f)g[f]=b;else for(f=0;e>f;++f)g[f]=c(a,b,d+1);return g}function d(a,b){var c,d;for(c=new Array(a),d=0;a>d;++d)c[d]=b;return c}function e(a,b){switch("undefined"==typeof b&&(b=0),typeof a){case"number":if(a>0)return d(0|a,b);break;case"object":if("number"==typeof a.length)return c(a,b,0)}return[]}b.exports=e},{}],10:[function(a,b,c){(function(b,d){"use strict";function e(a){if(a){var b=a.length||a.byteLength,c=s.log2(b);w[c].push(a)}}function f(a){e(a.buffer)}function g(a){var a=s.nextPow2(a),b=s.log2(a),c=w[b];return c.length>0?c.pop():new ArrayBuffer(a)}function h(a){return new Uint8Array(g(a),0,a)}function i(a){return new Uint16Array(g(2*a),0,a)}function j(a){return new Uint32Array(g(4*a),0,a)}function k(a){return new Int8Array(g(a),0,a)}function l(a){return new Int16Array(g(2*a),0,a)}function m(a){return new Int32Array(g(4*a),0,a)}function n(a){return new Float32Array(g(4*a),0,a)}function o(a){return new Float64Array(g(8*a),0,a)}function p(a){return u?new Uint8ClampedArray(g(a),0,a):h(a)}function q(a){return new DataView(g(a),0,a)}function r(a){a=s.nextPow2(a);var b=s.log2(a),c=x[b];return c.length>0?c.pop():new d(a)}var s=a("bit-twiddle"),t=a("dup");b.__TYPEDARRAY_POOL||(b.__TYPEDARRAY_POOL={UINT8:t([32,0]),UINT16:t([32,0]),UINT32:t([32,0]),INT8:t([32,0]),INT16:t([32,0]),INT32:t([32,0]),FLOAT:t([32,0]),DOUBLE:t([32,0]),DATA:t([32,0]),UINT8C:t([32,0]),BUFFER:t([32,0])});var u="undefined"!=typeof Uint8ClampedArray,v=b.__TYPEDARRAY_POOL;v.UINT8C||(v.UINT8C=t([32,0])),v.BUFFER||(v.BUFFER=t([32,0]));var w=v.DATA,x=v.BUFFER;c.free=function(a){if(d.isBuffer(a))x[s.log2(a.length)].push(a);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(a)&&(a=a.buffer),!a)return;var b=a.length||a.byteLength,c=0|s.log2(b);w[c].push(a)}},c.freeUint8=c.freeUint16=c.freeUint32=c.freeInt8=c.freeInt16=c.freeInt32=c.freeFloat32=c.freeFloat=c.freeFloat64=c.freeDouble=c.freeUint8Clamped=c.freeDataView=f,c.freeArrayBuffer=e,c.freeBuffer=function(a){x[s.log2(a.length)].push(a)},c.malloc=function(a,b){if(void 0===b||"arraybuffer"===b)return g(a);switch(b){case"uint8":return h(a);case"uint16":return i(a);case"uint32":return j(a);case"int8":return k(a);case"int16":return l(a);case"int32":return m(a);case"float":case"float32":return n(a);case"double":case"float64":return o(a);case"uint8_clamped":return p(a);case"buffer":return r(a);case"data":case"dataview":return q(a);default:return null}return null},c.mallocArrayBuffer=g,c.mallocUint8=h,c.mallocUint16=i,c.mallocUint32=j,c.mallocInt8=k,c.mallocInt16=l,c.mallocInt32=m,c.mallocFloat32=c.mallocFloat=n,c.mallocFloat64=c.mallocDouble=o,c.mallocUint8Clamped=p,c.mallocDataView=q,c.mallocBuffer=r,c.clearCache=function(){for(var a=0;32>a;++a)v.UINT8[a].length=0,v.UINT16[a].length=0,v.UINT32[a].length=0,v.INT8[a].length=0,v.INT16[a].length=0,v.INT32[a].length=0,v.FLOAT[a].length=0,v.DOUBLE[a].length=0,v.UINT8C[a].length=0,w[a].length=0,x[a].length=0}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},a("buffer").Buffer)},{"bit-twiddle":8,buffer:21,dup:9}],11:[function(a,b,c){void function(a,d,e){function f(a,b,c){return"function"==typeof b&&(c=b,b=g(c).replace(/_$/,"")),j(a,b,{configurable:!0,writable:!0,value:c})}function g(a){return"function"!=typeof a?"":"name"in a?a.name:k.call(a).match(n)[1]}function h(a){function b(b,d){return d||2===arguments.length?c.set(b,d):(d=c.get(b),d===e&&(d=a(b),c.set(b,d))),d}var c=new p;return a||(a=q),b}var i=Object.getOwnPropertyNames,j=Object.defineProperty,k=Function.prototype.toString,l=Object.create,m=Object.prototype.hasOwnProperty,n=/^\n?function\s?(\w*)?_?\(/,o=function(){function a(){var a=g(),d={};this.unlock=function(e){var f=k(e);if(m.call(f,a))return f[a](d);var g=l(null,b);return j(f,a,{value:new Function("s","l",c)(d,g)}),g}}var b={value:{writable:!0,value:e}},c="return function(k){if(k===s)return l}",d=l(null),g=function(){var a=Math.random().toString(36).slice(2);return a in d?g():d[a]=a},h=g(),k=function(a){if(m.call(a,h))return a[h];if(!Object.isExtensible(a))throw new TypeError("Object must be extensible");var b=l(null);return j(a,h,{value:b}),b};return f(Object,function(a){var b=i(a);return m.call(a,h)&&b.splice(b.indexOf(h),1),b}),f(a.prototype,function(a){return this.unlock(a).value}),f(a.prototype,function(a,b){this.unlock(a).value=b}),a}(),p=function(b){function c(b){return this===a||null==this||this===c.prototype?new c(b):(n(this,new o),void q(this,b))}function h(a){m(a);var b=p(this).get(a);return b===d?e:b}function i(a,b){m(a),p(this).set(a,b===e?d:b)}function j(a){return m(a),p(this).get(a)!==e}function k(a){m(a);var b=p(this),c=b.get(a)!==e;return b.set(a,e),c}function l(){return p(this),"[object WeakMap]"}var m=function(a){if(null==a||"object"!=typeof a&&"function"!=typeof a)throw new TypeError("Invalid WeakMap key")},n=function(a,c){var d=b.unlock(a);if(d.value)throw new TypeError("Object is already a WeakMap");d.value=c},p=function(a){var c=b.unlock(a).value;if(!c)throw new TypeError("WeakMap is not generic");return c},q=function(a,b){null!==b&&"object"==typeof b&&"function"==typeof b.forEach&&b.forEach(function(c,d){c instanceof Array&&2===c.length&&i.call(a,b[d][0],b[d][1])})};try{var r=("return "+k).replace("e_","\\u0065"),s=new Function("unwrap","validate",r)(p,m)}catch(t){var s=k}var r=(""+Object).split("Object"),u=function(){return r[0]+g(this)+r[1]};f(u,u);var v={__proto__:[]}instanceof Array?function(a){a.__proto__=u}:function(a){f(a,u)};return v(c),[l,h,i,j,s].forEach(function(a){f(c.prototype,a),v(a)}),c}(new o),q=Object.create?function(){return Object.create(null)}:function(){return{}};"undefined"!=typeof b?b.exports=p:"undefined"!=typeof c?c.WeakMap=p:"WeakMap"in a||(a.WeakMap=p),p.createStorage=h,a.WeakMap&&(a.WeakMap.createStorage=h)}((0,eval)("this"))},{}],12:[function(a,b){"use strict";function c(a){return a.replace(/^[A-Z]+_/,"")}function d(a){var b=f.get(a);if(b)return b;for(var d={},e=a.getSupportedExtensions(),g=0;g<e.length;++g){var h=e[g];if(0!==h.indexOf("MOZ_")){var i=a.getExtension(e[g]);if(i)for(;;){d[h]=i;var j=c(h);if(j===h)break;h=j}}}return f.set(a,d),d}var e="undefined"==typeof WeakMap?a("weakmap"):WeakMap,f=new e;b.exports=d},{weakmap:11}],13:[function(a,b){"use strict";function c(a){q=[a.LINEAR,a.NEAREST_MIPMAP_LINEAR,a.LINEAR_MIPMAP_NEAREST,a.LINEAR_MIPMAP_NEAREST],r=[a.NEAREST,a.LINEAR,a.NEAREST_MIPMAP_NEAREST,a.NEAREST_MIPMAP_LINEAR,a.LINEAR_MIPMAP_NEAREST,a.LINEAR_MIPMAP_LINEAR],s=[a.REPEAT,a.CLAMP_TO_EDGE,a.MIRRORED_REPEAT]}function d(a,b,c){var d=a.gl,e=d.getParameter(d.MAX_TEXTURE_SIZE);if(0>b||b>e||0>c||c>e)throw new Error("gl-texture2d: Invalid texture size");return a._shape=[b,c],a.bind(),d.texImage2D(d.TEXTURE_2D,0,a.format,b,c,0,a.format,a.type,null),a._mipLevels=[0],a}function e(a,b,c,d,e,f){this.gl=a,this.handle=b,this.format=e,this.type=f,this._shape=[c,d],this._mipLevels=[0],this._magFilter=a.NEAREST,this._minFilter=a.NEAREST,this._wrapS=a.CLAMP_TO_EDGE,this._wrapT=a.CLAMP_TO_EDGE,this._anisoSamples=1;var g=this,h=[this._wrapS,this._wrapT];Object.defineProperties(h,[{get:function(){return g._wrapS},set:function(a){return g.wrapS=a}},{get:function(){return g._wrapT},set:function(a){return g.wrapT=a}}]),this._wrapVector=h;var i=[this._shape[0],this._shape[1]];Object.defineProperties(i,[{get:function(){return g._shape[0]},set:function(a){return g.width=a}},{get:function(){return g._shape[1]},set:function(a){return g.height=a}}]),this._shapeVector=i}function f(a,b){return 3===a.length?1===b[2]&&b[1]===a[0]*a[2]&&b[0]===a[2]:1===b[0]&&b[1]===a[0]}function g(a,b,c,d,e,g,h,i){var j=i.dtype,k=i.shape.slice();if(k.length<2||k.length>3)throw new Error("gl-texture2d: Invalid ndarray, must be 2d or 3d");var l=0,p=0,q=f(k,i.stride.slice());"float32"===j?l=a.FLOAT:"float64"===j?(l=a.FLOAT,q=!1,j="float32"):"uint8"===j?l=a.UNSIGNED_BYTE:(l=a.UNSIGNED_BYTE,q=!1,j="uint8");var r=1;if(2===k.length)p=a.LUMINANCE,k=[k[0],k[1],1],i=m(i.data,k,[i.stride[0],i.stride[1],1],i.offset);else{if(3!==k.length)throw new Error("gl-texture2d: Invalid shape for texture");if(1===k[2])p=a.ALPHA;else if(2===k[2])p=a.LUMINANCE_ALPHA;else if(3===k[2])p=a.RGB;else{if(4!==k[2])throw new Error("gl-texture2d: Invalid shape for pixel coords");p=a.RGBA}r=k[2]}if(p!==a.LUMINANCE&&p!==a.ALPHA||e!==a.LUMINANCE&&e!==a.ALPHA||(p=e),p!==e)throw new Error("gl-texture2d: Incompatible texture format for setPixels");var s=i.size,u=h.indexOf(d)<0;if(u&&h.push(d),l===g&&q)0===i.offset&&i.data.length===s?u?a.texImage2D(a.TEXTURE_2D,d,e,k[0],k[1],0,e,g,i.data):a.texSubImage2D(a.TEXTURE_2D,d,b,c,k[0],k[1],e,g,i.data):u?a.texImage2D(a.TEXTURE_2D,d,e,k[0],k[1],0,e,g,i.data.subarray(i.offset,i.offset+s)):a.texSubImage2D(a.TEXTURE_2D,d,b,c,k[0],k[1],e,g,i.data.subarray(i.offset,i.offset+s));else{var v;v=g===a.FLOAT?o.mallocFloat32(s):o.mallocUint8(s);var w=m(v,k,[k[2],k[2]*k[0],1]);l===a.FLOAT&&g===a.UNSIGNED_BYTE?t(w,i):n.assign(w,i),u?a.texImage2D(a.TEXTURE_2D,d,e,k[0],k[1],0,e,g,v.subarray(0,s)):a.texSubImage2D(a.TEXTURE_2D,d,b,c,k[0],k[1],e,g,v.subarray(0,s)),g===a.FLOAT?o.freeFloat32(v):o.freeUint8(v)}}function h(a){var b=a.createTexture();return a.bindTexture(a.TEXTURE_2D,b),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),b}function i(a,b,c,d,f){var g=a.getParameter(a.MAX_TEXTURE_SIZE);if(0>b||b>g||0>c||c>g)throw new Error("gl-texture2d: Invalid texture shape");if(f===a.FLOAT&&!p(a).texture_float)throw new Error("gl-texture2d: Floating point textures not supported on this platform");var i=h(a);return a.texImage2D(a.TEXTURE_2D,0,d,b,c,0,d,f,null),new e(a,i,b,c,d,f)}function j(a,b,c,d){var f=h(a);return a.texImage2D(a.TEXTURE_2D,0,c,c,d,b),new e(a,f,0|b.width,0|b.height,c,d)}function k(a,b){var c=b.dtype,d=b.shape.slice(),g=a.getParameter(a.MAX_TEXTURE_SIZE);if(d[0]<0||d[0]>g||d[1]<0||d[1]>g)throw new Error("gl-texture2d: Invalid texture size");var i=f(d,b.stride.slice()),j=0;"float32"===c?j=a.FLOAT:"float64"===c?(j=a.FLOAT,i=!1,c="float32"):"uint8"===c?j=a.UNSIGNED_BYTE:(j=a.UNSIGNED_BYTE,i=!1,c="uint8");var k=0;if(2===d.length)k=a.LUMINANCE,d=[d[0],d[1],1],b=m(b.data,d,[b.stride[0],b.stride[1],1],b.offset);else{if(3!==d.length)throw new Error("gl-texture2d: Invalid shape for texture");if(1===d[2])k=a.ALPHA;else if(2===d[2])k=a.LUMINANCE_ALPHA;else if(3===d[2])k=a.RGB;else{if(4!==d[2])throw new Error("gl-texture2d: Invalid shape for pixel coords");k=a.RGBA}}j!==a.FLOAT||p(a).texture_float||(j=a.UNSIGNED_BYTE,i=!1);var l,q,r=b.size;if(i)l=0===b.offset&&b.data.length===r?b.data:b.data.subarray(b.offset,b.offset+r);else{var s=[d[2],d[2]*d[0],1];q=o.malloc(r,c);var u=m(q,d,s,0);"float32"!==c&&"float64"!==c||j!==a.UNSIGNED_BYTE?n.assign(u,b):t(u,b),l=q.subarray(0,r)}var v=h(a);return a.texImage2D(a.TEXTURE_2D,0,k,d[0],d[1],0,k,j,l),i||o.free(q),new e(a,v,d[1],d[0],k,j)}function l(a){if(arguments.length<=1)throw new Error("gl-texture2d: Missing arguments for texture2d constructor");if(q||c(a),"number"==typeof arguments[1])return i(a,arguments[1],arguments[2],arguments[3]||a.RGBA,arguments[4]||a.UNSIGNED_BYTE);if(Array.isArray(arguments[1]))return i(a,0|arguments[1][0],0|arguments[1][1],arguments[2]||a.RGBA,arguments[3]||a.UNSIGNED_BYTE);if("object"==typeof arguments[1]){var b=arguments[1];if(b instanceof HTMLCanvasElement||b instanceof HTMLImageElement||b instanceof HTMLVideoElement||b instanceof ImageData)return j(a,b,arguments[2]||a.RGBA,arguments[3]||a.UNSIGNED_BYTE);if(b.shape&&b.data&&b.stride)return k(a,b)}throw new Error("gl-texture2d: Invalid arguments for texture2d constructor")}var m=a("ndarray"),n=a("ndarray-ops"),o=a("typedarray-pool"),p=a("webglew");b.exports=l;var q=null,r=null,s=null,t=function(a,b){n.muls(a,b,255)},u=e.prototype;Object.defineProperties(u,{minFilter:{get:function(){return this._minFilter},set:function(a){this.bind();var b=this.gl;if(this.type===b.FLOAT&&q.indexOf(a)>=0&&(p(b).texture_float_linear||(a=b.NEAREST)),r.indexOf(a)<0)throw new Error("gl-texture2d: Unknown filter mode "+a);return b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,a),this._minFilter=a}},magFilter:{get:function(){return this._magFilter},set:function(a){this.bind();var b=this.gl;if(this.type===b.FLOAT&&q.indexOf(a)>=0&&(p(b).texture_float_linear||(a=b.NEAREST)),r.indexOf(a)<0)throw new Error("gl-texture2d: Unknown filter mode "+a);return b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,a),this._magFilter=a}},mipSamples:{get:function(){return this._anisoSamples},set:function(a){var b=this._anisoSamples;if(this._anisoSamples=0|Math.max(a,1),b!==this._anisoSamples){var c=p(this.gl).EXT_texture_filter_anisotropic;c&&this.gl.texParameterf(this.gl.TEXTURE_2D,c.TEXTURE_MAX_ANISOTROPY_EXT,this._anisoSamples)}return this._anisoSamples}},wrapS:{get:function(){return this._wrapS},set:function(a){if(this.bind(),s.indexOf(a)<0)throw new Error("gl-texture2d: Unknown wrap mode "+a);return this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,a),this._wrapS=a}},wrapT:{get:function(){return this._wrapT},set:function(a){if(this.bind(),s.indexOf(a)<0)throw new Error("gl-texture2d: Unknown wrap mode "+a);return this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,a),this._wrapT=a}},wrap:{get:function(){return this._wrapVector},set:function(a){if(Array.isArray(a)||(a=[a,a]),2!==a.length)throw new Error("gl-texture2d: Must specify wrap mode for rows and columns");for(var b=0;2>b;++b)if(s.indexOf(a[b])<0)throw new Error("gl-texture2d: Unknown wrap mode "+a);this._wrapS=a[0],this._wrapT=a[1];var c=this.gl;return this.bind(),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,this._wrapS),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,this._wrapT),a}},shape:{get:function(){return this._shapeVector},set:function(a){if(Array.isArray(a)){if(2!==a.length)throw new Error("gl-texture2d: Invalid texture shape")}else a=[0|a,0|a];return d(this,0|a[0],0|a[1]),[0|a[0],0|a[1]]}},width:{get:function(){return this._shape[0]},set:function(a){return a=0|a,d(this,a,this._shape[1]),a}},height:{get:function(){return this._shape[1]},set:function(a){return a=0|a,d(this,this._shape[0],a),a}}}),u.bind=function(a){var b=this.gl;return void 0!==a&&b.activeTexture(b.TEXTURE0+(0|a)),b.bindTexture(b.TEXTURE_2D,this.handle),void 0!==a?0|a:b.getParameter(b.ACTIVE_TEXTURE)-b.TEXTURE0},u.dispose=function(){this.gl.deleteTexture(this.handle)},u.generateMipmap=function(){this.bind(),this.gl.generateMipmap(this.gl.TEXTURE_2D);for(var a=Math.min(this._shape[0],this._shape[1]),b=0;a>0;++b,a>>>=1)this._mipLevels.indexOf(b)<0&&this._mipLevels.push(b)},u.setPixels=function(a,b,c,d){var e=this.gl;if(this.bind(),Array.isArray(b)?(d=c,c=0|b[1],b=0|b[0]):(b=b||0,c=c||0),d=d||0,a instanceof HTMLCanvasElement||a instanceof ImageData||a instanceof HTMLImageElement||a instanceof HTMLVideoElement){var f=this._mipLevels.indexOf(d)<0;f?(e.texImage2D(e.TEXTURE_2D,0,this.format,this.format,this.type,a),this._mipLevels.push(d)):e.texSubImage2D(e.TEXTURE_2D,d,b,c,this.format,this.type,a)}else{if(!(a.shape&&a.stride&&a.data))throw new Error("gl-texture2d: Unsupported data type");if(a.shape.length<2||b+a.shape[1]>this._shape[1]>>>d||c+a.shape[0]>this._shape[0]>>>d||0>b||0>c)throw new Error("gl-texture2d: Texture dimensions are out of bounds");g(e,b,c,d,this.format,this.type,this._mipLevels,a)}}},{ndarray:6,"ndarray-ops":1,"typedarray-pool":10,webglew:12}],14:[function(a,b){function c(a,b,c,e){return function(f){return d(f,a,b,c,e)}}b.exports=c;var d=a("gl-shader-core")},{"gl-shader-core":20}],15:[function(a,b){function c(){throw new Error("You should bundle your code using `glslify` as a transform.")}b.exports=c},{}],16:[function(a,b){"use strict";function c(a,b,c,d,e,f,g){this._gl=a,this._program=b,this._location=c,this._dimension=d,this._name=e,this._constFunc=f,this._relink=g}function d(a,b,d,e,f,g,h){for(var i=["gl","v"],j=[],k=0;e>k;++k)i.push("x"+k),j.push("x"+k);i.push(["if(x0.length===void 0){return gl.vertexAttrib",e,"f(v,",j.join(),")}else{return gl.vertexAttrib",e,"fv(v,x0)}"].join(""));var l=Function.apply(void 0,i),m=new c(a,b,d,e,g,l,h);Object.defineProperty(f,g,{set:function(b){return a.disableVertexAttribArray(m._location),l(a,m._location,b),b},get:function(){return m},enumerable:!0})}function e(a,b,c,e){for(var f={},g=0,h=c.length;h>g;++g){var i=c[g],j=i.name,k=i.type,l=a.getAttribLocation(b,j);switch(k){case"bool":case"int":case"float":d(a,b,l,1,f,j,e);break;default:if(!(k.indexOf("vec")>=0))throw new Error("gl-shader: Unknown data type for attribute "+j+": "+k);var m=k.charCodeAt(k.length-1)-48;if(2>m||m>4)throw new Error("gl-shader: Invalid data type for attribute "+j+": "+k);d(a,b,l,m,f,j,e)}}return f}b.exports=e;var f=c.prototype;f.pointer=function(a,b,c,d){var e=this._gl;e.vertexAttribPointer(this._location,this._dimension,a||e.FLOAT,!!b,c||0,d||0),this._gl.enableVertexAttribArray(this._location)},Object.defineProperty(f,"location",{get:function(){return this._location},set:function(a){a!==this._location&&(this._location=a,this._gl.bindAttribLocation(this._program,a,this._name),this._gl.linkProgram(this._program),this._relink())}})},{}],17:[function(a,b){"use strict";function c(a){var b=new Function("y","return function(){return y}");return b(a)}function d(a,b,d,g){function h(c){var d=new Function("gl","prog","locations","return function(){return gl.getUniform(prog,locations["+c+"])}");return d(a,b,g)}function i(a,b,c){switch(c){case"bool":case"int":case"sampler2D":case"samplerCube":return"gl.uniform1i(locations["+b+"],obj"+a+")";case"float":return"gl.uniform1f(locations["+b+"],obj"+a+")";default:var d=c.indexOf("vec");if(!(d>=0&&1>=d&&c.length===4+d)){if(0===c.indexOf("mat")&&4===c.length){var e=c.charCodeAt(c.length-1)-48;if(2>e||e>4)throw new Error("gl-shader: Invalid uniform dimension type for matrix "+name+": "+c);return"gl.uniformMatrix"+e+"fv(locations["+b+"],false,obj"+a+")"}throw new Error("gl-shader: Unknown uniform data type for "+name+": "+c)}var e=c.charCodeAt(c.length-1)-48;if(2>e||e>4)throw new Error("gl-shader: Invalid data type");switch(c.charAt(0)){case"b":case"i":return"gl.uniform"+e+"iv(locations["+b+"],obj"+a+")";case"v":return"gl.uniform"+e+"fv(locations["+b+"],obj"+a+")";default:throw new Error("gl-shader: Unrecognized data type for vector "+name+": "+c)}}}function j(a,b){if("object"!=typeof b)return[[a,b]];var c=[];for(var d in b){var e=b[d],f=a;f+=parseInt(d)+""===d?"["+d+"]":"."+d,"object"==typeof e?c.push.apply(c,j(f,e)):c.push([f,e])}return c}function k(c){for(var e=["return function updateProperty(obj){"],f=j("",c),h=0;h<f.length;++h){var k=f[h],l=k[0],m=k[1];g[m]&&e.push(i(l,m,d[m].type))}e.push("return obj}");var n=new Function("gl","prog","locations",e.join("\n"));return n(a,b,g)}function l(a){switch(a){case"bool":return!1;case"int":case"sampler2D":case"samplerCube":return 0;case"float":return 0;default:var b=a.indexOf("vec");if(b>=0&&1>=b&&a.length===4+b){var c=a.charCodeAt(a.length-1)-48;if(2>c||c>4)throw new Error("gl-shader: Invalid data type");return"b"===a.charAt(0)?e(c,!1):e(c)}if(0===a.indexOf("mat")&&4===a.length){var c=a.charCodeAt(a.length-1)-48;if(2>c||c>4)throw new Error("gl-shader: Invalid uniform dimension type for matrix "+name+": "+a);return e([c,c])}throw new Error("gl-shader: Unknown uniform data type for "+name+": "+a)}}function m(a,b,e){if("object"==typeof e){var f=n(e);Object.defineProperty(a,b,{get:c(f),set:k(e),enumerable:!0,configurable:!1})}else g[e]?Object.defineProperty(a,b,{get:h(e),set:k(e),enumerable:!0,configurable:!1}):a[b]=l(d[e].type)}function n(a){var b;if(Array.isArray(a)){b=new Array(a.length);for(var c=0;c<a.length;++c)m(b,c,a[c])}else{b={};for(var d in a)m(b,d,a[d])}return b}var o=f(d,!0);return{get:c(n(o)),set:k(o),enumerable:!0,configurable:!0}}var e=a("dup"),f=a("./reflect");b.exports=d},{"./reflect":18,dup:19}],18:[function(a,b){"use strict";function c(a,b){for(var c={},d=0;d<a.length;++d)for(var e=a[d].name,f=e.split("."),g=c,h=0;h<f.length;++h){var i=f[h].split("[");if(i.length>1){i[0]in g||(g[i[0]]=[]),g=g[i[0]];for(var j=1;j<i.length;++j){var k=parseInt(i[j]);j<i.length-1||h<f.length-1?(k in g||(g[k]=j<i.length-1?[]:{}),g=g[k]):g[k]=b?d:a[d].type}}else h<f.length-1?(i[0]in g||(g[i[0]]={}),g=g[i[0]]):g[i[0]]=b?d:a[d].type}return c}b.exports=c},{}],19:[function(a,b){b.exports=a(9)},{"/Users/fdhuang/game/melonJS/node_modules/gl-texture2d/node_modules/typedarray-pool/node_modules/dup/dup.js":9}],20:[function(a,b){"use strict";function c(a,b,c,d){this.gl=a,this.handle=b,this.attributes=null,this.uniforms=null,this.types=null,this.vertexShader=c,this.fragmentShader=d}function d(a,b,c,d){for(var e=0;e<d.length;++e)c[e]=a.getUniformLocation(b,d[e].name)}function e(a,b,d,e,f){var g=a.createShader(a.VERTEX_SHADER);if(a.shaderSource(g,b),a.compileShader(g),!a.getShaderParameter(g,a.COMPILE_STATUS)){var h=a.getShaderInfoLog(g);throw console.error("gl-shader: Error compling vertex shader:",h),new Error("gl-shader: Error compiling vertex shader:"+h)}var i=a.createShader(a.FRAGMENT_SHADER);if(a.shaderSource(i,d),a.compileShader(i),!a.getShaderParameter(i,a.COMPILE_STATUS)){var h=a.getShaderInfoLog(i);throw console.error("gl-shader: Error compiling fragment shader:",h),new Error("gl-shader: Error compiling fragment shader:"+h)}var j=a.createProgram();if(a.attachShader(j,i),a.attachShader(j,g),f.forEach(function(b){"number"==typeof b.location&&a.bindAttribLocation(j,b.location,b.name)}),a.linkProgram(j),!a.getProgramParameter(j,a.LINK_STATUS)){var h=a.getProgramInfoLog(j);throw console.error("gl-shader: Error linking shader program:",h),new Error("gl-shader: Error linking shader program:"+h)}var k=new c(a,j,g,i);return k.updateExports(e,f),k}var f=a("./lib/create-uniforms"),g=a("./lib/create-attributes"),h=a("./lib/reflect");c.prototype.bind=function(){this.gl.useProgram(this.handle)},c.prototype.dispose=function(){var a=this.gl;a.deleteShader(this.vertexShader),a.deleteShader(this.fragmentShader),a.deleteProgram(this.handle)},c.prototype.updateExports=function(a,b){var c=new Array(a.length),e=this.handle,i=this.gl,j=d.bind(void 0,i,e,c,a);j(),this.types={uniforms:h(a),attributes:h(b)},this.attributes=g(i,e,b,j),Object.defineProperty(this,"uniforms",f(i,e,a,c))},b.exports=e},{"./lib/create-attributes":16,"./lib/create-uniforms":17,"./lib/reflect":18}],21:[function(a,b,c){function d(a,b,c){if(!(this instanceof d))return new d(a,b,c);var e,f=typeof a;if("number"===f)e=a>0?a>>>0:0;else if("string"===f)"base64"===b&&(a=x(a)),e=d.byteLength(a,b);else{if("object"!==f||null===a)throw new TypeError("must start with number, buffer, array or string");"Buffer"===a.type&&J(a.data)&&(a=a.data),e=+a.length>0?Math.floor(+a.length):0}if(this.length>K)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K.toString(16)+" bytes");var g;d.TYPED_ARRAY_SUPPORT?g=d._augment(new Uint8Array(e)):(g=this,g.length=e,g._isBuffer=!0);var h;if(d.TYPED_ARRAY_SUPPORT&&"number"==typeof a.byteLength)g._set(a);else if(z(a))if(d.isBuffer(a))for(h=0;e>h;h++)g[h]=a.readUInt8(h);else for(h=0;e>h;h++)g[h]=(a[h]%256+256)%256;else if("string"===f)g.write(a,0,b);else if("number"===f&&!d.TYPED_ARRAY_SUPPORT&&!c)for(h=0;e>h;h++)g[h]=0;return g}function e(a,b,c,d){c=Number(c)||0;var e=a.length-c;d?(d=Number(d),d>e&&(d=e)):d=e;var f=b.length;if(f%2!==0)throw new Error("Invalid hex string");d>f/2&&(d=f/2);for(var g=0;d>g;g++){var h=parseInt(b.substr(2*g,2),16);if(isNaN(h))throw new Error("Invalid hex string");a[c+g]=h}return g}function f(a,b,c,d){var e=F(B(b),a,c,d);return e}function g(a,b,c,d){var e=F(C(b),a,c,d);return e}function h(a,b,c,d){return g(a,b,c,d)}function i(a,b,c,d){var e=F(E(b),a,c,d);return e}function j(a,b,c,d){var e=F(D(b),a,c,d);return e}function k(a,b,c){return H.fromByteArray(0===b&&c===a.length?a:a.slice(b,c))}function l(a,b,c){var d="",e="";c=Math.min(a.length,c);for(var f=b;c>f;f++)a[f]<=127?(d+=G(e)+String.fromCharCode(a[f]),e=""):e+="%"+a[f].toString(16);return d+G(e)}function m(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;c>e;e++)d+=String.fromCharCode(a[e]);return d}function n(a,b,c){return m(a,b,c)}function o(a,b,c){var d=a.length;(!b||0>b)&&(b=0),(!c||0>c||c>d)&&(c=d);for(var e="",f=b;c>f;f++)e+=A(a[f]);return e}function p(a,b,c){for(var d=a.slice(b,c),e="",f=0;f<d.length;f+=2)e+=String.fromCharCode(d[f]+256*d[f+1]);return e}function q(a,b,c){if(a%1!==0||0>a)throw new RangeError("offset is not uint");if(a+b>c)throw new RangeError("Trying to access beyond buffer length")
}function r(a,b,c,e,f,g){if(!d.isBuffer(a))throw new TypeError("buffer must be a Buffer instance");if(b>f||g>b)throw new TypeError("value is out of bounds");if(c+e>a.length)throw new TypeError("index out of range")}function s(a,b,c,d){0>b&&(b=65535+b+1);for(var e=0,f=Math.min(a.length-c,2);f>e;e++)a[c+e]=(b&255<<8*(d?e:1-e))>>>8*(d?e:1-e)}function t(a,b,c,d){0>b&&(b=4294967295+b+1);for(var e=0,f=Math.min(a.length-c,4);f>e;e++)a[c+e]=b>>>8*(d?e:3-e)&255}function u(a,b,c,d,e,f){if(b>e||f>b)throw new TypeError("value is out of bounds");if(c+d>a.length)throw new TypeError("index out of range")}function v(a,b,c,d,e){return e||u(a,b,c,4,3.4028234663852886e38,-3.4028234663852886e38),I.write(a,b,c,d,23,4),c+4}function w(a,b,c,d,e){return e||u(a,b,c,8,1.7976931348623157e308,-1.7976931348623157e308),I.write(a,b,c,d,52,8),c+8}function x(a){for(a=y(a).replace(M,"");a.length%4!==0;)a+="=";return a}function y(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function z(a){return J(a)||d.isBuffer(a)||a&&"object"==typeof a&&"number"==typeof a.length}function A(a){return 16>a?"0"+a.toString(16):a.toString(16)}function B(a){for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c);if(127>=d)b.push(d);else{var e=c;d>=55296&&57343>=d&&c++;for(var f=encodeURIComponent(a.slice(e,c+1)).substr(1).split("%"),g=0;g<f.length;g++)b.push(parseInt(f[g],16))}}return b}function C(a){for(var b=[],c=0;c<a.length;c++)b.push(255&a.charCodeAt(c));return b}function D(a){for(var b,c,d,e=[],f=0;f<a.length;f++)b=a.charCodeAt(f),c=b>>8,d=b%256,e.push(d),e.push(c);return e}function E(a){return H.toByteArray(a)}function F(a,b,c,d){for(var e=0;d>e&&!(e+c>=b.length||e>=a.length);e++)b[e+c]=a[e];return e}function G(a){try{return decodeURIComponent(a)}catch(b){return String.fromCharCode(65533)}}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var H=a("base64-js"),I=a("ieee754"),J=a("is-array");c.Buffer=d,c.SlowBuffer=d,c.INSPECT_MAX_BYTES=50,d.poolSize=8192;var K=1073741823;d.TYPED_ARRAY_SUPPORT=function(){try{var a=new ArrayBuffer(0),b=new Uint8Array(a);return b.foo=function(){return 42},42===b.foo()&&"function"==typeof b.subarray&&0===new Uint8Array(1).subarray(1,1).byteLength}catch(c){return!1}}(),d.isBuffer=function(a){return!(null==a||!a._isBuffer)},d.compare=function(a,b){if(!d.isBuffer(a)||!d.isBuffer(b))throw new TypeError("Arguments must be Buffers");for(var c=a.length,e=b.length,f=0,g=Math.min(c,e);g>f&&a[f]===b[f];f++);return f!==g&&(c=a[f],e=b[f]),e>c?-1:c>e?1:0},d.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.concat=function(a,b){if(!J(a))throw new TypeError("Usage: Buffer.concat(list[, length])");if(0===a.length)return new d(0);if(1===a.length)return a[0];var c;if(void 0===b)for(b=0,c=0;c<a.length;c++)b+=a[c].length;var e=new d(b),f=0;for(c=0;c<a.length;c++){var g=a[c];g.copy(e,f),f+=g.length}return e},d.byteLength=function(a,b){var c;switch(a+="",b||"utf8"){case"ascii":case"binary":case"raw":c=a.length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":c=2*a.length;break;case"hex":c=a.length>>>1;break;case"utf8":case"utf-8":c=B(a).length;break;case"base64":c=E(a).length;break;default:c=a.length}return c},d.prototype.length=void 0,d.prototype.parent=void 0,d.prototype.toString=function(a,b,c){var d=!1;if(b>>>=0,c=void 0===c||1/0===c?this.length:c>>>0,a||(a="utf8"),0>b&&(b=0),c>this.length&&(c=this.length),b>=c)return"";for(;;)switch(a){case"hex":return o(this,b,c);case"utf8":case"utf-8":return l(this,b,c);case"ascii":return m(this,b,c);case"binary":return n(this,b,c);case"base64":return k(this,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return p(this,b,c);default:if(d)throw new TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),d=!0}},d.prototype.equals=function(a){if(!d.isBuffer(a))throw new TypeError("Argument must be a Buffer");return 0===d.compare(this,a)},d.prototype.inspect=function(){var a="",b=c.INSPECT_MAX_BYTES;return this.length>0&&(a=this.toString("hex",0,b).match(/.{2}/g).join(" "),this.length>b&&(a+=" ... ")),"<Buffer "+a+">"},d.prototype.compare=function(a){if(!d.isBuffer(a))throw new TypeError("Argument must be a Buffer");return d.compare(this,a)},d.prototype.get=function(a){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(a)},d.prototype.set=function(a,b){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(a,b)},d.prototype.write=function(a,b,c,d){if(isFinite(b))isFinite(c)||(d=c,c=void 0);else{var k=d;d=b,b=c,c=k}b=Number(b)||0;var l=this.length-b;c?(c=Number(c),c>l&&(c=l)):c=l,d=String(d||"utf8").toLowerCase();var m;switch(d){case"hex":m=e(this,a,b,c);break;case"utf8":case"utf-8":m=f(this,a,b,c);break;case"ascii":m=g(this,a,b,c);break;case"binary":m=h(this,a,b,c);break;case"base64":m=i(this,a,b,c);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":m=j(this,a,b,c);break;default:throw new TypeError("Unknown encoding: "+d)}return m},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},d.prototype.slice=function(a,b){var c=this.length;if(a=~~a,b=void 0===b?c:~~b,0>a?(a+=c,0>a&&(a=0)):a>c&&(a=c),0>b?(b+=c,0>b&&(b=0)):b>c&&(b=c),a>b&&(b=a),d.TYPED_ARRAY_SUPPORT)return d._augment(this.subarray(a,b));for(var e=b-a,f=new d(e,void 0,!0),g=0;e>g;g++)f[g]=this[g+a];return f},d.prototype.readUInt8=function(a,b){return b||q(a,1,this.length),this[a]},d.prototype.readUInt16LE=function(a,b){return b||q(a,2,this.length),this[a]|this[a+1]<<8},d.prototype.readUInt16BE=function(a,b){return b||q(a,2,this.length),this[a]<<8|this[a+1]},d.prototype.readUInt32LE=function(a,b){return b||q(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]},d.prototype.readUInt32BE=function(a,b){return b||q(a,4,this.length),16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])},d.prototype.readInt8=function(a,b){return b||q(a,1,this.length),128&this[a]?-1*(255-this[a]+1):this[a]},d.prototype.readInt16LE=function(a,b){b||q(a,2,this.length);var c=this[a]|this[a+1]<<8;return 32768&c?4294901760|c:c},d.prototype.readInt16BE=function(a,b){b||q(a,2,this.length);var c=this[a+1]|this[a]<<8;return 32768&c?4294901760|c:c},d.prototype.readInt32LE=function(a,b){return b||q(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},d.prototype.readInt32BE=function(a,b){return b||q(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},d.prototype.readFloatLE=function(a,b){return b||q(a,4,this.length),I.read(this,a,!0,23,4)},d.prototype.readFloatBE=function(a,b){return b||q(a,4,this.length),I.read(this,a,!1,23,4)},d.prototype.readDoubleLE=function(a,b){return b||q(a,8,this.length),I.read(this,a,!0,52,8)},d.prototype.readDoubleBE=function(a,b){return b||q(a,8,this.length),I.read(this,a,!1,52,8)},d.prototype.writeUInt8=function(a,b,c){return a=+a,b>>>=0,c||r(this,a,b,1,255,0),d.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),this[b]=a,b+1},d.prototype.writeUInt16LE=function(a,b,c){return a=+a,b>>>=0,c||r(this,a,b,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[b]=a,this[b+1]=a>>>8):s(this,a,b,!0),b+2},d.prototype.writeUInt16BE=function(a,b,c){return a=+a,b>>>=0,c||r(this,a,b,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=a):s(this,a,b,!1),b+2},d.prototype.writeUInt32LE=function(a,b,c){return a=+a,b>>>=0,c||r(this,a,b,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[b+3]=a>>>24,this[b+2]=a>>>16,this[b+1]=a>>>8,this[b]=a):t(this,a,b,!0),b+4},d.prototype.writeUInt32BE=function(a,b,c){return a=+a,b>>>=0,c||r(this,a,b,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=a):t(this,a,b,!1),b+4},d.prototype.writeInt8=function(a,b,c){return a=+a,b>>>=0,c||r(this,a,b,1,127,-128),d.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),0>a&&(a=255+a+1),this[b]=a,b+1},d.prototype.writeInt16LE=function(a,b,c){return a=+a,b>>>=0,c||r(this,a,b,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[b]=a,this[b+1]=a>>>8):s(this,a,b,!0),b+2},d.prototype.writeInt16BE=function(a,b,c){return a=+a,b>>>=0,c||r(this,a,b,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=a):s(this,a,b,!1),b+2},d.prototype.writeInt32LE=function(a,b,c){return a=+a,b>>>=0,c||r(this,a,b,4,2147483647,-2147483648),d.TYPED_ARRAY_SUPPORT?(this[b]=a,this[b+1]=a>>>8,this[b+2]=a>>>16,this[b+3]=a>>>24):t(this,a,b,!0),b+4},d.prototype.writeInt32BE=function(a,b,c){return a=+a,b>>>=0,c||r(this,a,b,4,2147483647,-2147483648),0>a&&(a=4294967295+a+1),d.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=a):t(this,a,b,!1),b+4},d.prototype.writeFloatLE=function(a,b,c){return v(this,a,b,!0,c)},d.prototype.writeFloatBE=function(a,b,c){return v(this,a,b,!1,c)},d.prototype.writeDoubleLE=function(a,b,c){return w(this,a,b,!0,c)},d.prototype.writeDoubleBE=function(a,b,c){return w(this,a,b,!1,c)},d.prototype.copy=function(a,b,c,e){var f=this;if(c||(c=0),e||0===e||(e=this.length),b||(b=0),e!==c&&0!==a.length&&0!==f.length){if(c>e)throw new TypeError("sourceEnd < sourceStart");if(0>b||b>=a.length)throw new TypeError("targetStart out of bounds");if(0>c||c>=f.length)throw new TypeError("sourceStart out of bounds");if(0>e||e>f.length)throw new TypeError("sourceEnd out of bounds");e>this.length&&(e=this.length),a.length-b<e-c&&(e=a.length-b+c);var g=e-c;if(100>g||!d.TYPED_ARRAY_SUPPORT)for(var h=0;g>h;h++)a[h+b]=this[h+c];else a._set(this.subarray(c,c+g),b)}},d.prototype.fill=function(a,b,c){if(a||(a=0),b||(b=0),c||(c=this.length),b>c)throw new TypeError("end < start");if(c!==b&&0!==this.length){if(0>b||b>=this.length)throw new TypeError("start out of bounds");if(0>c||c>this.length)throw new TypeError("end out of bounds");var d;if("number"==typeof a)for(d=b;c>d;d++)this[d]=a;else{var e=B(a.toString()),f=e.length;for(d=b;c>d;d++)this[d]=e[d%f]}return this}},d.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(d.TYPED_ARRAY_SUPPORT)return new d(this).buffer;for(var a=new Uint8Array(this.length),b=0,c=a.length;c>b;b+=1)a[b]=this[b];return a.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var L=d.prototype;d._augment=function(a){return a._isBuffer=!0,a._get=a.get,a._set=a.set,a.get=L.get,a.set=L.set,a.write=L.write,a.toString=L.toString,a.toLocaleString=L.toString,a.toJSON=L.toJSON,a.equals=L.equals,a.compare=L.compare,a.copy=L.copy,a.slice=L.slice,a.readUInt8=L.readUInt8,a.readUInt16LE=L.readUInt16LE,a.readUInt16BE=L.readUInt16BE,a.readUInt32LE=L.readUInt32LE,a.readUInt32BE=L.readUInt32BE,a.readInt8=L.readInt8,a.readInt16LE=L.readInt16LE,a.readInt16BE=L.readInt16BE,a.readInt32LE=L.readInt32LE,a.readInt32BE=L.readInt32BE,a.readFloatLE=L.readFloatLE,a.readFloatBE=L.readFloatBE,a.readDoubleLE=L.readDoubleLE,a.readDoubleBE=L.readDoubleBE,a.writeUInt8=L.writeUInt8,a.writeUInt16LE=L.writeUInt16LE,a.writeUInt16BE=L.writeUInt16BE,a.writeUInt32LE=L.writeUInt32LE,a.writeUInt32BE=L.writeUInt32BE,a.writeInt8=L.writeInt8,a.writeInt16LE=L.writeInt16LE,a.writeInt16BE=L.writeInt16BE,a.writeInt32LE=L.writeInt32LE,a.writeInt32BE=L.writeInt32BE,a.writeFloatLE=L.writeFloatLE,a.writeFloatBE=L.writeFloatBE,a.writeDoubleLE=L.writeDoubleLE,a.writeDoubleBE=L.writeDoubleBE,a.fill=L.fill,a.inspect=L.inspect,a.toArrayBuffer=L.toArrayBuffer,a};var M=/[^+\/0-9A-z]/g},{"base64-js":22,ieee754:23,"is-array":24}],22:[function(a,b,c){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(a){"use strict";function b(a){var b=a.charCodeAt(0);return b===g?62:b===h?63:i>b?-1:i+10>b?b-i+26+26:k+26>b?b-k:j+26>b?b-j+26:void 0}function c(a){function c(a){j[l++]=a}var d,e,g,h,i,j;if(a.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var k=a.length;i="="===a.charAt(k-2)?2:"="===a.charAt(k-1)?1:0,j=new f(3*a.length/4-i),g=i>0?a.length-4:a.length;var l=0;for(d=0,e=0;g>d;d+=4,e+=3)h=b(a.charAt(d))<<18|b(a.charAt(d+1))<<12|b(a.charAt(d+2))<<6|b(a.charAt(d+3)),c((16711680&h)>>16),c((65280&h)>>8),c(255&h);return 2===i?(h=b(a.charAt(d))<<2|b(a.charAt(d+1))>>4,c(255&h)):1===i&&(h=b(a.charAt(d))<<10|b(a.charAt(d+1))<<4|b(a.charAt(d+2))>>2,c(h>>8&255),c(255&h)),j}function e(a){function b(a){return d.charAt(a)}function c(a){return b(a>>18&63)+b(a>>12&63)+b(a>>6&63)+b(63&a)}var e,f,g,h=a.length%3,i="";for(e=0,g=a.length-h;g>e;e+=3)f=(a[e]<<16)+(a[e+1]<<8)+a[e+2],i+=c(f);switch(h){case 1:f=a[a.length-1],i+=b(f>>2),i+=b(f<<4&63),i+="==";break;case 2:f=(a[a.length-2]<<8)+a[a.length-1],i+=b(f>>10),i+=b(f>>4&63),i+=b(f<<2&63),i+="="}return i}var f="undefined"!=typeof Uint8Array?Uint8Array:Array,g="+".charCodeAt(0),h="/".charCodeAt(0),i="0".charCodeAt(0),j="a".charCodeAt(0),k="A".charCodeAt(0);a.toByteArray=c,a.fromByteArray=e}("undefined"==typeof c?this.base64js={}:c)},{}],23:[function(a,b,c){c.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?0/0:1/0*(n?-1:1);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},c.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=0>b||0===b&&0>1/b?1:0;for(b=Math.abs(b),isNaN(b)||1/0===b?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}},{}],24:[function(a,b){var c=Array.isArray,d=Object.prototype.toString;b.exports=c||function(a){return!!a&&"[object Array]"==d.call(a)}},{}],25:[function(a,b){b.exports={createShader:a("../video/shader"),gltexture2d:a("gl-texture2d")}},{"../video/shader":26,"gl-texture2d":13}],26:[function(a,b){var c=(a("glslify"),a("glslify/adapter.js")("\n#define GLSLIFY 1\n\nattribute vec2 aPosition;\nattribute vec2 aTexture;\nuniform mat3 uMatrix;\nvarying vec2 vTexCoord;\nvoid main(void) {\n  gl_Position = vec4((uMatrix * vec3(aPosition, 1)).xy, 0, 1);\n  vTexCoord = aTexture;\n}","\n#define GLSLIFY 1\n\nprecision mediump float;\nvarying vec2 vTexCoord;\nuniform vec4 uColor;\nuniform sampler2D texture;\nvoid main(void) {\n  gl_FragColor = texture2D(texture, vec2(vTexCoord.s, vTexCoord.t)) * uColor;\n}",[{name:"uMatrix",type:"mat3"},{name:"uColor",type:"vec4"},{name:"texture",type:"sampler2D"}],[{name:"aPosition",type:"vec2"},{name:"aTexture",type:"vec2"}]));b.exports=c},{glslify:15,"glslify/adapter.js":14}]},{},[25])(25)}),function(){me.plugin=function(){var a={};return a.Base=Object.extend({init:function(){this.version="1.2.0"}}),a.patch=function(a,b,c){if("undefined"!=typeof a.prototype&&(a=a.prototype),"function"==typeof a[b]){var d=a[b];Object.defineProperty(a,b,{configurable:!0,value:function(a,b){return function(){this._patched=d;var a=b.apply(this,arguments);return this._patched=null,a}}(b,c)})}else console.error(b+" is not an existing function")},a.register=function(a,b){me.plugin[b]&&console.error("plugin "+b+" already registered");var c=[];if(arguments.length>2&&(c=Array.prototype.slice.call(arguments,1)),c[0]=a,me.plugin[b]=new(a.bind.apply(a,c)),!(me.plugin[b]&&me.plugin[b]instanceof me.plugin.Base))throw new me.Error("Plugin should extend the me.plugin.Base Class !");if(me.sys.checkVersion(me.plugin[b].version)>0)throw new me.Error("Plugin version mismatch, expected: "+me.plugin[b].version+", got: "+me.version)},a}()}(),me.DraggableEntity=function(a,b,c,d){"use strict";return a.extend({init:function(c,e,f){a.prototype.init.apply(this,[c,e,f]),this.dragging=!1,this.dragId=null,this.grabOffset=new d(0,0),this.onPointerEvent=b.registerPointerEvent,this.removePointerEvent=b.releasePointerEvent,this.initEvents()},initEvents:function(){var a=this;this.mouseDown=function(a){this.translatePointerEvent(a,c.DRAGSTART)},this.mouseUp=function(a){this.translatePointerEvent(a,c.DRAGEND)},this.onPointerEvent("pointerdown",this,this.mouseDown.bind(this)),this.onPointerEvent("pointerup",this,this.mouseUp.bind(this)),c.subscribe(c.MOUSEMOVE,this.dragMove.bind(this)),c.subscribe(c.DRAGSTART,function(b,c){c===a&&a.dragStart(b)}),c.subscribe(c.DRAGEND,function(b,c){c===a&&a.dragEnd(b)})},translatePointerEvent:function(a,b){c.publish(b,[a,this])},dragStart:function(a){return this.dragging===!1?(this.dragging=!0,this.dragId=a.pointerId,this.grabOffset.set(a.gameX,a.gameY),this.grabOffset.sub(this.pos),!1):void 0},dragMove:function(a){this.dragging===!0&&this.dragId===a.pointerId&&(this.pos.set(a.gameX,a.gameY),this.pos.sub(this.grabOffset))},dragEnd:function(){return this.dragging===!0?(this.pointerId=void 0,this.dragging=!1,!1):void 0},destroy:function(){c.unsubscribe(c.MOUSEMOVE,this.dragMove),c.unsubscribe(c.DRAGSTART,this.dragStart),c.unsubscribe(c.DRAGEND,this.dragEnd),this.removePointerEvent("pointerdown",this),this.removePointerEvent("pointerup",this)}})}(me.Entity,me.input,me.event,me.Vector2d),me.DroptargetEntity=function(a,b){"use strict";return a.extend({init:function(c,d,e){this.CHECKMETHOD_OVERLAP="overlaps",this.CHECKMETHOD_CONTAINS="contains",this.checkMethod=null,a.prototype.init.apply(this,[c,d,e]),b.subscribe(b.DRAGEND,this.checkOnMe.bind(this)),this.checkMethod=this[this.CHECKMETHOD_OVERLAP]},setCheckMethod:function(a){"undefined"!=typeof this[a]&&(this.checkMethod=this[a])},checkOnMe:function(a,b){b&&this.checkMethod(b.getBounds().translateV(b.pos))&&this.drop(b)},drop:function(){},destroy:function(){b.unsubscribe(b.DRAGEND,this.checkOnMe)}})}(me.Entity,me.event),function(){var a=function(){var a=me.video.createCanvas(1,1),b=me.CanvasRenderer.getContext2d(a);return b.fillStyle="#fff",b.fillRect(0,0,1,1),a}();me.ParticleEmitterSettings={width:0,height:0,image:a,totalParticles:50,angle:Math.PI/2,angleVariation:0,minLife:1e3,maxLife:3e3,speed:2,speedVariation:1,minRotation:0,maxRotation:0,minStartScale:1,maxStartScale:1,minEndScale:0,maxEndScale:0,gravity:0,wind:0,followTrajectory:!1,textureAdditive:!1,onlyInViewport:!0,floating:!1,maxParticles:10,frequency:100,duration:1/0,framesToSkip:0},me.ParticleEmitter=me.Rect.extend({init:function(a,b,c){this._stream=!1,this._frequencyTimer=0,this._durationTimer=0,this._enabled=!1,this.isRenderable=!1,me.Rect.prototype.init.apply(this,[a,b,1/0,1/0]),this.autoSort=!1,this.container=new me.ParticleContainer(this),Object.defineProperty(this,"z",{get:function(){return this.container.z},set:function(a){this.container.z=a},enumerable:!0,configurable:!0}),Object.defineProperty(this,"floating",{get:function(){return this.container.floating},set:function(a){this.container.floating=a},enumerable:!0,configurable:!0}),this.reset(c)},destroy:function(){this.reset()},getRandomPoint:function(){var a=this.pos.clone();return a.x+=Number.prototype.randomFloat(0,this.width),a.y+=Number.prototype.randomFloat(0,this.height),a},reset:function(a){a=a||{};var b=me.ParticleEmitterSettings,c="number"==typeof a.width?a.width:b.width,d="number"==typeof a.height?a.height:b.height;this.resize(c,d),this.image=a.image||b.image,this.totalParticles="number"==typeof a.totalParticles?a.totalParticles:b.totalParticles,this.angle="number"==typeof a.angle?a.angle:b.angle,this.angleVariation="number"==typeof a.angleVariation?a.angleVariation:b.angleVariation,this.minLife="number"==typeof a.minLife?a.minLife:b.minLife,this.maxLife="number"==typeof a.maxLife?a.maxLife:b.maxLife,this.speed="number"==typeof a.speed?a.speed:b.speed,this.speedVariation="number"==typeof a.speedVariation?a.speedVariation:b.speedVariation,this.minRotation="number"==typeof a.minRotation?a.minRotation:b.minRotation,this.maxRotation="number"==typeof a.maxRotation?a.maxRotation:b.maxRotation,this.minStartScale="number"==typeof a.minStartScale?a.minStartScale:b.minStartScale,this.maxStartScale="number"==typeof a.maxStartScale?a.maxStartScale:b.maxStartScale,this.minEndScale="number"==typeof a.minEndScale?a.minEndScale:b.minEndScale,this.maxEndScale="number"==typeof a.maxEndScale?a.maxEndScale:b.maxEndScale,this.gravity="number"==typeof a.gravity?a.gravity:b.gravity,this.wind="number"==typeof a.wind?a.wind:b.wind,this.followTrajectory="boolean"==typeof a.followTrajectory?a.followTrajectory:b.followTrajectory,this.textureAdditive="boolean"==typeof a.textureAdditive?a.textureAdditive:b.textureAdditive,this.onlyInViewport="boolean"==typeof a.onlyInViewport?a.onlyInViewport:b.onlyInViewport,this.floating="boolean"==typeof a.floating?a.floating:b.floating,this.maxParticles="number"==typeof a.maxParticles?a.maxParticles:b.maxParticles,this.frequency="number"==typeof a.frequency?a.frequency:b.frequency,this.duration="number"==typeof a.duration?a.duration:b.duration,this.framesToSkip="number"==typeof a.framesToSkip?a.framesToSkip:b.framesToSkip,this.container.destroy()},addParticles:function(a){for(var b=0;~~a>b;b++){var c=me.pool.pull("me.Particle",this);c.isRenderable=!1,this.container.addChild(c)}},isRunning:function(){return this._enabled&&this._stream},streamParticles:function(a){this._enabled=!0,this._stream=!0,this.frequency=Math.max(this.frequency,1),this._durationTimer="number"==typeof a?a:this.duration},stopStream:function(){this._enabled=!1},burstParticles:function(a){this._enabled=!0,this._stream=!1,this.addParticles("number"==typeof a?a:this.totalParticles),this._enabled=!1},update:function(a){if(this._enabled&&this._stream){if(1/0!==this._durationTimer&&(this._durationTimer-=a,this._durationTimer<=0))return this.stopStream(),!1;this._frequencyTimer+=a;var b=this.container.children.length;b<this.totalParticles&&this._frequencyTimer>=this.frequency&&(this.addParticles(b+this.maxParticles<=this.totalParticles?this.maxParticles:this.totalParticles-b),this._frequencyTimer=0)}return!0}})}(),function(){me.ParticleContainer=me.Container.extend({init:function(a){me.Container.prototype.init.apply(this),this.autoSort=!1,this._updateCount=0,this._dt=0,this._emitter=a},update:function(a){if(++this._updateCount>this._emitter.framesToSkip&&(this._updateCount=0),this._updateCount>0)return this._dt+=a,!1;a+=this._dt,this._dt=0;for(var b=me.game.viewport,c=this.children.length-1;c>=0;--c){var d=this.children[c];d.isRenderable=!0,d.inViewport=this.floating||d.pos.x<b.pos.x+b.width&&b.pos.x<d.pos.x+d.width&&d.pos.y<b.pos.y+b.height&&b.pos.y<d.pos.y+d.height,d.update(a)||this.removeChildNow(d)}return!0},draw:function(a,b){if(this.children.length>0){var c;this._emitter.textureAdditive&&(c=a.globalCompositeOperation,a.globalCompositeOperation="lighter"),me.Container.prototype.draw.apply(this,[a,b]),this._emitter.textureAdditive&&(a.globalCompositeOperation=c)}}})}(),function(){me.Particle=me.Renderable.extend({init:function(a){var b=a.getRandomPoint();me.Renderable.prototype.init.apply(this,[b.x,b.y,a.image.width,a.image.height]),this.alwaysUpdate=!0,this.image=a.image;var c=a.angle+(a.angleVariation>0?(2*Math.random()-1)*a.angleVariation:0),d=a.speed+(a.speedVariation>0?(2*Math.random()-1)*a.speedVariation:0);this.vel=new me.Vector2d(d*Math.cos(c),-d*Math.sin(c)),this.life=Number.prototype.random(a.minLife,a.maxLife),this.startLife=this.life,this.startScale=Number.prototype.randomFloat(a.minStartScale,a.maxStartScale).clamp(a.minStartScale,a.maxStartScale),this.endScale=Number.prototype.randomFloat(a.minEndScale,a.maxEndScale).clamp(a.minEndScale,a.maxEndScale),this.gravity=a.gravity,this.wind=a.wind,this.followTrajectory=a.followTrajectory,this.onlyInViewport=a.onlyInViewport,this.z=a.z,this._deltaInv=me.sys.fps/1e3,this.transform=new me.Matrix2d,a.followTrajectory||(this.angle=Number.prototype.randomFloat(a.minRotation,a.maxRotation))},update:function(a){var b=a*this._deltaInv;this.life=this.life>a?this.life-a:0;var c=this.life/this.startLife,d=this.startScale;this.startScale>this.endScale?(d*=c,d=d<this.endScale?this.endScale:d):this.startScale<this.endScale&&(d/=c,d=d>this.endScale?this.endScale:d),this.alpha=c,this.vel.x+=this.wind*b,this.vel.y+=this.gravity*b;var e=this.followTrajectory?Math.atan2(this.vel.y,this.vel.x):this.angle;return this.transform.set(d,0,0,d,0,0).rotate(e),this.pos.x+=this.vel.x*b,this.pos.y+=this.vel.y*b,(this.inViewport||!this.onlyInViewport)&&this.life>0},draw:function(a){a.save(),a.setGlobalAlpha(a.globalAlpha()*this.alpha);var b=this.transform;a.transform(b.a,b.b,b.c,b.d,~~this.pos.x,~~this.pos.y);var c=this.width,d=this.height;a.drawImage(this.image,0,0,c,d,-c/2,-d/2,c,d),a.restore()}})}(window);